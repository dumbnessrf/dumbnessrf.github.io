[{"content":"ğŸ§© Avalonia æ¡†æ¶æ¦‚è§ˆ ğŸ” ç®€ä»‹ Avalonia æ˜¯ä¸€ä¸ª è·¨å¹³å°çš„ .NET ç”¨æˆ·ç•Œé¢æ¡†æ¶ï¼Œæ”¯æŒä½¿ç”¨ C# å’Œ XAML æ„å»ºæ¡Œé¢ã€ç§»åŠ¨å’Œ Web åº”ç”¨ç¨‹åºã€‚å…¶è®¾è®¡çµæ„Ÿæ¥æºäº WPF å’Œ UWPï¼Œä½†å…·æœ‰æ›´å¼ºçš„è·¨å¹³å°å…¼å®¹æ€§ã€‚\nâœ… ä¸»è¦ç‰¹ç‚¹ï¼š ä½¿ç”¨ç†Ÿæ‚‰çš„ XAML è¯­æ³• æ”¯æŒå¤šç§ UI æ§ä»¶å’Œæ ·å¼ å¯è¿è¡Œäºå¤šä¸ªæ“ä½œç³»ç»Ÿ æ”¯æŒ MVVM æ¨¡å¼åŠä¾èµ–æ³¨å…¥ ğŸŒ å¹³å°æ”¯æŒ Avalonia æ”¯æŒä»¥ä¸‹å¹³å°ï¼š\nå¹³å° æ”¯æŒæƒ…å†µ Windows å®Œå…¨æ”¯æŒ Linux å®Œå…¨æ”¯æŒ macOS å®Œå…¨æ”¯æŒ Android/iOS å®éªŒæ€§æ”¯æŒï¼ˆéœ€é¢å¤–é€‚é…ï¼‰ WebAssembly æ”¯æŒï¼ˆé€šè¿‡ WASM æ¸²æŸ“å™¨ï¼‰ ğŸ’¡ Avalonia æä¾›äº†çœŸæ­£çš„è·¨å¹³å°å¼€å‘èƒ½åŠ›ï¼Œé€‚ç”¨äºéœ€è¦ç»Ÿä¸€å¤šç«¯ä½“éªŒçš„åº”ç”¨åœºæ™¯ã€‚\nâš™ï¸ æ€§èƒ½è¡¨ç° Avalonia çš„æ¸²æŸ“å¼•æ“ç»è¿‡ä¼˜åŒ–ï¼Œå…·å¤‡é«˜æ•ˆçš„ç»˜åˆ¶èƒ½åŠ›å’Œè‰¯å¥½çš„ç¡¬ä»¶åŠ é€Ÿæ”¯æŒï¼Œå°¤å…¶åœ¨å¤„ç†å¤æ‚å›¾å½¢ä¸æ•°æ®å¯è§†åŒ–æ—¶è¡¨ç°å‡ºè‰²ã€‚\né«˜æ•ˆçš„æ¸²æŸ“ç®¡é“ æ”¯æŒ GPU åŠ é€Ÿ ä½å»¶è¿Ÿå“åº”ç”¨æˆ·äº¤äº’ ä¾‹å¦‚ï¼šå½“åº”ç”¨ä¸­å­˜åœ¨å¤§é‡åŠ¨æ€å›¾è¡¨æˆ–åŠ¨ç”»å…ƒç´ æ—¶ï¼ŒAvalonia èƒ½ä¿æŒæµç•…çš„å¸§ç‡ï¼Œé¿å…å¡é¡¿ç°è±¡ã€‚\nğŸ”„ Microsoft.Extensions.DependencyInjection è¯¦è§£ ğŸ“¦ æ¦‚è¿° Microsoft.Extensions.DependencyInjection æ˜¯ .NET ä¸­çš„ä¸€ä¸ª è½»é‡çº§ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰å®¹å™¨ï¼Œå®ƒæä¾›äº†ä¸€ç§çµæ´»çš„æ–¹å¼æ¥ç®¡ç†åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡åŠå…¶ä¾èµ–å…³ç³»ã€‚\nğŸ’¡ ä¸ºä»€ä¹ˆä½¿ç”¨ DIï¼Ÿ è§£è€¦ä¸šåŠ¡é€»è¾‘ä¸å…·ä½“å®ç° æé«˜ä»£ç å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ æ”¯æŒæ¨¡å—åŒ–å¼€å‘ ğŸ•’ æœåŠ¡ç”Ÿå‘½å‘¨æœŸï¼ˆService Lifecycleï¼‰ ç”Ÿå‘½å‘¨æœŸç±»å‹ æè¿° Transientï¼ˆç¬æ€ï¼‰ æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºæ–°å®ä¾‹ï¼Œé€‚åˆæ— çŠ¶æ€æœåŠ¡ Scopedï¼ˆä½œç”¨åŸŸï¼‰ åŒä¸€ä½œç”¨åŸŸå†…å…±äº«åŒä¸€ä¸ªå®ä¾‹ï¼Œå¸¸ç”¨äº Web è¯·æ±‚ä¸Šä¸‹æ–‡ Singletonï¼ˆå•ä¾‹ï¼‰ æ•´ä¸ªåº”ç”¨ç¨‹åºå‘¨æœŸå†…å…±äº«å”¯ä¸€å®ä¾‹ï¼Œé€‚åˆå…¨å±€èµ„æºç®¡ç† ç¤ºä¾‹è¯´æ˜ï¼š Transientï¼šæ¯æ¬¡è°ƒç”¨ IDataProcessor éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚ Scopedï¼šåœ¨ä¸€æ¬¡ HTTP è¯·æ±‚ä¸­ï¼Œæ‰€æœ‰å¯¹ IDatabaseContext çš„è¯·æ±‚éƒ½è¿”å›åŒä¸€ä¸ªå®ä¾‹ã€‚ Singletonï¼šå¦‚ IAppSettingsï¼Œåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å§‹ç»ˆä¸ºåŒä¸€å®ä¾‹ã€‚ ğŸ§ª ç¤ºä¾‹ï¼šåœ¨ Avalonia ä¸­é›†æˆä¾èµ–æ³¨å…¥ ğŸ“ä»¥ä¸‹ç¤ºä¾‹å°†æ·»åŠ Rediså’Œç¬¬ä¸‰æ–¹Avaloniaæ ·å¼åº“SukiUIä½œä¸ºå‚è€ƒ\n1ï¸âƒ£ å®‰è£…ä¾èµ–æ³¨å…¥åŒ… 1 install-package Microsoft.Extensions.DependencyInjection 2ï¸âƒ£ åˆå§‹åŒ–æœåŠ¡å®¹å™¨ åœ¨ App.xaml.cs ä¸­é‡å†™ OnFrameworkInitializationCompleted() æ–¹æ³•ä»¥æ³¨å†Œå¹¶æ„å»ºæœåŠ¡å®¹å™¨ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 public override void OnFrameworkInitializationCompleted() { var collection = new ServiceCollection(); collection.AddCommonServices(); collection.AddDistributedCache(); _services = collection.BuildServiceProvider(); var vm = _services.GetRequiredService\u0026lt;MainWindowViewModel\u0026gt;(); var toastService = _services.GetRequiredService\u0026lt;ISukiToastManager\u0026gt;(); var dialogService = _services.GetRequiredService\u0026lt;ISukiDialogManager\u0026gt;(); if (ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop) { desktop.MainWindow = _services.GetRequiredService\u0026lt;MainWindow\u0026gt;(); } else if (ApplicationLifetime is ISingleViewApplicationLifetime singleViewPlatform) { singleViewPlatform.MainView = new MainWindow(toastService, dialogService) { DataContext = vm, }; } base.OnFrameworkInitializationCompleted(); } 3ï¸âƒ£ æ³¨å†ŒæœåŠ¡ è‡ªå®šä¹‰æ‰©å±•æ–¹æ³•æ³¨å†Œå¸¸ç”¨æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 public static void AddCommonServices(this IServiceCollection collection) { collection.AddSingleton\u0026lt;MainWindowViewModel\u0026gt;(); collection.AddSingleton\u0026lt;MainWindow\u0026gt;(s =\u0026gt; new MainWindow( s.GetRequiredService\u0026lt;ISukiToastManager\u0026gt;(), s.GetRequiredService\u0026lt;ISukiDialogManager\u0026gt;() ) { DataContext = s.GetRequiredService\u0026lt;MainWindowViewModel\u0026gt;(), }); collection.AddSingleton\u0026lt;ISukiToastManager\u0026gt;(s =\u0026gt; DialogExManager.GetToastManager()); collection.AddSingleton\u0026lt;ISukiDialogManager\u0026gt;(s =\u0026gt; DialogExManager.GetDialogManager()); } æ³¨å†Œ Redis ç¼“å­˜æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 public static void AddDistributedCache(this IServiceCollection collection) { var connection = ConnectionMultiplexer.Connect(\u0026#34;127.0.0.1:6379\u0026#34;); var redis = connection.GetDatabase(); collection.AddSingleton(redis); collection.AddSingleton(connection); collection.AddSingleton\u0026lt;IDistributedCache, RedisCache\u0026gt;(s =\u0026gt; { return new RedisCache(s.GetRequiredService\u0026lt;IDatabase\u0026gt;()); }); } 4ï¸âƒ£ è¾…åŠ©ç±»ï¼šå¯¹è¯æ¡†ä¸ Toast ç®¡ç†å™¨ 1 2 3 4 5 6 7 8 public static class DialogExManager { private static readonly ISukiToastManager ToastManager = new SukiToastManager(); private static readonly ISukiDialogManager DialogManager = new SukiDialogManager(); public static ISukiToastManager GetToastManager() =\u0026gt; ToastManager; public static ISukiDialogManager GetDialogManager() =\u0026gt; DialogManager; } 5ï¸âƒ£ è§†å›¾å®šä½å™¨ï¼ˆViewLocatorï¼‰ å¦‚æœå¯ç”¨äº† ViewLocatorï¼Œåˆ™ ViewModel ä¸ View å°†è‡ªåŠ¨ç»‘å®šã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 public class ViewLocator : IDataTemplate { public Control? Build(object? param) { if (param is null) return null; var name = param.GetType().FullName!.Replace(\u0026#34;ViewModel\u0026#34;, \u0026#34;View\u0026#34;, StringComparison.Ordinal); var type = Type.GetType(name); return type != null ? (Control)Activator.CreateInstance(type)! : new TextBlock { Text = \u0026#34;Not Found: \u0026#34; + name }; } public bool Match(object? data) { return data is ViewModelBase; } } ğŸ“ å¦‚æœæœªå¯ç”¨ ViewLocatorï¼Œåˆ™éœ€è¦æ‰‹åŠ¨è®¾ç½® DataContextã€‚\nâœ… æ€»ç»“ Avalonia æ˜¯ä¸€ä¸ªå¼ºå¤§çš„è·¨å¹³å° UI æ¡†æ¶ï¼Œç»“åˆ Microsoft.Extensions.DependencyInjection å¯å®ç°é«˜åº¦è§£è€¦å’Œæ¨¡å—åŒ–çš„åº”ç”¨ç¨‹åºæ¶æ„ã€‚é€šè¿‡åˆç†é…ç½®æœåŠ¡ç”Ÿå‘½å‘¨æœŸå’Œä½¿ç”¨è§†å›¾å®šä½å™¨ç­‰æœºåˆ¶ï¼Œå¯ä»¥æ˜¾è‘—æå‡å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚\n","date":"2025-06-04T11:04:44+08:00","image":"https://images.unsplash.com/photo-1649972904349-6e44c42644a7?ixlib=rb-4.0.3\u0026q=85\u0026fm=jpg\u0026crop=entropy\u0026cs=srgb\u0026w=3600","permalink":"https://dumbnessrf.github.io/p/dependency_injection/","title":"Avaloniaä¸­ä½¿ç”¨ä¾èµ–æ³¨å…¥é‡æ„ä»£ç "},{"content":"WPF ä¸­çš„ DataTemplateSelectorï¼šé«˜çº§æ•°æ®æ¨¡æ¿é€‰æ‹©æŠ€å·§ä¸åº”ç”¨ åœ¨ WPFï¼ˆWindows Presentation Foundationï¼‰å¼€å‘ä¸­ï¼ŒDataTemplate æ˜¯æˆ‘ä»¬ç”¨æ¥å®šä¹‰å¦‚ä½•æ˜¾ç¤ºç»‘å®šæ•°æ®çš„é‡è¦å·¥å…·ã€‚ç„¶è€Œï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æ ¹æ®ä¸åŒçš„æ•°æ®å¯¹è±¡åŠ¨æ€åœ°é€‰æ‹©ä¸åŒçš„ DataTemplate æ¥å‘ˆç° UIã€‚è¿™æ—¶ï¼ŒDataTemplateSelector å°±æ´¾ä¸Šç”¨åœºäº†ã€‚\næœ¬æ–‡å°†ä»‹ç»ï¼š\nä»€ä¹ˆæ˜¯ DataTemplateSelector å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ª DataTemplateSelector å®é™…åº”ç”¨åœºæ™¯å’Œä»£ç ç¤ºä¾‹ ä½¿ç”¨æŠ€å·§ä¸æœ€ä½³å®è·µ ä¸€ã€ä»€ä¹ˆæ˜¯ DataTemplateSelectorï¼Ÿ DataTemplateSelector æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒå…è®¸ä½ æ ¹æ®ç»‘å®šé¡¹çš„å†…å®¹æ¥å†³å®šä½¿ç”¨å“ªä¸ª DataTemplateã€‚ä½ å¯ä»¥ç»§æ‰¿è¿™ä¸ªç±»å¹¶é‡å†™å®ƒçš„ SelectTemplate æ–¹æ³•ï¼Œä»è€Œå®ç°è‡ªå®šä¹‰çš„æ¨¡æ¿é€‰æ‹©é€»è¾‘ã€‚\näºŒã€å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ª DataTemplateSelectorï¼Ÿ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚\nç¤ºä¾‹åœºæ™¯ï¼šèŠå¤©æ¶ˆæ¯åˆ—è¡¨ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªèŠå¤©ç¨‹åºï¼Œæ¯æ¡æ¶ˆæ¯å¯èƒ½æ˜¯ç”¨æˆ·å‘é€çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯ç³»ç»Ÿè‡ªåŠ¨å‘é€çš„ã€‚æˆ‘ä»¬æƒ³å¯¹è¿™ä¸¤ç§æ¶ˆæ¯åº”ç”¨ä¸åŒçš„æ ·å¼ã€‚\n1. å®šä¹‰æ•°æ®æ¨¡å‹ 1 2 3 4 5 6 7 8 9 10 11 public class Message { public string Content { get; set; } public MessageType Type { get; set; } } public enum MessageType { User, System } 2. åˆ›å»ºä¸¤ä¸ªä¸åŒçš„ DataTemplate åœ¨ XAML ä¸­å®šä¹‰ä¸¤ç§ä¸åŒé£æ ¼çš„æ¶ˆæ¯æ¨¡æ¿ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;Window.Resources\u0026gt; \u0026lt;!-- ç”¨æˆ·æ¶ˆæ¯æ¨¡æ¿ --\u0026gt; \u0026lt;DataTemplate x:Key=\u0026#34;UserMessageTemplate\u0026#34;\u0026gt; \u0026lt;Border Background=\u0026#34;LightBlue\u0026#34; Padding=\u0026#34;10\u0026#34; Margin=\u0026#34;5\u0026#34;\u0026gt; \u0026lt;TextBlock Text=\u0026#34;{Binding Content}\u0026#34; /\u0026gt; \u0026lt;/Border\u0026gt; \u0026lt;/DataTemplate\u0026gt; \u0026lt;!-- ç³»ç»Ÿæ¶ˆæ¯æ¨¡æ¿ --\u0026gt; \u0026lt;DataTemplate x:Key=\u0026#34;SystemMessageTemplate\u0026#34;\u0026gt; \u0026lt;Border Background=\u0026#34;LightGray\u0026#34; Padding=\u0026#34;10\u0026#34; Margin=\u0026#34;5\u0026#34;\u0026gt; \u0026lt;TextBlock Text=\u0026#34;{Binding Content}\u0026#34; FontStyle=\u0026#34;Italic\u0026#34;/\u0026gt; \u0026lt;/Border\u0026gt; \u0026lt;/DataTemplate\u0026gt; \u0026lt;/Window.Resources\u0026gt; 3. è‡ªå®šä¹‰ DataTemplateSelector 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 public class MessageTemplateSelector : DataTemplateSelector { public DataTemplate UserMessageTemplate { get; set; } public DataTemplate SystemMessageTemplate { get; set; } public override DataTemplate SelectTemplate(object item, DependencyObject container) { if (item is Message message) { switch (message.Type) { case MessageType.User: return UserMessageTemplate; case MessageType.System: return SystemMessageTemplate; } } return base.SelectTemplate(item, container); } } 4. åœ¨ XAML ä¸­æ³¨å†Œå¹¶ä½¿ç”¨ TemplateSelector 1 2 3 4 5 6 7 8 \u0026lt;Window.Resources\u0026gt; \u0026lt;local:MessageTemplateSelector x:Key=\u0026#34;messageTemplateSelector\u0026#34; UserMessageTemplate=\u0026#34;{StaticResource UserMessageTemplate}\u0026#34; SystemMessageTemplate=\u0026#34;{StaticResource SystemMessageTemplate}\u0026#34; /\u0026gt; \u0026lt;/Window.Resources\u0026gt; \u0026lt;ListBox ItemsSource=\u0026#34;{Binding Messages}\u0026#34; ItemTemplateSelector=\u0026#34;{StaticResource messageTemplateSelector}\u0026#34; /\u0026gt; æ³¨æ„ï¼šlocal éœ€è¦å¼•ç”¨ä½ çš„å‘½åç©ºé—´ï¼Œä¾‹å¦‚ï¼š\n1 2 \u0026lt;Window xmlns:local=\u0026#34;clr-namespace:YourNamespace\u0026#34; ... ä¸‰ã€åº”ç”¨åœºæ™¯ä¸¾ä¾‹ åœºæ™¯ 1ï¼šå¤šç±»å‹åˆ—è¡¨å±•ç¤ºï¼ˆå¦‚æ–°é—»ã€é€šçŸ¥ã€è®¢å•ç­‰æ··åˆå±•ç¤ºï¼‰ ä½ å¯ä»¥ä¸ºä¸åŒç±»å‹çš„æ•°æ®é¡¹é€‰æ‹©ä¸åŒçš„æ¨¡æ¿ï¼Œä½¿å¾—åŒä¸€ä¸ªåˆ—è¡¨ä¸­èƒ½å±•ç¤ºå¤šç§ç»“æ„ä¸åŒçš„ä¿¡æ¯ã€‚\nåœºæ™¯ 2ï¼šUI ä¸»é¢˜æˆ–çŠ¶æ€å˜åŒ– æ ¹æ®å¯¹è±¡çš„çŠ¶æ€ï¼ˆå¦‚â€œå·²è¯»â€ã€â€œæœªè¯»â€ã€â€œé”™è¯¯â€ç­‰ï¼‰åˆ‡æ¢ä¸åŒçš„ UI æ ·å¼ã€‚\nåœºæ™¯ 3ï¼šä¸ªæ€§åŒ–å†…å®¹å±•ç¤º æ¯”å¦‚åœ¨ä¸€ä¸ªè®ºå›åº”ç”¨ä¸­ï¼Œå¸–å­ä½œè€…ã€ç®¡ç†å‘˜ã€æ™®é€šç”¨æˆ·çš„å‘è¨€éœ€è¦ä¸åŒé¢œè‰²æˆ–å›¾æ ‡æ ‡è¯†ã€‚\nå››ã€ä½¿ç”¨æŠ€å·§ä¸æœ€ä½³å®è·µ âœ… æŠ€å·§ 1ï¼šä¿æŒ TemplateSelector çš„å¯å¤ç”¨æ€§ ç›®æ ‡ï¼š è®¾è®¡ä¸€ä¸ªé€šç”¨çš„ DataTemplateSelectorï¼Œå¯ä»¥é€šè¿‡ä¾èµ–å±æ€§ä¼ å…¥æ¨¡æ¿ï¼Œæé«˜ç»„ä»¶å¤ç”¨æ€§ã€‚\nå®ç°ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 public class ReusableTemplateSelector : DataTemplateSelector { public DataTemplate DefaultTemplate { get; set; } public DataTemplate AlternateTemplate { get; set; } public override DataTemplate SelectTemplate(object item, DependencyObject container) { if (item is ICustomType customItem \u0026amp;\u0026amp; customItem.IsSpecial) { return AlternateTemplate; } return DefaultTemplate ?? base.SelectTemplate(item, container); } } // æ¥å£ç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¯â€œç‰¹æ®Šç±»å‹â€ public interface ICustomType { bool IsSpecial { get; } } ä½¿ç”¨ XAMLï¼š 1 2 3 \u0026lt;local:ReusableTemplateSelector x:Key=\u0026#34;reusableSelector\u0026#34; DefaultTemplate=\u0026#34;{StaticResource NormalTemplate}\u0026#34; AlternateTemplate=\u0026#34;{StaticResource SpecialTemplate}\u0026#34; /\u0026gt; åº”ç”¨åœºæ™¯ï¼š å¤šä¸ªé¡µé¢ä¸­é‡å¤ä½¿ç”¨åŒä¸€ä¸ªé€‰æ‹©å™¨ã€‚ ä¸åŒä¸šåŠ¡é€»è¾‘ä¸‹åªéœ€æ›´æ¢ç»‘å®šçš„ DataTemplateã€‚ âœ… æŠ€å·§ 2ï¼šç»“åˆ MVVM æ¨¡å¼ä½¿ç”¨ ç›®æ ‡ï¼š åœ¨ MVVM æ¶æ„ä¸­ä½¿ç”¨ DataTemplateSelectorï¼Œå°† UI å±•ç¤ºä¸æ•°æ®åˆ†ç¦»ã€‚\nå®ç°ï¼š ViewModel ç¤ºä¾‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 public class MessageViewModel : INotifyPropertyChanged { public string Content { get; set; } public MessageType Type { get; set; } // User / System } public enum MessageType { User, System } è‡ªå®šä¹‰ Selectorï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 public class MessageTypeSelector : DataTemplateSelector { public DataTemplate UserTemplate { get; set; } public DataTemplate SystemTemplate { get; set; } public override DataTemplate SelectTemplate(object item, DependencyObject container) { if (item is MessageViewModel msg) { return msg.Type == MessageType.User ? UserTemplate : SystemTemplate; } return base.SelectTemplate(item, container); } } XAML ä¸­ç»‘å®šï¼š 1 2 \u0026lt;ListBox ItemsSource=\u0026#34;{Binding Messages}\u0026#34; ItemTemplateSelector=\u0026#34;{StaticResource messageTypeSelector}\u0026#34; /\u0026gt; ä¼˜åŠ¿ï¼š å®Œå…¨è§£è€¦ View å’Œ ViewModelã€‚ æ˜“äºç»´æŠ¤å’Œæµ‹è¯•ã€‚ âœ… æŠ€å·§ 3ï¼šé¿å…è¿‡åº¦å¤æ‚çš„é€»è¾‘ ç›®æ ‡ï¼š ç¡®ä¿ SelectTemplate æ–¹æ³•é€»è¾‘ç®€æ´ï¼Œä¸åµŒå¥—å¤æ‚åˆ¤æ–­ã€‚\nåé¢ä¾‹å­ï¼ˆä¸æ¨èï¼‰ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 public override DataTemplate SelectTemplate(...) { if (item is Order o) { if (o.Status == \u0026#34;Pending\u0026#34;) { if (o.CustomerLevel == \u0026#34;VIP\u0026#34;) return VipPendingTemplate; else return PendingTemplate; } else if (o.Status == \u0026#34;Completed\u0026#34;) { ... } } } æ”¹è¿›æ–¹å¼ï¼š ä½¿ç”¨ç­–ç•¥æ¨¡å¼æˆ–çŠ¶æ€æšä¸¾æ˜ å°„ 1 2 3 4 5 6 7 8 9 10 11 12 13 public class OrderTemplateSelector : DataTemplateSelector { public Dictionary\u0026lt;OrderState, DataTemplate\u0026gt; Templates { get; } = new(); public override DataTemplate SelectTemplate(object item, DependencyObject container) { if (item is Order order) { return Templates.GetValueOrDefault(order.State); } return base.SelectTemplate(item, container); } } XAML é…ç½®ï¼š 1 2 3 4 5 6 \u0026lt;local:OrderTemplateSelector x:Key=\u0026#34;orderSelector\u0026#34;\u0026gt; \u0026lt;local:OrderTemplateSelector.Templates\u0026gt; \u0026lt;Component:TemplateMapEntry Key=\u0026#34;Pending\u0026#34; Value=\u0026#34;{StaticResource PendingTemplate}\u0026#34; /\u0026gt; \u0026lt;Component:TemplateMapEntry Key=\u0026#34;Completed\u0026#34; Value=\u0026#34;{StaticResource CompletedTemplate}\u0026#34; /\u0026gt; \u0026lt;/local:OrderTemplateSelector.Templates\u0026gt; \u0026lt;/local:OrderTemplateSelector\u0026gt; ğŸ’¡ æ³¨ï¼šä½ å¯ä»¥è‡ªå®šä¹‰ TemplateMapEntry ç±»å‹æ¥æ”¯æŒè¿™ç§å­—å…¸ç»“æ„ã€‚\nâœ… æŠ€å·§ 4ï¼šè°ƒè¯•æ—¶æ³¨æ„ Binding ä¸Šä¸‹æ–‡é—®é¢˜ å¸¸è§é”™è¯¯ï¼š åœ¨ SelectTemplate ä¸­è·å–ä¸åˆ°æ­£ç¡®å¯¹è±¡ã€‚ ç»‘å®šè·¯å¾„é”™è¯¯å¯¼è‡´æ— æ³•è¯†åˆ«ç±»å‹ã€‚ è§£å†³æ–¹æ³•ï¼š ç¡®ä¿ç»‘å®šä¸Šä¸‹æ–‡æ­£ç¡® 1 2 \u0026lt;ListBox ItemsSource=\u0026#34;{Binding MyItems}\u0026#34; ItemTemplateSelector=\u0026#34;{StaticResource mySelector}\u0026#34; /\u0026gt; ç¡®ä¿ MyItems æ˜¯ IEnumerable\u0026lt;T\u0026gt;ï¼Œä¸”æ¯ä¸€é¡¹ç±»å‹éƒ½èƒ½è¢«è¯†åˆ«ã€‚\næ·»åŠ æ—¥å¿—è¾…åŠ©è°ƒè¯•ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 public override DataTemplate SelectTemplate(object item, DependencyObject container) { if (item == null) { Debug.WriteLine(\u0026#34;Item is null\u0026#34;); return base.SelectTemplate(item, container); } Debug.WriteLine($\u0026#34;Item type: {item.GetType().Name}\u0026#34;); if (item is CustomType ct) { return ct.IsSpecial ? SpecialTemplate : NormalTemplate; } return base.SelectTemplate(item, container); } äº”ã€æ€»ç»“ DataTemplateSelector æ˜¯ WPF ä¸­éå¸¸å¼ºå¤§ä¸”çµæ´»çš„åŠŸèƒ½ï¼Œå®ƒå¸®åŠ©æˆ‘ä»¬å®ç°äº†æ•°æ®é©±åŠ¨çš„ UI æ¨¡æ¿é€‰æ‹©ã€‚æ— è®ºæ˜¯æ„å»ºå¤æ‚çš„ UI åˆ—è¡¨è¿˜æ˜¯å®ç°é«˜åº¦å®šåˆ¶åŒ–çš„å±•ç¤ºé€»è¾‘ï¼ŒDataTemplateSelector éƒ½æ˜¯ä¸€ä¸ªå€¼å¾—æŒæ¡çš„æŠ€èƒ½ã€‚\n","date":"2025-05-30T14:46:48+08:00","image":"https://www.notion.so/images/page-cover/nasa_new_york_city_grid.jpg","permalink":"https://dumbnessrf.github.io/p/data-template-selector-tips/","title":"WPFæŠ€å·§-æ•°æ®æ¨¡æ¿åŠ¨æ€é€‰æ‹©"},{"content":"è§£é”.NET æ–°å§¿åŠ¿ï¼šåŸºäºæ–‡ä»¶çš„ç¨‹åºç‰¹æ€§æ·±åº¦è§£æä¸å®æˆ˜ åœ¨.NET çš„ä¸–ç•Œé‡Œï¼Œæ–°é¡¹ç›®çš„åˆ›å»ºå’Œè¿è¡Œå¾€å¾€ç¦»ä¸å¼€.csprojé¡¹ç›®æ–‡ä»¶ï¼Œä»ç¼–å†™ä»£ç åˆ°è°ƒè¯•è¿è¡Œï¼Œéœ€è¦ä¸€ç³»åˆ—ç¹ççš„æ­¥éª¤ã€‚ä½†éšç€.NET æŠ€æœ¯çš„ä¸æ–­æ¼”è¿›ï¼ŒåŸºäºæ–‡ä»¶çš„ç¨‹åºï¼ˆFile-based programsï¼‰ è¿™ä¸€æ–°ç‰¹æ€§çš„å‡ºç°ï¼Œæ‰“ç ´äº†è¿™ä¸€ä¼ ç»Ÿæ¨¡å¼ï¼Œä¸ºå¼€å‘è€…å¸¦æ¥äº†æ›´åŠ ä¾¿æ·ã€é«˜æ•ˆçš„å¼€å‘ä½“éªŒã€‚\nåŸºäºæ–‡ä»¶çš„ç¨‹åºç‰¹æ€§æ¦‚è¿° åŸºäºæ–‡ä»¶çš„ç¨‹åºï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å°†éƒ¨åˆ† MSBuild é¡¹ç›®åŠŸèƒ½åµŒå…¥åˆ° C# ä»£ç ä¸­ï¼Œå…è®¸å¼€å‘è€…ç›´æ¥è¿è¡Œå•ä¸ª C# æ–‡ä»¶ï¼Œå°±åƒè¿è¡Œä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ä¸€æ ·ã€‚åœ¨ä»¥å¾€ï¼Œè¿è¡Œ C# ä»£ç é€šå¸¸éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œç¼–å†™ .csproj æ–‡ä»¶æ¥é…ç½®é¡¹ç›®çš„å„ç§å±æ€§ï¼Œå¦‚å¼•ç”¨çš„åŒ…ã€ç›®æ ‡æ¡†æ¶ç­‰ã€‚è€ŒåŸºäºæ–‡ä»¶çš„ç¨‹åºåˆ™æ— éœ€è¿™äº›å¤æ‚çš„æ“ä½œï¼Œå®ƒé€šè¿‡åœ¨ C# æºæ–‡ä»¶ä¸­æ·»åŠ ç‰¹æ®Šçš„ #: æŒ‡ä»¤ï¼Œåœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ª â€œè™šæ‹Ÿé¡¹ç›®â€ï¼Œç„¶åå°†è¿™ä¸ª â€œè™šæ‹Ÿé¡¹ç›®â€ ä¼ é€’ç»™ MSBuild è¿›è¡Œæ„å»ºå’Œè¿è¡Œã€‚\nå…¶èƒŒåçš„è¿è¡Œæœºåˆ¶æ˜¯ï¼šå½“ä½¿ç”¨ dotnet run å‘½ä»¤è¿è¡Œä¸€ä¸ª C# æ–‡ä»¶æ—¶ï¼Œå‘½ä»¤è¡Œä¼šè§£ææºæ–‡ä»¶ä¸­çš„ #: æŒ‡ä»¤ï¼Œæ ¹æ®è¿™äº›æŒ‡ä»¤åœ¨å†…å­˜ä¸­æ„å»ºä¸€ä¸ª C# é¡¹ç›® XML æ–‡æ¡£ï¼Œè¿™ä¸ªæ–‡æ¡£å°±ç›¸å½“äºä¸€ä¸ªå¸¸è§„é¡¹ç›®çš„ .csproj æ–‡ä»¶ã€‚éšåï¼ŒMSBuild ä¼šåŸºäºè¿™ä¸ªå†…å­˜ä¸­çš„é¡¹ç›®æ–‡æ¡£è¿›è¡Œç¼–è¯‘å’Œè¿è¡Œï¼Œä½¿å¾—å•ä¸ªæ–‡ä»¶èƒ½å¤Ÿåƒå®Œæ•´é¡¹ç›®ä¸€æ ·æ‰§è¡Œ ã€‚\nåº”ç”¨ç¤ºä¾‹è¯¦è§£ ç¤ºä¾‹ 1ï¼šç»å…¸ Hello World 1 2 3 // HelloWorld.cs #:r \u0026#34;System.Net.Http\u0026#34; Console.WriteLine(\u0026#34;Hello, World!\u0026#34;); åœ¨è¿™ä¸ªç®€å•ç¤ºä¾‹ä¸­ï¼Œ#:r \u0026quot;System.Net.Http\u0026quot; æ˜¯ä¸€ä¸ª #: æŒ‡ä»¤ï¼Œå®ƒç”¨äºå¼•ç”¨ System.Net.Http ç¨‹åºé›†ã€‚è™½ç„¶ä»£ç ä¸­æ²¡æœ‰ä¼ ç»Ÿçš„é¡¹ç›®æ–‡ä»¶é…ç½®ï¼Œä½†é€šè¿‡è¿™æ¡æŒ‡ä»¤ï¼Œæˆ‘ä»¬ä¸ºç¨‹åºæ·»åŠ äº†æ‰€éœ€çš„å¼•ç”¨ã€‚åœ¨å‘½ä»¤è¡Œä¸­è¿›å…¥è¯¥æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œæ‰§è¡Œ dotnet run HelloWorld.csï¼Œå°±èƒ½çœ‹åˆ°ç†Ÿæ‚‰çš„ â€œHello, World!â€ è¾“å‡ºã€‚è¿™å±•ç¤ºäº†åŸºäºæ–‡ä»¶çš„ç¨‹åºæœ€åŸºç¡€çš„è¿è¡Œæ–¹å¼ï¼Œä»…éœ€ä¸€ä¸ª C# æ–‡ä»¶å’Œç®€å•æŒ‡ä»¤ï¼Œå³å¯å¿«é€Ÿè¿è¡Œä»£ç ã€‚\nç¤ºä¾‹ 2ï¼šå¼•ç”¨å¤–éƒ¨ NuGet åŒ… 1 2 3 4 5 6 7 8 9 10 11 12 13 // NewtonsoftJsonExample.cs #:package Newtonsoft.Json 13.0.1 using Newtonsoft.Json; class Program { static void Main() { var person = new { Name = \u0026#34;Alice\u0026#34;, Age = 30 }; var json = JsonConvert.SerializeObject(person); Console.WriteLine(json); } } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ#:package Newtonsoft.Json 13.0.1 æŒ‡ä»¤ç”¨äºå¼•å…¥ Newtonsoft.Json åŒ…åŠå…¶æŒ‡å®šç‰ˆæœ¬ã€‚å¼•å…¥åï¼Œä»£ç ä¸­å°±èƒ½ä½¿ç”¨ Newtonsoft.Json æä¾›çš„åŠŸèƒ½ï¼Œå¦‚å°†å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ã€‚è¿è¡Œæ—¶ï¼Œdotnet run å‘½ä»¤ä¼šæ ¹æ®è¯¥æŒ‡ä»¤è‡ªåŠ¨ä¸‹è½½å¹¶å¼•ç”¨æ‰€éœ€çš„ NuGet åŒ…ï¼Œæ— éœ€æ‰‹åŠ¨åœ¨é¡¹ç›®æ–‡ä»¶ä¸­æ·»åŠ åŒ…å¼•ç”¨ï¼Œæå¤§åœ°ç®€åŒ–äº†ä½¿ç”¨å¤–éƒ¨åŒ…çš„æµç¨‹ ã€‚\nç¤ºä¾‹ 3ï¼šå¤šæ–‡ä»¶åä½œ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„æ•°å­¦è®¡ç®—é¡¹ç›®ï¼ŒåŒ…å«ä¸¤ä¸ªæ–‡ä»¶ï¼šCalculator.cs å’Œ Program.csã€‚\nCalculator.cs æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 // Calculator.cs namespace MathUtils { public static class Calculator { public static int Add(int a, int b) { return a + b; } } } Program.cs æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 // Program.cs #:r \u0026#34;System.Net.Http\u0026#34; using MathUtils; class Program { static void Main() { int result = Calculator.Add(5, 3); Console.WriteLine($\u0026#34;The result of addition is: {result}\u0026#34;); } } åœ¨åŸºäºæ–‡ä»¶çš„ç¨‹åºä¸­ï¼Œæ— éœ€æ‰‹åŠ¨åœ¨é¡¹ç›®æ–‡ä»¶ä¸­é…ç½®æ–‡ä»¶å¼•ç”¨å…³ç³»ã€‚å½“ä½¿ç”¨ dotnet run Program.cs å‘½ä»¤è¿è¡Œæ—¶ï¼ŒSDK CLI ä¼šè‡ªåŠ¨è§£æ Program.cs æ‰€åœ¨ç›®å½•æ ‘ä¸­çš„æ‰€æœ‰ .cs æ–‡ä»¶ï¼Œå°† Calculator.cs åŒ…å«åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œä½¿å¾—ä¸åŒæ–‡ä»¶ä¹‹é—´èƒ½å¤Ÿé¡ºåˆ©åä½œï¼Œå®ç°å¤æ‚çš„åŠŸèƒ½ ã€‚\nä¸ä¼ ç»Ÿé¡¹ç›®æ¨¡å¼çš„å¯¹æ¯”ä¼˜åŠ¿ é™ä½å…¥é—¨é—¨æ§›\nå¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œä¼ ç»Ÿçš„ .csproj é¡¹ç›®æ–‡ä»¶é…ç½®å¤æ‚ï¼ŒåŒ…å«ä¼—å¤šå±æ€§å’ŒèŠ‚ç‚¹ï¼Œå®¹æ˜“è®©æ–°æ‰‹æ„Ÿåˆ°å›°æƒ‘ã€‚è€ŒåŸºäºæ–‡ä»¶çš„ç¨‹åºæ¨¡å¼ï¼Œåªéœ€å…³æ³¨ä»£ç æœ¬èº«å’Œç®€å•çš„ #: æŒ‡ä»¤ï¼Œæ— éœ€æ·±å…¥äº†è§£é¡¹ç›®æ–‡ä»¶é…ç½®ï¼Œèƒ½å¤Ÿæ›´å¿«åœ°ç¼–å†™å’Œè¿è¡Œä»£ç ï¼Œé™ä½äº†å­¦ä¹ æˆæœ¬ã€‚\nå¿«é€ŸåŸå‹å¼€å‘\nåœ¨å¼€å‘åˆæœŸè¿›è¡ŒåŸå‹è®¾è®¡æ—¶ï¼Œå¾€å¾€éœ€è¦å¿«é€ŸéªŒè¯æƒ³æ³•å’ŒåŠŸèƒ½ã€‚åŸºäºæ–‡ä»¶çš„ç¨‹åºæ— éœ€åˆ›å»ºå®Œæ•´é¡¹ç›®ç»“æ„ï¼Œç›´æ¥ç¼–å†™å•ä¸ªæ–‡ä»¶å¹¶è¿è¡Œï¼Œèƒ½å¤Ÿå¤§å¤§æé«˜å¼€å‘æ•ˆç‡ï¼Œå¿«é€Ÿè¿­ä»£åŸå‹ã€‚\nç®€åŒ–å°å‹å·¥å…·å¼€å‘\nå¯¹äºä¸€äº›ç®€å•çš„å°å‹å·¥å…·æˆ–è„šæœ¬ï¼Œä½¿ç”¨ä¼ ç»Ÿé¡¹ç›®æ¨¡å¼æ˜¾å¾—è¿‡äºç¹çã€‚åŸºäºæ–‡ä»¶çš„ç¨‹åºå¯ä»¥ç”¨æœ€å°‘çš„é…ç½®å’Œæ­¥éª¤å®ç°åŠŸèƒ½ï¼Œä½¿ä»£ç æ›´åŠ ç®€æ´ã€è½»ä¾¿ï¼Œä¾¿äºç»´æŠ¤å’Œç®¡ç†ã€‚\nä½¿ç”¨æ³¨æ„äº‹é¡¹ è™½ç„¶åŸºäºæ–‡ä»¶çš„ç¨‹åºå¸¦æ¥äº†è¯¸å¤šä¾¿åˆ©ï¼Œä½†åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¹Ÿæœ‰ä¸€äº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š\nç›®å‰åŸºäºæ–‡ä»¶çš„ç¨‹åºåœ¨åŠŸèƒ½ä¸Šè¿˜å­˜åœ¨ä¸€å®šé™åˆ¶ï¼Œä¾‹å¦‚å¯¹æŸäº›å¤æ‚çš„é¡¹ç›®é…ç½®å’Œæ„å»ºè‡ªå®šä¹‰æ”¯æŒä¸å¤Ÿå®Œå–„ã€‚ ç”±äºå…¶ä¾èµ–äº #: æŒ‡ä»¤æ¥é…ç½®é¡¹ç›®å±æ€§ï¼ŒæŒ‡ä»¤çš„è¯­æ³•å’Œä½¿ç”¨è§„åˆ™éœ€è¦å¼€å‘è€…ç†Ÿç»ƒæŒæ¡ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°å¼•ç”¨é”™è¯¯æˆ–æ„å»ºå¤±è´¥ç­‰é—®é¢˜ã€‚ åœ¨å›¢é˜Ÿåä½œå¼€å‘ä¸­ï¼ŒåŸºäºæ–‡ä»¶çš„ç¨‹åºå¯èƒ½ä¼šå› ä¸ºæˆå‘˜ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„ .NET SDK è€Œå¯¼è‡´è¿è¡Œç»“æœä¸ä¸€è‡´ï¼Œéœ€è¦ç»Ÿä¸€å¼€å‘ç¯å¢ƒã€‚ ä»¥ä¸Šå°±æ˜¯å¯¹ .NET åŸºäºæ–‡ä»¶çš„ç¨‹åºç‰¹æ€§çš„è¯¦ç»†ä»‹ç»å’Œåº”ç”¨ç¤ºä¾‹ã€‚è¿™ä¸€ç‰¹æ€§ä¸ºå¼€å‘è€…æä¾›äº†æ›´çµæ´»é«˜æ•ˆçš„å¼€å‘æ–¹å¼ï¼Œæ— è®ºæ˜¯åˆå­¦è€…å¿«é€Ÿä¸Šæ‰‹ï¼Œè¿˜æ˜¯ç»éªŒä¸°å¯Œçš„å¼€å‘è€…è¿›è¡Œå¿«é€Ÿå¼€å‘ï¼Œéƒ½èƒ½å‘æŒ¥é‡è¦ä½œç”¨ã€‚ä¸å¦¨äº²è‡ªå°è¯•ï¼Œæ„Ÿå—å®ƒå¸¦æ¥çš„ä¾¿æ·ï¼å¦‚æœä½ åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æœ‰æ–°çš„å‘ç°æˆ–é‡åˆ°é—®é¢˜ï¼Œæ¬¢è¿ä¸€èµ·äº¤æµæ¢è®¨ã€‚\n","date":"2025-05-29T11:04:44+08:00","image":"https://www.notion.so/images/page-cover/rijksmuseum_mignons_1660.jpg","permalink":"https://dumbnessrf.github.io/p/single-file-run/","title":"å•æ–‡ä»¶è¿è¡ŒC#ä»£ç "}]