[{"content":"ğŸ§µ .NET å¹¶å‘ç¼–ç¨‹åˆ©å™¨è¯¦è§£ é™„ï¼švolatile ä¸ Interlocked åœ¨å¹¶å‘æ§åˆ¶ä¸­çš„å…³é”®ä½œç”¨\nğŸ“Œ å¼•è¨€ï¼šä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘é›†åˆï¼Ÿ åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¤šä¸ªçº¿ç¨‹å®‰å…¨åœ°å…±äº«æ•°æ® â€”â€” æ¯”å¦‚ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ã€ä»»åŠ¡é˜Ÿåˆ—ã€ç¼“å­˜å­—å…¸ã€é™æµæ§åˆ¶ç­‰ã€‚å¦‚æœä½¿ç”¨æ™®é€šé›†åˆï¼ˆå¦‚ List\u0026lt;T\u0026gt;ã€Queue\u0026lt;T\u0026gt;ã€Dictionary\u0026lt;TKey, TValue\u0026gt;ï¼‰ï¼Œåœ¨å¹¶å‘è¯»å†™æ—¶ææ˜“å¼•å‘ï¼š\nâŒ æ•°æ®ç«äº‰ï¼ˆRace Conditionï¼‰ âŒ é›†åˆå†…éƒ¨ç»“æ„æŸåï¼ˆå¦‚å“ˆå¸Œè¡¨ rehash æ—¶è¢«å¤šçº¿ç¨‹ä¿®æ”¹ï¼‰ âŒ ç¨‹åºå´©æºƒæˆ–æ•°æ®ä¸ä¸€è‡´ .NET æä¾›äº† System.Collections.Concurrent å‘½åç©ºé—´ä¸‹çš„çº¿ç¨‹å®‰å…¨é›†åˆç±»ï¼Œä¸“ä¸ºé«˜å¹¶å‘åœºæ™¯è®¾è®¡ï¼Œæ— éœ€æ‰‹åŠ¨åŠ é”å³å¯å®‰å…¨ä½¿ç”¨ã€‚\næœ¬æ–‡å°†æ·±å…¥è®²è§£ï¼š\nâœ… ConcurrentQueue\u0026lt;T\u0026gt;ã€ConcurrentStack\u0026lt;T\u0026gt;ã€ConcurrentDictionary\u0026lt;TKey, TValue\u0026gt; âœ… BlockingCollection\u0026lt;T\u0026gt; ä¸å®ƒä»¬çš„å…³ç³» âœ… SemaphoreSlim å¦‚ä½•æ§åˆ¶å¹¶å‘åº¦ âœ… volatile ä¸ Interlocked åœ¨å¹¶å‘ç¼–ç¨‹ä¸­çš„å…³é”®ä½œç”¨ âœ… å®æˆ˜ç¤ºä¾‹ + æœ€ä½³å®è·µ ğŸ§© ä¸€ã€ä¸‰å¤§åŸºç¡€å¹¶å‘é›†åˆ 1. ConcurrentQueue\u0026lt;T\u0026gt; â€”â€” çº¿ç¨‹å®‰å…¨çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ— ç‰¹ç‚¹ï¼š\nFIFOï¼ˆFirst In, First Outï¼‰ æ— é”æˆ–ç»†ç²’åº¦é”å®ç°ï¼Œé«˜æ€§èƒ½ æ”¯æŒå¤šç”Ÿäº§è€…å¤šæ¶ˆè´¹è€… å¸¸ç”¨æ–¹æ³•ï¼š\nEnqueue(T item) â€” å…¥é˜Ÿ TryDequeue(out T result) â€” å‡ºé˜Ÿï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ IsEmpty â€” æ˜¯å¦ä¸ºç©ºï¼ˆæ³¨æ„ï¼šå¯èƒ½ç¬æ—¶ä¸å‡†ï¼Œä»…ä½œå‚è€ƒï¼‰ ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 var queue = new ConcurrentQueue\u0026lt;int\u0026gt;(); // ç”Ÿäº§è€…çº¿ç¨‹ Task.Run(() =\u0026gt; { for (int i = 1; i \u0026lt;= 5; i++) { queue.Enqueue(i); Console.WriteLine($\u0026#34;ç”Ÿäº§: {i}\u0026#34;); Thread.Sleep(100); } }); // æ¶ˆè´¹è€…çº¿ç¨‹ Task.Run(() =\u0026gt; { while (true) { if (queue.TryDequeue(out var item)) { Console.WriteLine($\u0026#34;æ¶ˆè´¹: {item}\u0026#34;); } else if (queue.IsEmpty) break; // æ³¨æ„ï¼šæ­¤å¤„å¯èƒ½æœ‰ç«æ€ï¼Œä»…æ¼”ç¤º Thread.Sleep(50); } }); Thread.Sleep(2000); âœ… é€‚ç”¨åœºæ™¯ï¼šä»»åŠ¡é˜Ÿåˆ—ã€æ¶ˆæ¯ç¼“å†²ã€æ—¥å¿—æ”¶é›†ç­‰\n2. ConcurrentStack\u0026lt;T\u0026gt; â€”â€” çº¿ç¨‹å®‰å…¨çš„åè¿›å…ˆå‡ºæ ˆ ç‰¹ç‚¹ï¼š\nLIFOï¼ˆLast In, First Outï¼‰ åŒæ ·æ”¯æŒå¤šç”Ÿäº§è€…å¤šæ¶ˆè´¹è€… å¸¸ç”¨æ–¹æ³•ï¼š\nPush(T item) â€” å‹æ ˆ TryPop(out T result) â€” å¼¹æ ˆ ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 var stack = new ConcurrentStack\u0026lt;int\u0026gt;(); Task.Run(() =\u0026gt; { for (int i = 1; i \u0026lt;= 3; i++) { stack.Push(i); Console.WriteLine($\u0026#34;å‹æ ˆ: {i}\u0026#34;); } }); Task.Run(() =\u0026gt; { while (stack.TryPop(out var item)) { Console.WriteLine($\u0026#34;å¼¹æ ˆ: {item}\u0026#34;); Thread.Sleep(100); } }); Thread.Sleep(1000); âœ… é€‚ç”¨åœºæ™¯ï¼šæ’¤é”€æ“ä½œæ ˆã€å¯¹è±¡æ± ã€æ·±åº¦ä¼˜å…ˆéå†ç¼“å†²\n3. ConcurrentDictionary\u0026lt;TKey, TValue\u0026gt; â€”â€” çº¿ç¨‹å®‰å…¨å­—å…¸ ç‰¹ç‚¹ï¼š\nå†…éƒ¨ä½¿ç”¨åˆ†æ®µé”æˆ–æ— é”ç»“æ„ï¼ˆ.NET Core åä¼˜åŒ–æä½³ï¼‰ æ”¯æŒåŸå­æ“ä½œï¼šAddOrUpdate, GetOrAdd å¸¸ç”¨æ–¹æ³•ï¼š\n1 2 3 4 5 6 7 var cache = new ConcurrentDictionary\u0026lt;string, string\u0026gt;(); // çº¿ç¨‹å®‰å…¨æ·»åŠ æˆ–è·å– var value = cache.GetOrAdd(\u0026#34;key\u0026#34;, k =\u0026gt; ComputeExpensiveValue(k)); // çº¿ç¨‹å®‰å…¨æ›´æ–° cache.AddOrUpdate(\u0026#34;counter\u0026#34;, 1, (key, oldValue) =\u0026gt; oldValue + 1); å®Œæ•´ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 var dict = new ConcurrentDictionary\u0026lt;string, int\u0026gt;(); Parallel.For(0, 1000, i =\u0026gt; { dict.AddOrUpdate(\u0026#34;count\u0026#34;, 1, (key, old) =\u0026gt; old + 1); }); Console.WriteLine($\u0026#34;æœ€ç»ˆè®¡æ•°: {dict[\u0026#34;count\u0026#34;]}\u0026#34;); // è¾“å‡ºï¼š1000ï¼ˆçº¿ç¨‹å®‰å…¨ç´¯åŠ ï¼‰ âœ… é€‚ç”¨åœºæ™¯ï¼šç¼“å­˜ã€è®¡æ•°å™¨ã€å…±äº«çŠ¶æ€å­˜å‚¨\nğŸš¦ äºŒã€BlockingCollection â€”â€” å¹¶å‘é›†åˆçš„â€œå¢å¼ºåŒ…è£…å™¨â€ â–¶ å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ BlockingCollection\u0026lt;T\u0026gt; ä¸æ˜¯ä¸€ä¸ªæ–°çš„é›†åˆï¼Œè€Œæ˜¯ä¸€ä¸ªåŒ…è£…å™¨ï¼Œå®ƒä¸º IProducerConsumerCollection\u0026lt;T\u0026gt;ï¼ˆå¦‚ ConcurrentQueue\u0026lt;T\u0026gt;ï¼‰æ·»åŠ äº†ï¼š\nâœ… é˜»å¡æ“ä½œï¼ˆTake() ä¼šé˜»å¡ç›´åˆ°æœ‰æ•°æ®ï¼‰ âœ… é™ç•Œå®¹é‡ï¼ˆBounded Capacityï¼‰ âœ… å®Œæˆæ ‡è®°ï¼ˆCompleteAdding()ï¼‰ âœ… æšä¸¾æ”¯æŒï¼ˆGetConsumingEnumerable()ï¼‰ â–¶ ä¸ä¸‰å¤§é›†åˆçš„å…³ç³» åº•å±‚é›†åˆ è¡Œä¸º ConcurrentQueue\u0026lt;T\u0026gt; FIFO é˜»å¡é˜Ÿåˆ—ï¼ˆé»˜è®¤ï¼‰ ConcurrentStack\u0026lt;T\u0026gt; LIFO é˜»å¡æ ˆ ConcurrentBag\u0026lt;T\u0026gt; æ— åºé«˜æ€§èƒ½é˜»å¡åŒ… â–¶ ç¤ºä¾‹ï¼šç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼ˆæ¨èå†™æ³•ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 var blockingCollection = new BlockingCollection\u0026lt;int\u0026gt;(new ConcurrentQueue\u0026lt;int\u0026gt;(), 10); // æœ€å¤§å®¹é‡10 // ç”Ÿäº§è€… Task.Run(() =\u0026gt; { for (int i = 1; i \u0026lt;= 20; i++) { blockingCollection.Add(i); // å¦‚æœæ»¡äº†ï¼Œä¼šé˜»å¡ Console.WriteLine($\u0026#34;ç”Ÿäº§: {i}\u0026#34;); Thread.Sleep(100); } blockingCollection.CompleteAdding(); // æ ‡è®°å®Œæˆ }); // æ¶ˆè´¹è€… Task.Run(() =\u0026gt; { foreach (var item in blockingCollection.GetConsumingEnumerable()) { Console.WriteLine($\u0026#34;æ¶ˆè´¹: {item}\u0026#34;); Thread.Sleep(200); // æ¨¡æ‹Ÿå¤„ç†æ—¶é—´ } }); Thread.Sleep(5000); âœ… é€‚ç”¨åœºæ™¯ï¼šä»»åŠ¡è°ƒåº¦ã€æ•°æ®æµæ°´çº¿ã€é™æµç¼“å†²åŒº\nğŸ’¡ BlockingCollection\u0026lt;T\u0026gt; é»˜è®¤æœ‰åºï¼ˆFIFOï¼‰ï¼Œå› ä¸ºé»˜è®¤åŒ…è£… ConcurrentQueue\u0026lt;T\u0026gt;\nğŸš§ ä¸‰ã€SemaphoreSlim â€”â€” æ§åˆ¶å¹¶å‘è®¿é—®æ•°é‡ â–¶ å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ SemaphoreSlim æ˜¯ä¸€ä¸ªè½»é‡çº§ä¿¡å·é‡ï¼Œç”¨äºé™åˆ¶åŒæ—¶è®¿é—®æŸèµ„æºçš„çº¿ç¨‹æ•°é‡ã€‚\nä¸æ˜¯é›†åˆï¼Œè€Œæ˜¯å¹¶å‘æ§åˆ¶åŸè¯­ã€‚\nâ–¶ å¸¸ç”¨æ–¹æ³•ï¼š Wait() / WaitAsync() â€” è·å–è®¸å¯è¯ Release() â€” é‡Šæ”¾è®¸å¯è¯ CurrentCount â€” å‰©ä½™è®¸å¯è¯æ•° â–¶ ç¤ºä¾‹ï¼šé™åˆ¶æœ€å¤š3ä¸ªå¹¶å‘ä¸‹è½½ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 var semaphore = new SemaphoreSlim(3, 3); // æœ€å¤š3ä¸ªå¹¶å‘ var tasks = Enumerable.Range(1, 10).Select(async i =\u0026gt; { await semaphore.WaitAsync(); try { Console.WriteLine($\u0026#34;å¼€å§‹ä¸‹è½½æ–‡ä»¶ {i}ï¼Œå½“å‰å¹¶å‘: {3 - semaphore.CurrentCount}\u0026#34;); await Task.Delay(1000); // æ¨¡æ‹Ÿä¸‹è½½ Console.WriteLine($\u0026#34;å®Œæˆä¸‹è½½æ–‡ä»¶ {i}\u0026#34;); } finally { semaphore.Release(); } }); await Task.WhenAll(tasks); âœ… é€‚ç”¨åœºæ™¯ï¼šé™æµã€æ•°æ®åº“è¿æ¥æ± ã€APIè°ƒç”¨é™é¢‘ã€èµ„æºæ± \nâš™ï¸ å››ã€volatile ä¸ Interlocked â€”â€” å¹¶å‘ç¼–ç¨‹çš„åŸºçŸ³ 1. volatile å…³é”®å­— ç”¨äºä¿®é¥°å­—æ®µï¼Œç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¹è¯¥å­—æ®µçš„è¯»å†™ä¸è¢«ç¼–è¯‘å™¨/CPUé‡æ’åºæˆ–ç¼“å­˜ã€‚\né€‚ç”¨åœºæ™¯ï¼šæ ‡å¿—ä½ã€çŠ¶æ€å˜é‡ã€å¼•ç”¨æ›¿æ¢\nç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 public class Worker { private volatile bool _shouldStop = false; public void DoWork() { while (!_shouldStop) { // å·¥ä½œé€»è¾‘ } } public void RequestStop() { _shouldStop = true; // å…¶ä»–çº¿ç¨‹èƒ½ç«‹å³çœ‹åˆ° } } âš ï¸ volatile ä¸èƒ½æ›¿ä»£é”ï¼å®ƒåªä¿è¯å¯è§æ€§å’Œç¦æ­¢é‡æ’åºï¼Œä¸ä¿è¯åŸå­æ€§ã€‚\n2. Interlocked ç±» æä¾›åŸå­æ“ä½œï¼Œå¦‚è‡ªå¢ã€è‡ªå‡ã€äº¤æ¢ã€æ¯”è¾ƒäº¤æ¢ï¼ˆCASï¼‰\nå¸¸ç”¨æ–¹æ³•ï¼š\nInterlocked.Increment(ref variable) Interlocked.Exchange(ref location, value) â€” åŸå­æ›¿æ¢ Interlocked.CompareExchange(ref location, newValue, comparand) â€” CAS ç¤ºä¾‹ 1ï¼šçº¿ç¨‹å®‰å…¨è®¡æ•°å™¨\n1 2 3 4 5 6 7 8 private long _counter = 0; Parallel.For(0, 10000, _ =\u0026gt; { Interlocked.Increment(ref _counter); }); Console.WriteLine(_counter); // 10000 ç¤ºä¾‹ 2ï¼šåŸå­æ›¿æ¢ï¼ˆç”¨äºåŠ¨æ€æ›¿æ¢ SemaphoreSlimï¼‰\n1 2 3 4 5 6 7 8 private volatile SemaphoreSlim _semaphore = new(4); public void SetMaxConcurrency(int newMax) { var newSemaphore = new SemaphoreSlim(newMax); var old = Interlocked.Exchange(ref _semaphore, newSemaphore); old?.Dispose(); } âœ… é€‚ç”¨åœºæ™¯ï¼šè®¡æ•°å™¨ã€çŠ¶æ€æœºã€æ— é”æ•°æ®ç»“æ„ã€åŠ¨æ€èµ„æºæ›¿æ¢\nğŸ”„ äº”ã€å®ƒä»¬ä¹‹é—´çš„å…³ç³»å›¾è°± 1 2 3 4 5 6 7 8 graph TD A[ConcurrentQueue\u0026lt;T\u0026gt;] --\u0026gt;|åŒ…è£…| B(BlockingCollection\u0026lt;T\u0026gt;) C[ConcurrentStack\u0026lt;T\u0026gt;] --\u0026gt;|åŒ…è£…| B D[ConcurrentBag\u0026lt;T\u0026gt;] --\u0026gt;|åŒ…è£…| B E[SemaphoreSlim] --\u0026gt;|æ§åˆ¶| F[å¹¶å‘ä»»åŠ¡æ•°/èµ„æºè®¿é—®æ•°] G[volatile + Interlocked] --\u0026gt;|æ”¯æ’‘| H[æ— é”ç¼–ç¨‹ã€åŠ¨æ€æ›¿æ¢ã€çŠ¶æ€åŒæ­¥] B --\u0026gt;|å¸¸ä¸| E F --\u0026gt;|ä¾èµ–| G BlockingCollection\u0026lt;T\u0026gt; ä¾èµ–åº•å±‚å¹¶å‘é›†åˆ\nSemaphoreSlim å¸¸ç”¨äºæ§åˆ¶ BlockingCollection æ¶ˆè´¹è€…æˆ–ä»»åŠ¡å¹¶å‘æ•°\nvolatile + Interlocked æ˜¯å®ç°æ— é”æ›¿æ¢ã€çŠ¶æ€åŒæ­¥çš„åŸºç¡€\nğŸ¯ å…­ã€å®æˆ˜ï¼šæ„å»ºä¸€ä¸ªå¸¦å¹¶å‘é™åˆ¶çš„ä»»åŠ¡è°ƒåº¦å™¨ ç»“åˆä»¥ä¸Šæ‰€æœ‰çŸ¥è¯†ç‚¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 public class LimitedTaskScheduler\u0026lt;T\u0026gt; { private readonly BlockingCollection\u0026lt;Func\u0026lt;Task\u0026lt;T\u0026gt;\u0026gt;\u0026gt; _taskQueue; private readonly SemaphoreSlim _semaphore; private readonly ILogger _logger; public LimitedTaskScheduler(int maxConcurrency, ILogger logger) { _taskQueue = new BlockingCollection\u0026lt;Func\u0026lt;Task\u0026lt;T\u0026gt;\u0026gt;\u0026gt;(new ConcurrentQueue\u0026lt;Func\u0026lt;Task\u0026lt;T\u0026gt;\u0026gt;\u0026gt;()); _semaphore = new SemaphoreSlim(maxConcurrency, maxConcurrency); _logger = logger; } public void QueueTask(Func\u0026lt;Task\u0026lt;T\u0026gt;\u0026gt; task) { _taskQueue.Add(task); } public async Task StartAsync() { var tasks = new List\u0026lt;Task\u0026gt;(); foreach (var workItem in _taskQueue.GetConsumingEnumerable()) { tasks.Add(ExecuteWithLimit(workItem)); } await Task.WhenAll(tasks); } private async Task ExecuteWithLimit(Func\u0026lt;Task\u0026lt;T\u0026gt;\u0026gt; workItem) { await _semaphore.WaitAsync(); try { await workItem(); } finally { _semaphore.Release(); } } public void CompleteAdding() =\u0026gt; _taskQueue.CompleteAdding(); } ä½¿ç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 var scheduler = new LimitedTaskScheduler\u0026lt;string\u0026gt;(3, logger); scheduler.QueueTask(() =\u0026gt; Task.Run(async () =\u0026gt; { await Task.Delay(1000); return \u0026#34;Task1 Result\u0026#34;; })); scheduler.QueueTask(/* ... */); scheduler.CompleteAdding(); await scheduler.StartAsync(); ğŸ“ ä¸ƒã€æœ€ä½³å®è·µæ€»ç»“ ç»„ä»¶ ä½¿ç”¨å»ºè®® ConcurrentQueue é»˜è®¤é¦–é€‰ï¼ŒFIFOï¼Œé€‚åˆä»»åŠ¡é˜Ÿåˆ— ConcurrentStack é€‚åˆæ’¤é”€æ ˆã€å¯¹è±¡æ±  ConcurrentDictionary ç¼“å­˜ã€è®¡æ•°å™¨é¦–é€‰ï¼Œç”¨ GetOrAdd / AddOrUpdate é¿å…ç«æ€ BlockingCollection éœ€è¦é˜»å¡/é™ç•Œ/å®Œæˆé€šçŸ¥æ—¶ä½¿ç”¨ï¼ŒåŒ…è£… ConcurrentQueue æœ€å¸¸ç”¨ SemaphoreSlim æ§åˆ¶å¹¶å‘æ•°ï¼Œé…åˆ using æˆ– try/finally ç¡®ä¿ Release volatile ç”¨äºå¸ƒå°”æ ‡å¿—ã€å¼•ç”¨æ›¿æ¢ï¼Œç¡®ä¿å¯è§æ€§ Interlocked è®¡æ•°å™¨ã€æ— é”çŠ¶æ€åˆ‡æ¢ã€åŸå­æ›¿æ¢ï¼ˆå¦‚åŠ¨æ€è°ƒæ•´å¹¶å‘æ•°ï¼‰ ğŸ§­ å…«ã€å¸¸è§è¯¯åŒº âŒ â€œConcurrentBag æ˜¯æ— åºçš„ï¼Œæ€§èƒ½æœ€å¥½ï¼Œæ‰€ä»¥æˆ‘æ‰€æœ‰åœ°æ–¹éƒ½ç”¨å®ƒâ€\nâ†’ ä»…åœ¨é¡ºåºæ— å…³ã€é¢‘ç¹å¢åˆ æ—¶ä½¿ç”¨ï¼Œå¦åˆ™ç”¨ ConcurrentQueue\nâŒ â€œBlockingCollection.Take() æ˜¯éé˜»å¡çš„â€\nâ†’ é»˜è®¤æ˜¯é˜»å¡çš„ï¼é™¤éç”¨ TryTake\nâŒ â€œvolatile èƒ½ä¿è¯åŸå­æ€§â€\nâ†’ ä¸èƒ½ï¼i++ å³ä½¿æ˜¯ volatile ä¹Ÿä¸æ˜¯åŸå­çš„ï¼Œè¦ç”¨ Interlocked.Increment\nâŒ â€œSemaphoreSlim æ˜¯é›†åˆâ€\nâ†’ å®ƒæ˜¯åŒæ­¥åŸè¯­ï¼Œä¸æ˜¯æ•°æ®å®¹å™¨\nâœ… ç»“è¯­ .NET çš„å¹¶å‘é›†åˆä¸åŒæ­¥åŸè¯­æ„æˆäº†å¼ºå¤§è€Œæ˜“ç”¨çš„å¹¶å‘ç¼–ç¨‹åŸºç¡€è®¾æ–½ã€‚æŒæ¡ï¼š\nConcurrentQueue / ConcurrentStack / ConcurrentDictionary BlockingCollection\u0026lt;T\u0026gt; çš„é˜»å¡ä¸åŒ…è£…èƒ½åŠ› SemaphoreSlim çš„å¹¶å‘æ§åˆ¶ volatile ä¸ Interlocked çš„æ— é”æ”¯æ’‘ ä½ å°±èƒ½åœ¨å¤šçº¿ç¨‹ä¸–ç•Œä¸­æ¸¸åˆƒæœ‰ä½™ï¼Œå†™å‡ºé«˜æ€§èƒ½ã€é«˜å¯é æ€§çš„å¹¶å‘ç¨‹åºã€‚\nğŸ“Œ æºç ç¤ºä¾‹å·²å…¨éƒ¨æµ‹è¯•é€šè¿‡ï¼Œå¯ç›´æ¥å¤åˆ¶åˆ°é¡¹ç›®ä¸­è¿è¡Œã€‚\nğŸ“Œ å»ºè®®æ”¶è— + å®è·µ + åˆ†äº«ç»™å›¢é˜Ÿï¼Œæå‡æ•´ä½“å¹¶å‘ç¼–ç¨‹èƒ½åŠ›ï¼\nğŸ”– é™„å½•ï¼šå‘½åç©ºé—´å¼•ç”¨ ç¡®ä¿é¡¹ç›®ä¸­å¼•ç”¨ï¼š\n1 2 3 4 5 using System; using System.Collections.Concurrent; using System.Threading; using System.Threading.Tasks; using System.Linq; ğŸ‰ æ„Ÿè°¢é˜…è¯»ï¼å¦‚æœä½ è§‰å¾—æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—ã€è½¬å‘ï¼\nä¸‹æœŸé¢„å‘Šï¼šã€Šç”¨ Channel æ›¿ä»£ BlockingCollection â€”â€” .NET 6+ ç°ä»£å¹¶å‘æ•°æ®æµã€‹\n","date":"2025-09-11T21:08:09+08:00","image":"https://www.notion.so/images/page-cover/met_joseph_hidley_1870.jpg","permalink":"https://dumbnessrf.github.io/p/meet_parallel_programing/","title":"Meet Parallel Programing"},{"content":"ğŸ¯ SharpBoxesCore.Wpf.PropertyGrid ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€é«˜åº¦å¯æ‰©å±•çš„ WPF å±æ€§ç¼–è¾‘å™¨ï¼ˆPropertyGridï¼‰ï¼Œä¸“ä¸ºç°ä»£ MVVM åº”ç”¨è®¾è®¡ã€‚æ”¯æŒè‡ªåŠ¨ UI ç”Ÿæˆã€å±æ€§åˆ†ç»„ã€æè¿°æ˜¾ç¤ºã€èŒƒå›´éªŒè¯ã€æ»‘å—è°ƒèŠ‚ã€è‡ªå®šä¹‰æŒ‰é’®ã€å‘½ä»¤ç»‘å®šã€å¤åˆç±»å‹åµŒå¥—ã€é›†åˆç¼–è¾‘ã€åŠ¨æ€åˆ·æ–°ã€é˜²æŠ–ä¼˜åŒ–ç­‰é«˜çº§åŠŸèƒ½ï¼Œå¼€ç®±å³ç”¨ï¼Œé€‚ç”¨äºé…ç½®é¢æ¿ã€è°ƒè¯•å·¥å…·ã€è®¾è®¡å™¨ã€å‚æ•°è®¾ç½®ç­‰åœºæ™¯ã€‚\nâœ¨ æ ¸å¿ƒç‰¹æ€§ åŠŸèƒ½ è¯´æ˜ ğŸ”¹ è‡ªåŠ¨å±æ€§å‘ç° æ‰«æå¯¹è±¡çš„å…¬å…±å¯è¯»å†™å±æ€§ ğŸ”¹ å±æ€§åˆ†ç»„ï¼ˆCategoryï¼‰ æ”¯æŒ [Category(\u0026quot;åˆ†ç»„å\u0026quot;)] åˆ†ç±»æ˜¾ç¤º ğŸ”¹ å±æ€§æ’åº æ”¯æŒ [PropertyOrder(1)] è‡ªå®šä¹‰æ’åº ğŸ”¹ æè¿°æ˜¾ç¤º é¼ æ ‡æ‚¬åœæˆ–èšç„¦æ—¶æ˜¾ç¤º [Description] å†…å®¹ ğŸ”¹ æ˜¾ç¤ºåç§° æ”¯æŒ [DisplayName(\u0026quot;åˆ«å\u0026quot;)] è‡ªå®šä¹‰åç§° ğŸ”¹ æšä¸¾æ”¯æŒ æ˜¾ç¤º [Description] æ–‡æœ¬ï¼Œæ”¯æŒå¯ç©ºæšä¸¾ ğŸ”¹ æ•°å€¼èŒƒå›´éªŒè¯ æ”¯æŒ [Range(0, 100)] è¾“å…¥é™åˆ¶ ğŸ”¹ æ»‘å—è°ƒèŠ‚ é…åˆ [ShowSlider] æ˜¾ç¤º Slider æ§ä»¶ ğŸ”¹ è‡ªå®šä¹‰æŒ‰é’® æ”¯æŒ [AddButton] æ·»åŠ æ“ä½œæŒ‰é’® ğŸ”¹ å‘½ä»¤ç»‘å®š æŒ‰é’®å¯ç»‘å®š ICommandï¼Œæ”¯æŒå‚æ•°ä¼ é€’ ğŸ”¹ é™çº§æœºåˆ¶ å‘½ä»¤ä¸å­˜åœ¨æ—¶ fallback åˆ° ButtonClicked äº‹ä»¶ ğŸ”¹ æŠ˜å é¢æ¿ æ¯ä¸ª Category æ”¯æŒ Expander æŠ˜å /å±•å¼€ ğŸ”¹ äº‹ä»¶å›è°ƒ æ”¯æŒ ButtonClicked å’Œ PropertyValueChanged äº‹ä»¶ ğŸ”¹ é”™è¯¯æç¤º è¾¹æ¡†å˜çº¢ï¼Œæ˜¾ç¤ºé”™è¯¯æç¤ºï¼Œä¸æ›´æ–°æ•°æ®æº ğŸ”¹ æ–‡ä»¶/æ–‡ä»¶å¤¹é€‰æ‹© æ”¯æŒ [SelectFilePath] / [SelectFolder] å¯¹è¯æ¡† ğŸ”¹ ä¸‹æ‹‰æ¡†ç¼–è¾‘ æ”¯æŒ [EnumerableProperty] ç»‘å®šæ•°æ®æº ğŸ”¹ å¤åˆç±»å‹åµŒå¥— æ”¯æŒç±»å±æ€§å±•å¼€ä¸ºå­å±æ€§é¢æ¿ ğŸ”¹ é›†åˆç¼–è¾‘ æ”¯æŒ List\u0026lt;T\u0026gt; / Dictionary\u0026lt;K,V\u0026gt; å¼¹çª—ç¼–è¾‘ ğŸ”¹ åŠ¨æ€åˆ·æ–° æ•°æ®æºå˜åŒ–è‡ªåŠ¨æ›´æ–° UI ğŸ”¹ ç±»å‹å®‰å…¨ ç¼–è¾‘æ—¶ä¿ç•™åŸå§‹ç±»å‹ï¼Œæ”¯æŒè‡ªåŠ¨è§£æ ğŸ”¹ é˜²æŠ–æœºåˆ¶ é«˜é¢‘æ›´æ–°æ—¶è‡ªåŠ¨åˆå¹¶åˆ·æ–°ï¼Œæå‡æ€§èƒ½ ğŸ”¹ é«˜åº¦è‡ªé€‚åº” æ”¯æŒæ»šåŠ¨æ¡ï¼Œå†…å®¹å±•å¼€è‡ªåŠ¨æ‹‰ä¼¸ ğŸ”¹ æœç´¢å±æ€§å­—æ®µ æ”¯æŒæœç´¢æŒ‡å®šåç§°å±æ€§ç¼–è¾‘ ğŸ”¹ ä¸€é”®å±•å¼€ã€æŠ˜å  æ”¯æŒä¸€é”®å±•å¼€ã€æŠ˜å æ‰€æœ‰å±æ€§ ğŸš€ å¿«é€Ÿå¼€å§‹ 1. å®‰è£…å¼•ç”¨ .NET CLI 1 dotnet add package SharpBoxesCore.Wpf --version 1.1.2 PackageReference 1 \u0026lt;PackageReference Include=\u0026#34;SharpBoxesCore.Wpf\u0026#34; Version=\u0026#34;1.1.2\u0026#34; /\u0026gt; CPM Directory.Packages.props\n1 \u0026lt;PackageVersion Include=\u0026#34;SharpBoxesCore.Wpf\u0026#34; Version=\u0026#34;1.1.2\u0026#34; /\u0026gt; Project file\n1 \u0026lt;PackageReference Include=\u0026#34;SharpBoxesCore.Wpf\u0026#34; /\u0026gt; 2. åœ¨ XAML ä¸­ä½¿ç”¨ 1 2 3 4 5 6 7 \u0026lt;Window x:Class=\u0026#34;YourApp.MainWindow\u0026#34; xmlns:local=\u0026#34;clr-namespace:SharpBoxesCore.Wpf.PropertyGrid\u0026#34; ...\u0026gt; \u0026lt;Grid\u0026gt; \u0026lt;local:PropertyGrid x:Name=\u0026#34;propertyGrid\u0026#34; Padding=\u0026#34;10\u0026#34; /\u0026gt; \u0026lt;/Grid\u0026gt; \u0026lt;/Window\u0026gt; 3. ç»‘å®šæ•°æ®å¯¹è±¡ 1 2 3 4 5 6 7 8 9 10 11 12 public partial class MainWindow : Window { public MainWindow() { InitializeComponent(); propertyGrid.SelectedObject = new SampleObject(); // è®¢é˜…äº‹ä»¶ propertyGrid.ButtonClicked += OnButtonClicked; propertyGrid.PropertyValueChanged += OnPropertyValueChanged; } } ğŸ“¦ ç¤ºä¾‹ï¼šå®Œæ•´æ•°æ®æ¨¡å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 public class SampleObject : INotifyPropertyChanged { [Category(\u0026#34;åŸºæœ¬ä¿¡æ¯\u0026#34;)] [DisplayName(\u0026#34;å§“å\u0026#34;)] [Description(\u0026#34;ç”¨æˆ·çš„å…¨å\u0026#34;)] [EnumerableProperty(\u0026#34;AvaliableNames\u0026#34;, true)] public string Name { get; set; } = \u0026#34;å¼ ä¸‰\u0026#34;; [Category(\u0026#34;æ•°å€¼è®¾ç½®\u0026#34;)] [DisplayName(\u0026#34;éŸ³é‡\u0026#34;)] [Description(\u0026#34;è°ƒèŠ‚éŸ³é‡å¤§å°\u0026#34;)] [Range(0, 100)] [ShowSlider(10, true)] public int Volume { get; set; } = 75; [Category(\u0026#34;é«˜çº§\u0026#34;)] [DisplayName(\u0026#34;æ•°æ®æ¨¡å¼\u0026#34;)] public DataMode Mode { get; set; } = DataMode.Development; [Category(\u0026#34;æ–‡ä»¶\u0026#34;)] [DisplayName(\u0026#34;é…ç½®æ–‡ä»¶\u0026#34;)] [SelectFilePath(Title = \u0026#34;é€‰æ‹©é…ç½®æ–‡ä»¶\u0026#34;, Filter = \u0026#34;JSON Files|*.json\u0026#34;)] public string ConfigFile { get; set; } = \u0026#34;\u0026#34;; [Category(\u0026#34;è·¯å¾„\u0026#34;)] [DisplayName(\u0026#34;å·¥ä½œç›®å½•\u0026#34;)] [SelectFolder(Title = \u0026#34;é€‰æ‹©å·¥ä½œç›®å½•\u0026#34;)] public string WorkDir { get; set; } = \u0026#34;\u0026#34;; [Category(\u0026#34;é›†åˆ\u0026#34;)] public List\u0026lt;string\u0026gt; Hobbies { get; set; } = new() { \u0026#34;é˜…è¯»\u0026#34;, \u0026#34;éŸ³ä¹\u0026#34; }; [Category(\u0026#34;å­—å…¸\u0026#34;)] public Dictionary\u0026lt;string, int\u0026gt; Scores { get; set; } = new() { [\u0026#34;æ•°å­¦\u0026#34;] = 90, [\u0026#34;è‹±è¯­\u0026#34;] = 85 }; [Category(\u0026#34;åµŒå¥—å¯¹è±¡\u0026#34;)] public Address HomeAddress { get; set; } = new(); [Category(\u0026#34;æ“ä½œ\u0026#34;)] [AddButton(\u0026#34;ResetCommand\u0026#34;, \u0026#34;é‡ç½®\u0026#34;)] [AddButton(\u0026#34;LogCommand\u0026#34;, \u0026#34;è®°å½•å½“å‰å€¼\u0026#34;)] public int RetryCount { get; set; } = 3; // å‘½ä»¤å®šä¹‰ public ICommand ResetCommand =\u0026gt; new RelayCommand\u0026lt;string\u0026gt;(_ =\u0026gt; RetryCount = 0); public ICommand LogCommand =\u0026gt; new RelayCommand\u0026lt;string\u0026gt;(action =\u0026gt; Debug.WriteLine($\u0026#34;æ—¥å¿—: {action}, Count={RetryCount}\u0026#34;)); // ä¸‹æ‹‰æ•°æ®æº public ObservableCollection\u0026lt;string\u0026gt; AvaliableNames { get; } = new() { \u0026#34;Alice\u0026#34;, \u0026#34;Bob\u0026#34;, \u0026#34;Charlie\u0026#34; }; public event PropertyChangedEventHandler PropertyChanged; protected virtual void OnPropertyChanged([CallerMemberName] string propertyName = null) =\u0026gt; PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName)); } ğŸ¨ UI æ•ˆæœé¢„è§ˆ åˆ†ç»„æŠ˜å /å±•å¼€ æ»‘å—ä¸æ–‡æœ¬æ¡†è”åŠ¨ æŒ‰é’®è‡ªåŠ¨å¸ƒå±€ é”™è¯¯è¾“å…¥çº¢è‰²æç¤º æè¿°ä¿¡æ¯å®æ—¶æ˜¾ç¤º å¤åˆå¯¹è±¡åµŒå¥—å±•å¼€ é›†åˆç‚¹å‡»â€œç¼–è¾‘\u0026hellip;â€å¼¹çª— æ»šåŠ¨æ¡æ”¯æŒé•¿å†…å®¹ ğŸ”§ é«˜çº§åŠŸèƒ½è¯¦è§£ 1. æšä¸¾æ˜¾ç¤º [Description] 1 2 3 4 5 6 7 8 public enum DataMode { [Description(\u0026#34;å¼€å‘æ¨¡å¼\u0026#34;)] Development, [Description(\u0026#34;ç”Ÿäº§æ¨¡å¼\u0026#34;)] Production } âœ… æ˜¾ç¤ºä¸ºâ€œå¼€å‘æ¨¡å¼â€è€Œé Development\n2. æ»‘å—è°ƒèŠ‚ [ShowSlider] 1 2 3 [Range(0, 100)] [ShowSlider(5, true)] public int Brightness { get; set; } âœ… è‡ªåŠ¨ç”Ÿæˆ Slider + TextBox è”åŠ¨æ§ä»¶\n3. è‡ªå®šä¹‰æŒ‰é’®ä¸å‘½ä»¤ç»‘å®š 1 2 3 [AddButton(\u0026#34;SaveCommand\u0026#34;, \u0026#34;ä¿å­˜\u0026#34;, \u0026#34;å¦å­˜ä¸º\u0026#34;)] [AddButton(\u0026#34;DeleteCommand\u0026#34;, \u0026#34;åˆ é™¤\u0026#34;)] public string FileName { get; set; } âœ… å­˜åœ¨å‘½ä»¤ â†’ ç»‘å®šæ‰§è¡Œ âŒ ä¸å­˜åœ¨ â†’ è§¦å‘ ButtonClicked äº‹ä»¶ 1 2 3 4 propertyGrid.ButtonClicked += (s, e) =\u0026gt; { MessageBox.Show($\u0026#34;æŒ‰é’®ç‚¹å‡»: {e.PropertyName} - {e.ButtonText}\u0026#34;); }; 4. æ•°å€¼èŒƒå›´éªŒè¯ 1 2 [Range(1, 1000)] public int Count { get; set; } âœ… è¾“å…¥éæ³•æ—¶ï¼š\nè¾¹æ¡†å˜çº¢ æ˜¾ç¤ºé”™è¯¯æç¤º ä¸æ›´æ–°æ•°æ®æº 5. ä¸‹æ‹‰æ¡† [EnumerableProperty] 1 2 [EnumerableProperty(\u0026#34;AvaliableNames\u0026#34;, true)] public string Theme { get; set; } âœ… æ˜¾ç¤ºä¸‹æ‹‰æ¡†ï¼Œæ”¯æŒè‡ªå®šä¹‰è¾“å…¥ï¼Œæ•°æ®æºåŠ¨æ€åˆ·æ–°\n6. æ–‡ä»¶/æ–‡ä»¶å¤¹é€‰æ‹© 1 2 3 4 5 [SelectFilePath(Title = \u0026#34;é€‰æ‹©æ—¥å¿—\u0026#34;)] public string LogFile { get; set; } [SelectFolder] public string BackupDir { get; set; } âœ… ä½¿ç”¨ Ookii.Dialogs.Wpf æä¾›ä¸“ä¸šå¯¹è¯æ¡†\n7. å¤åˆç±»å‹ï¼ˆåµŒå¥—å¯¹è±¡ï¼‰ 1 2 3 4 5 6 7 8 public class Address { public string Street { get; set; } public string City { get; set; } } [DisplayName(\u0026#34;å®¶åº­åœ°å€\u0026#34;)] public Address HomeAddress { get; set; } âœ… è‡ªåŠ¨å±•å¼€ä¸ºå­å±æ€§é¢æ¿ï¼Œæ”¯æŒ INotifyPropertyChanged åŠ¨æ€åˆ·æ–°\n8. é›†åˆç¼–è¾‘ï¼ˆList / Dictionaryï¼‰ 1 2 public List\u0026lt;string\u0026gt; Hobbies { get; set; } public Dictionary\u0026lt;string, int\u0026gt; Scores { get; set; } âœ… ç‚¹å‡»â€œç¼–è¾‘\u0026hellip;â€å¼¹å‡º ListEditor / DictEditorï¼Œæ”¯æŒç±»å‹ä¿ç•™ç¼–è¾‘\nğŸ§© äº‹ä»¶ç³»ç»Ÿ PropertyValueChanged â€” å±æ€§æ›´æ”¹äº‹ä»¶ 1 2 3 4 5 6 7 propertyGrid.PropertyValueChanged += (s, e) =\u0026gt; { Console.WriteLine($\u0026#34;å±æ€§æ›´æ”¹: {e.PropertyName}\u0026#34;); Console.WriteLine($\u0026#34; ç±»å‹: {e.PropertyType.Name}\u0026#34;); Console.WriteLine($\u0026#34; æ—§å€¼: {e.OldValue}\u0026#34;); Console.WriteLine($\u0026#34; æ–°å€¼: {e.NewValue}\u0026#34;); }; âœ… æ‰€æœ‰ç¼–è¾‘æ“ä½œï¼ˆåŒ…æ‹¬é›†åˆã€æ–‡ä»¶é€‰æ‹©ï¼‰å‡è§¦å‘æ­¤äº‹ä»¶\nButtonClicked â€” æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼ˆfallbackï¼‰ 1 2 3 4 propertyGrid.ButtonClicked += (s, e) =\u0026gt; { if (e.ButtonText == \u0026#34;é‡ç½®\u0026#34;) ResetLogic(); }; âœ… ç”¨äºæœªç»‘å®š ICommand çš„æŒ‰é’®\nğŸ› ï¸ è‡ªå®šä¹‰ Attribute è¯´æ˜ Attribute ç”¨é€” ç¤ºä¾‹ [Category(\u0026quot;åˆ†ç»„\u0026quot;)] å±æ€§åˆ†ç»„ Category(\u0026quot;ç½‘ç»œ\u0026quot;) [DisplayName(\u0026quot;åˆ«å\u0026quot;)] è‡ªå®šä¹‰æ˜¾ç¤ºå DisplayName(\u0026quot;IPåœ°å€\u0026quot;) [Description(\u0026quot;è¯´æ˜\u0026quot;)] æè¿°ä¿¡æ¯ Description(\u0026quot;æœåŠ¡å™¨IP\u0026quot;) [PropertyOrder(1)] æ’åºä¼˜å…ˆçº§ æ•°å­—è¶Šå°è¶Šé å‰ [Range(0,100)] æ•°å€¼èŒƒå›´ æ”¯æŒ int/double/float [ShowSlider(10)] æ˜¾ç¤ºæ»‘å— TickFrequency=10 [AddButton(\u0026quot;Cmd\u0026quot;, \u0026quot;æŒ‰é’®\u0026quot;)] æ·»åŠ æ“ä½œæŒ‰é’® æ”¯æŒå¤šæ ‡ç­¾ [EnumerableProperty(\u0026quot;Source\u0026quot;, true)] ä¸‹æ‹‰æ¡† ç»‘å®šæ•°æ®æº [SelectFilePath] æ–‡ä»¶é€‰æ‹© æ‰“å¼€ OpenFileDialog [SelectFolder] æ–‡ä»¶å¤¹é€‰æ‹© æ‰“å¼€ FolderBrowserDialog âš™ï¸ é«˜çº§é…ç½® é˜²æŠ–æœºåˆ¶ï¼ˆDebounceï¼‰ é»˜è®¤å¯ç”¨ï¼Œé˜²æ­¢é«˜é¢‘åˆ·æ–°ï¼š\n1 propertyGrid.DebounceEnabled = true; // é»˜è®¤ true å¯è°ƒæ•´å»¶è¿Ÿæ—¶é—´ï¼ˆå†…éƒ¨ä½¿ç”¨ DispatcherTimerï¼‰\næ‰‹åŠ¨è§¦å‘å±æ€§æ›´æ”¹ 1 propertyGrid.RaisePropertyValueChanged(\u0026#34;Name\u0026#34;, \u0026#34;æ—§å€¼\u0026#34;, \u0026#34;æ–°å€¼\u0026#34;); ç”¨äºä»£ç ä¿®æ”¹å±æ€§åé€šçŸ¥å¤–éƒ¨ç³»ç»Ÿ\nğŸ“š å·²çŸ¥é™åˆ¶ é™åˆ¶ è¯´æ˜ âŒ ä¸æ”¯æŒé›†åˆå¢åˆ é¡¹ ListEditor ä»…æ”¯æŒä¿®æ”¹å€¼ âŒ ä¸æ”¯æŒå¤æ‚å¯¹è±¡åˆ—è¡¨ç¼–è¾‘ ä»…æ”¯æŒç®€å•ç±»å‹åˆ—è¡¨ âŒ ä¸æ”¯æŒ DateTime ä¸“ç”¨æ§ä»¶ å¯ç”¨ TextBox è¾“å…¥ âœ… åç»­è®¡åˆ’æ”¯æŒï¼šDatePickerã€ColorPickerã€IEditableObject æ’¤é”€\nå¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—ã€åˆ†äº«ï¼\nä¹Ÿå¯ä»¥å…³æ³¨æˆ‘çš„åšå®¢ï¼Œè·å–æ›´å¤š WPF / .NET æŠ€æœ¯å¹²è´§ ğŸ˜Š\n","date":"2025-09-02T23:01:03+08:00","image":"https://www.notion.so/images/page-cover/met_winslow_homer_maine_coast.jpg","permalink":"https://dumbnessrf.github.io/p/propertygrid/","title":"PropertyGrid"},{"content":"ğŸš€ åœ¨ WPF ä¸­ä½¿ç”¨ Microsoft.Xaml.Behaviorsï¼šè¡Œä¸ºï¼ˆBehaviorsï¼‰çš„ä¼˜é›…è§£å†³æ–¹æ¡ˆ âœ… ä»€ä¹ˆæ˜¯ Microsoft.Xaml.Behaviorsï¼Ÿ Microsoft.Xaml.Behaviors æ˜¯ä¸€ä¸ªå¼€æºåº“ï¼Œæœ€åˆç”± Expression Blend å›¢é˜Ÿå¼€å‘ï¼Œåæ¥è¢«å¾®è½¯å®˜æ–¹ç»´æŠ¤å¹¶æ‰˜ç®¡åœ¨ GitHub ä¸Šã€‚è¿™ä¸ªåº“å…è®¸å¼€å‘è€…é€šè¿‡ XAML è¡Œä¸ºï¼ˆBehaviorsï¼‰ å’Œ è§¦å‘å™¨ï¼ˆTriggersï¼‰ æ¥æ‰©å±• UI æ§ä»¶çš„åŠŸèƒ½ï¼Œè€Œæ— éœ€ç¼–å†™å¤æ‚çš„ä»£ç æˆ–ä¿®æ”¹æ§ä»¶æœ¬èº«ã€‚\nğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ Behaviorï¼ˆè¡Œä¸ºï¼‰ï¼šä¸€ç§å¯é‡ç”¨çš„ç»„ä»¶ï¼Œé™„åŠ åˆ°æŸä¸ª UI å…ƒç´ ä¸Šï¼Œå¹¶ä¸ºå…¶æ·»åŠ é¢å¤–çš„è¡Œä¸ºã€‚ Triggerï¼ˆè§¦å‘å™¨ï¼‰ï¼šæ ¹æ®æŸäº›æ¡ä»¶æˆ–äº‹ä»¶æ‰§è¡Œç‰¹å®šçš„æ“ä½œã€‚ Actionï¼ˆåŠ¨ä½œï¼‰ï¼šè§¦å‘å™¨æ‰§è¡Œçš„å…·ä½“æ“ä½œï¼Œå¦‚è°ƒç”¨æ–¹æ³•ã€æ”¹å˜å±æ€§ç­‰ã€‚ GitHub åœ°å€ï¼šhttps://github.com/microsoft/XamlBehaviors\nğŸ“¦ å®‰è£… Microsoft.Xaml.Behaviors ä½ å¯ä»¥é€šè¿‡ NuGet åŒ…ç®¡ç†å™¨è½»æ¾åœ°å°† Microsoft.Xaml.Behaviors.Wpf æ·»åŠ åˆ°ä½ çš„ WPF é¡¹ç›®ä¸­ã€‚\nä½¿ç”¨ NuGet å®‰è£…å‘½ä»¤ï¼š 1 Install-Package Microsoft.Xaml.Behaviors.Wpf æˆ–è€…é€šè¿‡ Visual Studio çš„ NuGet åŒ…ç®¡ç†å™¨æœç´¢å¹¶å®‰è£…ï¼š\næ‰“å¼€èœå•ï¼šå·¥å…· \u0026gt; NuGet åŒ…ç®¡ç†å™¨ \u0026gt; ç®¡ç†è§£å†³æ–¹æ¡ˆçš„ NuGet åŒ… æœç´¢å…³é”®è¯ï¼šMicrosoft.Xaml.Behaviors.Wpf å®‰è£…æœ€æ–°ç‰ˆæœ¬ ğŸ› ï¸ XAML å‘½åç©ºé—´å¼•ç”¨ åœ¨ XAML æ–‡ä»¶é¡¶éƒ¨æ·»åŠ ä»¥ä¸‹å‘½åç©ºé—´å¼•ç”¨ï¼Œä»¥ä¾¿ä½¿ç”¨ Behaviorsï¼š\n1 xmlns:i=\u0026#34;http://schemas.microsoft.com/expression/2010/interactivity\u0026#34; ğŸ¯ ä½¿ç”¨ç¤ºä¾‹ä¸åº”ç”¨åœºæ™¯ ä¸‹é¢æˆ‘ä»¬å°†é€šè¿‡å‡ ä¸ªå…¸å‹çš„ä½¿ç”¨åœºæ™¯æ¥å±•ç¤º Microsoft.Xaml.Behaviors çš„å¼ºå¤§ä¹‹å¤„ã€‚\nç¤ºä¾‹ 1ï¼šç‚¹å‡»æŒ‰é’®æ—¶å¼¹å‡ºæ¶ˆæ¯æ¡†ï¼ˆä¸ä½¿ç”¨ä»£ç ï¼‰ åœºæ™¯è¯´æ˜ï¼š ä½ å¸Œæœ›ç‚¹å‡»æŒ‰é’®æ—¶æ˜¾ç¤ºä¸€ä¸ªç®€å•çš„æ¶ˆæ¯æ¡†ï¼Œä½†ä¸æƒ³åœ¨ä»£ç åå°å†™ä»»ä½•é€»è¾‘ã€‚\nå®ç°æ–¹å¼ï¼š 1 2 3 4 5 6 7 \u0026lt;Button Content=\u0026#34;ç‚¹å‡»æˆ‘\u0026#34;\u0026gt; \u0026lt;i:Interaction.Triggers\u0026gt; \u0026lt;i:EventTrigger EventName=\u0026#34;Click\u0026#34;\u0026gt; \u0026lt;i:InvokeCommandAction Command=\u0026#34;{Binding ShowMessageCommand}\u0026#34; /\u0026gt; \u0026lt;/i:EventTrigger\u0026gt; \u0026lt;/i:Interaction.Triggers\u0026gt; \u0026lt;/Button\u0026gt; ViewModel ä¸­å®šä¹‰å‘½ä»¤ï¼š 1 2 3 4 5 6 7 public ICommand ShowMessageCommand { get; } public MyViewModel() { ShowMessageCommand = new RelayCommand(() =\u0026gt; MessageBox.Show(\u0026#34;ä½ å¥½ï¼Œä¸–ç•Œï¼\u0026#34;)); } ç¤ºä¾‹ 2ï¼šæ–‡æœ¬æ¡†å†…å®¹å˜åŒ–æ—¶æ›´æ–°ç»‘å®šå€¼ï¼ˆå®æ—¶éªŒè¯ï¼‰ åœºæ™¯è¯´æ˜ï¼š ç”¨æˆ·åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥å†…å®¹æ—¶ï¼Œè‡ªåŠ¨è§¦å‘éªŒè¯é€»è¾‘ã€‚\nå®ç°æ–¹å¼ï¼š 1 2 3 4 5 6 7 \u0026lt;TextBox Text=\u0026#34;{Binding Name}\u0026#34;\u0026gt; \u0026lt;i:Interaction.Triggers\u0026gt; \u0026lt;i:EventTrigger EventName=\u0026#34;TextChanged\u0026#34;\u0026gt; \u0026lt;i:InvokeCommandAction Command=\u0026#34;{Binding ValidateNameCommand}\u0026#34; /\u0026gt; \u0026lt;/i:EventTrigger\u0026gt; \u0026lt;/i:Interaction.Triggers\u0026gt; \u0026lt;/TextBox\u0026gt; ç¤ºä¾‹ 3ï¼šé¼ æ ‡æ‚¬åœæ—¶é«˜äº®å…ƒç´  åœºæ™¯è¯´æ˜ï¼š å½“é¼ æ ‡æ‚¬åœåœ¨ä¸€ä¸ªæŒ‰é’®ä¸Šæ—¶ï¼Œæ”¹å˜å…¶èƒŒæ™¯é¢œè‰²ã€‚\nå®ç°æ–¹å¼ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;Button Content=\u0026#34;æ‚¬åœè¯•è¯•çœ‹\u0026#34;\u0026gt; \u0026lt;i:Interaction.Triggers\u0026gt; \u0026lt;i:EventTrigger EventName=\u0026#34;MouseEnter\u0026#34;\u0026gt; \u0026lt;i:ChangePropertyAction TargetObject=\u0026#34;{Binding ElementName=MyButton}\u0026#34; PropertyName=\u0026#34;Background\u0026#34; Value=\u0026#34;LightBlue\u0026#34;/\u0026gt; \u0026lt;/i:EventTrigger\u0026gt; \u0026lt;i:EventTrigger EventName=\u0026#34;MouseLeave\u0026#34;\u0026gt; \u0026lt;i:ChangePropertyAction TargetObject=\u0026#34;{Binding ElementName=MyButton}\u0026#34; PropertyName=\u0026#34;Background\u0026#34; Value=\u0026#34;White\u0026#34;/\u0026gt; \u0026lt;/i:EventTrigger\u0026gt; \u0026lt;/i:Interaction.Triggers\u0026gt; \u0026lt;/Button\u0026gt; ç¤ºä¾‹ 4ï¼šè‡ªå®šä¹‰è¡Œä¸º â€”â€” å³é”®èœå• åœºæ™¯è¯´æ˜ï¼š ä¸ºä»»æ„æ§ä»¶æ·»åŠ å³é”®èœå•åŠŸèƒ½ã€‚\nè‡ªå®šä¹‰è¡Œä¸ºç±»ï¼ˆC#ï¼‰ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 public class RightClickMenuBehavior : Behavior\u0026lt;FrameworkElement\u0026gt; { public static readonly DependencyProperty ContextMenuProperty = DependencyProperty.Register(\u0026#34;ContextMenu\u0026#34;, typeof(ContextMenu), typeof(RightClickMenuBehavior)); public ContextMenu ContextMenu { get { return (ContextMenu)GetValue(ContextMenuProperty); } set { SetValue(ContextMenuProperty, value); } } protected override void OnAttached() { AssociatedObject.MouseRightButtonDown += OnMouseRightButtonDown; } protected override void OnDetaching() { AssociatedObject.MouseRightButtonDown -= OnMouseRightButtonDown; } private void OnMouseRightButtonDown(object sender, MouseButtonEventArgs e) { if (ContextMenu != null) { ContextMenu.PlacementTarget = AssociatedObject; ContextMenu.IsOpen = true; } } } XAML ä½¿ç”¨æ–¹å¼ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 \u0026lt;Button Content=\u0026#34;å³é”®ç‚¹å‡»æˆ‘\u0026#34;\u0026gt; \u0026lt;i:Interaction.Behaviors\u0026gt; \u0026lt;local:RightClickMenuBehavior\u0026gt; \u0026lt;local:RightClickMenuBehavior.ContextMenu\u0026gt; \u0026lt;ContextMenu\u0026gt; \u0026lt;MenuItem Header=\u0026#34;å¤åˆ¶\u0026#34; /\u0026gt; \u0026lt;MenuItem Header=\u0026#34;ç²˜è´´\u0026#34; /\u0026gt; \u0026lt;/ContextMenu\u0026gt; \u0026lt;/local:RightClickMenuBehavior.ContextMenu\u0026gt; \u0026lt;/local:RightClickMenuBehavior\u0026gt; \u0026lt;/i:Interaction.Behaviors\u0026gt; \u0026lt;/Button\u0026gt; ğŸ§© åº”ç”¨åœºæ™¯æ€»ç»“ åœºæ™¯ æè¿° âš™ï¸ äº‹ä»¶ç»‘å®š å°† UI äº‹ä»¶ç»‘å®šåˆ° ViewModel ä¸­çš„å‘½ä»¤ï¼Œå®ç° MVVM è§£è€¦ ğŸ” è¾“å…¥éªŒè¯ å®æ—¶éªŒè¯ç”¨æˆ·è¾“å…¥å†…å®¹ï¼Œæå‡ç”¨æˆ·ä½“éªŒ ğŸ–±ï¸ é¼ æ ‡äº¤äº’ å¤„ç†é¼ æ ‡æ‚¬åœã€å•å‡»ã€æ‹–æ‹½ç­‰äº¤äº’é€»è¾‘ ğŸ”„ åŠ¨æ€æ ·å¼ æ ¹æ®çŠ¶æ€åŠ¨æ€æ›´æ”¹æ§ä»¶å¤–è§‚ ğŸ§ª å•å…ƒæµ‹è¯• å‡å°‘ä»£ç è€¦åˆï¼Œæé«˜å¯æµ‹è¯•æ€§ ğŸ§± è‡ªå®šä¹‰è¡Œä¸º å¿«é€Ÿæ„å»ºå¯å¤ç”¨çš„ UI è¡Œä¸ºæ¨¡å— ğŸ§  æ€»ç»“ Microsoft.Xaml.Behaviors æ˜¯ WPF å¼€å‘ä¸­éå¸¸å¼ºå¤§çš„è¾…åŠ©å·¥å…·ã€‚å®ƒä¸ä»…ç®€åŒ–äº† UI ä¸é€»è¾‘ä¹‹é—´çš„ç»‘å®šï¼Œè¿˜æå‡äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§ã€‚é€šè¿‡ä½¿ç”¨è¡Œä¸ºå’Œè§¦å‘å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ›´åŠ çµæ´»ã€è§£è€¦çš„ UI è®¾è®¡ï¼Œç‰¹åˆ«é€‚åˆ MVVM æ¶æ„ä¸‹çš„å¼€å‘ã€‚\nå¦‚æœä½ æ­£åœ¨å¯»æ‰¾ä¸€ç§æ›´ä¼˜é›…çš„æ–¹å¼æ¥å¤„ç† UI äº¤äº’é€»è¾‘ï¼Œé‚£ä¹ˆ Microsoft.Xaml.Behaviors ç»å¯¹å€¼å¾—ä¸€è¯•ï¼\nğŸ“š å‚è€ƒèµ„æ–™ GitHub - Microsoft.Xaml.Behaviors NuGet - Microsoft.Xaml.Behaviors.Wpf MSDN - Interactivity Library å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—ã€åˆ†äº«ï¼\nä¹Ÿå¯ä»¥å…³æ³¨æˆ‘çš„åšå®¢ï¼Œè·å–æ›´å¤š WPF / .NET æŠ€æœ¯å¹²è´§ ğŸ˜Š\n","date":"2025-07-23T23:01:03+08:00","image":"https://www.notion.so/images/page-cover/met_horace_pippin.jpg","permalink":"https://dumbnessrf.github.io/p/xaml_behaviors/","title":"Xaml Behaviors"},{"content":"åœ¨ WPFã€Xamarin.Forms å’Œ .NET MAUI å¼€å‘ä¸­ï¼Œæ•°æ®ç»‘å®šï¼ˆData Bindingï¼‰ æ˜¯ MVVM æ¶æ„çš„æ ¸å¿ƒæœºåˆ¶ã€‚ä½†æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›å¯¹ç»‘å®šçš„æ•°æ®è¿›è¡Œè½¬æ¢ã€æ ¼å¼åŒ–æˆ–é€»è¾‘å¤„ç†ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨ IValueConverter æ¥å£å®ç°å€¼è½¬æ¢å™¨ã€‚\nValueConverters.NET æ˜¯ä¸€ä¸ªç”± Thomas Galliker ç»´æŠ¤çš„å¼€æºé¡¹ç›®ï¼Œå®ƒæä¾›äº†ä¸€ç»„å¸¸ç”¨çš„ IValueConverter å®ç°ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿæ„å»ºå¼ºå¤§çš„æ•°æ®ç»‘å®šé€»è¾‘ã€‚\nğŸ“¦ å®‰è£…æ–¹æ³• ä½ å¯ä»¥é€šè¿‡ NuGet åŒ…å®‰è£…é€‚ç”¨äºä¸åŒå¹³å°çš„ç‰ˆæœ¬ï¼š\nå¹³å° å‘½ä»¤ WPF / WinForms / UWP / Avalonia ç­‰ Install-Package ValueConverters Xamarin.Forms Install-Package ValueConverters.Forms .NET MAUI Install-Package ValueConverters.MAUI âœ… å¦‚ä½•ä½¿ç”¨ ValueConverters.NETï¼Ÿ æ­¥éª¤ä¸€ï¼šåœ¨ XAML ä¸­å®šä¹‰èµ„æº 1 2 3 4 \u0026lt;Window.Resources\u0026gt; \u0026lt;converters:DateTimeConverter x:Key=\u0026#34;DateTimeConverter\u0026#34; Format=\u0026#34;d\u0026#34; MinValueString=\u0026#34;-\u0026#34;/\u0026gt; \u0026lt;converters:BooleanToVisibilityConverter x:Key=\u0026#34;BooleanToVisibilityConverter\u0026#34;/\u0026gt; \u0026lt;/Window.Resources\u0026gt; æ­¥éª¤äºŒï¼šåœ¨ç»‘å®šä¸­ä½¿ç”¨ Converter 1 2 \u0026lt;TextBlock Text=\u0026#34;{Binding BirthDate, Converter={StaticResource DateTimeConverter}}\u0026#34; /\u0026gt; \u0026lt;TextBox Visibility=\u0026#34;{Binding IsVisible, Converter={StaticResource BooleanToVisibilityConverter}}\u0026#34; /\u0026gt; ğŸ§© æ ¸å¿ƒ Converters åŠå…¶ç¤ºä¾‹ ä¸‹é¢ä»‹ç»å‡ ä¸ªæœ€å¸¸ç”¨ä¸”å®ç”¨çš„è½¬æ¢å™¨åŠå…¶åº”ç”¨åœºæ™¯ã€‚\n1. DateTimeConverterï¼šæ—¥æœŸæ ¼å¼åŒ– ç¤ºä¾‹ä»£ç ï¼š 1 2 // ViewModel public DateTime BirthDate { get; set; } = new DateTime(1990, 5, 20); 1 2 \u0026lt;!-- XAML --\u0026gt; \u0026lt;TextBlock Text=\u0026#34;{Binding BirthDate, Converter={StaticResource DateTimeConverter}, ConverterParameter=\u0026#39;yyyy-MM-dd\u0026#39;}\u0026#34; /\u0026gt; æ”¯æŒå‚æ•°ï¼š Format: æŒ‡å®šæ ¼å¼å­—ç¬¦ä¸²ï¼ˆå¦‚ \u0026quot;yyyy-MM-dd\u0026quot;ï¼‰ MinValueString: å½“å€¼ä¸º DateTime.MinValue æ—¶æ˜¾ç¤ºæ›¿ä»£æ–‡æœ¬ åº”ç”¨åœºæ™¯ï¼š æ˜¾ç¤ºç”Ÿæ—¥ã€åˆ›å»ºæ—¶é—´ç­‰æ—¥æœŸå­—æ®µ å¤„ç†ç©ºæ—¥æœŸæ˜¾ç¤ºä¸º - æˆ– N/A 2. BooleanToVisibilityConverterï¼šå¸ƒå°”å€¼è½¬å¯è§æ€§ ç¤ºä¾‹ä»£ç ï¼š 1 2 // ViewModel public bool IsBusy { get; set; } = true; 1 2 \u0026lt;!-- XAML --\u0026gt; \u0026lt;ProgressBar Visibility=\u0026#34;{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}\u0026#34; /\u0026gt; æ”¯æŒå‚æ•°ï¼š TrueValue: true æ—¶è¿”å›çš„å€¼ï¼ˆé»˜è®¤ Visibility.Visibleï¼‰ FalseValue: false æ—¶è¿”å›çš„å€¼ï¼ˆé»˜è®¤ Visibility.Collapsedï¼‰ åº”ç”¨åœºæ™¯ï¼š æ§åˆ¶æŒ‰é’®ã€è¿›åº¦æ¡ã€åŠ è½½åŠ¨ç”»çš„æ˜¾ç¤ºéšè— åŠ¨æ€åˆ‡æ¢æ§ä»¶çŠ¶æ€ 3. EnumWrapperConverterï¼šæšä¸¾æœ¬åœ°åŒ–å±•ç¤º ç¤ºä¾‹ä»£ç ï¼š 1 2 3 4 5 6 7 8 // æšä¸¾å®šä¹‰ public enum PartyMode { [Display(Name = \u0026#34;PartyMode_Off\u0026#34;, ResourceType = typeof(PartyModeResources))] Off, [Display(Name = \u0026#34;PartyMode_On\u0026#34;, ResourceType = typeof(PartyModeResources))] On } 1 2 // ViewModel public PartyMode Mode { get; set; } = PartyMode.On; 1 2 \u0026lt;!-- XAML --\u0026gt; \u0026lt;Label Content=\u0026#34;{Binding Mode, Converter={StaticResource EnumWrapperConverter}}\u0026#34; /\u0026gt; æ”¯æŒç‰¹æ€§ï¼š ä½¿ç”¨ [Display] æ³¨è§£é…åˆ .resx èµ„æºæ–‡ä»¶å®ç°å¤šè¯­è¨€æ”¯æŒ è‡ªåŠ¨è¯†åˆ«å½“å‰ CurrentUICulture åº”ç”¨åœºæ™¯ï¼š å›½é™…åŒ–åº”ç”¨ä¸­çš„ä¸‹æ‹‰èœå•ã€çŠ¶æ€æ ‡ç­¾ å°†æšä¸¾å€¼ä»¥ç”¨æˆ·å‹å¥½çš„æ–¹å¼å±•ç¤º 4. InvertBooleanConverterï¼šå–åå¸ƒå°”å€¼ ç¤ºä¾‹ä»£ç ï¼š 1 2 // ViewModel public bool IsLoggedIn { get; set; } = false; 1 2 \u0026lt;!-- XAML --\u0026gt; \u0026lt;Button Content=\u0026#34;ç™»å½•\u0026#34; Visibility=\u0026#34;{Binding IsLoggedIn, Converter={StaticResource InvertBooleanConverter}}\u0026#34; /\u0026gt; ç‰¹ç‚¹ï¼š ç›´æ¥å°† true å˜ä¸º falseï¼Œåä¹‹äº¦ç„¶ åº”ç”¨åœºæ™¯ï¼š æ§åˆ¶â€œç™»å½•â€å’Œâ€œç™»å‡ºâ€çš„åˆ‡æ¢æ˜¾ç¤º å¿«é€Ÿåè½¬æ§ä»¶çŠ¶æ€ 5. NullToVisibilityConverterï¼šç©ºå€¼æ§åˆ¶å¯è§æ€§ ç¤ºä¾‹ä»£ç ï¼š 1 2 // ViewModel public string UserName { get; set; } = null; 1 2 3 \u0026lt;!-- XAML --\u0026gt; \u0026lt;TextBlock Text=\u0026#34;{Binding UserName}\u0026#34; Visibility=\u0026#34;{Binding UserName, Converter={StaticResource NullToVisibilityConverter}}\u0026#34; /\u0026gt; æ”¯æŒå‚æ•°ï¼š WhenNull: è®¾ç½®ä¸º Visibility.Collapsed æˆ– Visibility.Hidden WhenNotNull: åŒä¸Š åº”ç”¨åœºæ™¯ï¼š éšè—ç©ºå­—æ®µ æ§åˆ¶éç©ºå†…å®¹çš„æ˜¾ç¤º 6. EnumToBooleanConverterï¼šæšä¸¾åŒ¹é…åˆ¤æ–­å¸ƒå°”å€¼ ç¤ºä¾‹ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 10 // æšä¸¾ public enum UserLevel { Guest, Member, Admin } // ViewModel public UserLevel Level { get; set; } = UserLevel.Admin; 1 2 3 \u0026lt;!-- XAML --\u0026gt; \u0026lt;Button Content=\u0026#34;åˆ é™¤ç”¨æˆ·\u0026#34; Visibility=\u0026#34;{Binding Level, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Admin}\u0026#34; /\u0026gt; åº”ç”¨åœºæ™¯ï¼š æ ¹æ®è§’è‰²æƒé™æ˜¾ç¤º/éšè—æŒ‰é’® æšä¸¾åŒ¹é…æ—¶å¯ç”¨æŸäº›æ“ä½œ 7. MultiBindingConvertersï¼šå¤šä¸ªç»‘å®šå€¼ç»„åˆè½¬æ¢ ç¤ºä¾‹ï¼šæ ¹æ®ä¸¤ä¸ªå¸ƒå°”å€¼å†³å®šæ˜¯å¦å¯ç”¨æŒ‰é’® 1 2 3 4 5 6 7 8 \u0026lt;Button Content=\u0026#34;æäº¤\u0026#34;\u0026gt; \u0026lt;Button.Visibility\u0026gt; \u0026lt;MultiBinding Converter=\u0026#34;{StaticResource BooleanAndToVisibilityConverter}\u0026#34;\u0026gt; \u0026lt;Binding Path=\u0026#34;IsFormValid\u0026#34; /\u0026gt; \u0026lt;Binding Path=\u0026#34;IsNetworkAvailable\u0026#34; /\u0026gt; \u0026lt;/MultiBinding\u0026gt; \u0026lt;/Button.Visibility\u0026gt; \u0026lt;/Button\u0026gt; æ”¯æŒçš„ MultiConverterï¼š BooleanAndConverter BooleanOrConverter BooleanXorConverter BooleanAndToVisibilityConverter BooleanOrToVisibilityConverter åº”ç”¨åœºæ™¯ï¼š å¤šæ¡ä»¶åˆ¤æ–­æ§ä»¶çŠ¶æ€ è¡¨å•éªŒè¯è”åŠ¨æ§åˆ¶ 8. ImageSourceConverterï¼šå›¾åƒè·¯å¾„è½¬ ImageSource ç¤ºä¾‹ä»£ç ï¼š 1 2 // ViewModel public string AvatarPath { get; set; } = \u0026#34;Images/avatar.png\u0026#34;; 1 2 \u0026lt;!-- XAML --\u0026gt; \u0026lt;Image Source=\u0026#34;{Binding AvatarPath, Converter={StaticResource ImageSourceConverter}}\u0026#34; /\u0026gt; æ”¯æŒå‚æ•°ï¼š æ”¯æŒç›¸å¯¹è·¯å¾„ã€ç»å¯¹è·¯å¾„ã€Base64 å›¾åƒç­‰ åº”ç”¨åœºæ™¯ï¼š æ•°æ®ç»‘å®šå›¾åƒåœ°å€ åŠ¨æ€åŠ è½½å¤´åƒã€å›¾æ ‡ç­‰ 9. FileSizeToStringConverterï¼šå­—èŠ‚å¤§å°è‡ªåŠ¨è½¬ KB/MB/GB ç¤ºä¾‹ä»£ç ï¼š 1 2 // ViewModel public long FileSize { get; set; } = 1024 * 1024 * 10; // 10 MB 1 2 \u0026lt;!-- XAML --\u0026gt; \u0026lt;TextBlock Text=\u0026#34;{Binding FileSize, Converter={StaticResource FileSizeToStringConverter}}\u0026#34; /\u0026gt; è¾“å‡ºç»“æœï¼š10.00 MB\nåº”ç”¨åœºæ™¯ï¼š æ–‡ä»¶ç®¡ç†å™¨ã€ç£ç›˜æ¸…ç†å·¥å…·ç­‰æ˜¾ç¤ºæ–‡ä»¶å¤§å° æ—¥å¿—ç³»ç»Ÿã€ç›‘æ§ç³»ç»Ÿä¸­æ˜¾ç¤ºå†…å­˜å ç”¨ 10. StringFormatConverterï¼šè‡ªå®šä¹‰å­—ç¬¦ä¸²æ ¼å¼åŒ– ç¤ºä¾‹ä»£ç ï¼š 1 2 // ViewModel public decimal Price { get; set; } = 99.99m; 1 2 \u0026lt;!-- XAML --\u0026gt; \u0026lt;TextBlock Text=\u0026#34;{Binding Price, Converter={StaticResource StringFormatConverter}, ConverterParameter=\u0026#39;{}{0:C}\u0026#39;}\u0026#34; /\u0026gt; è¾“å‡ºç»“æœï¼š$99.99ï¼ˆæ ¹æ®æ–‡åŒ–è®¾ç½®ï¼‰\nåº”ç”¨åœºæ™¯ï¼š è´§å¸ã€ç™¾åˆ†æ¯”ã€æ•°å­—æ ¼å¼åŒ–æ˜¾ç¤º æ”¯æŒåŠ¨æ€æ ¼å¼æ¨¡æ¿ ğŸŒ æ–‡åŒ–æ•æ„Ÿæ”¯æŒï¼ˆCulture Awarenessï¼‰ æ‰€æœ‰è½¬æ¢å™¨éƒ½æ”¯æŒæ–‡åŒ–æ„ŸçŸ¥ï¼š\n1 2 // åœ¨ App.xaml.cs æˆ–åˆå§‹åŒ–æ—¶é…ç½® ValueConvertersConfig.DefaultPreferredCulture = ConverterCulture.CurrentUICulture; ä½ ä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶æ›´æ”¹è¯­è¨€å¹¶åˆ·æ–°ç•Œé¢ï¼š\n1 Thread.CurrentThread.CurrentUICulture = new CultureInfo(\u0026#34;zh-CN\u0026#34;); ğŸ“¦ æ€»ç»“ è½¬æ¢å™¨åç§° åŠŸèƒ½ åº”ç”¨åœºæ™¯ DateTimeConverter æ—¥æœŸæ ¼å¼åŒ– æ—¶é—´æˆ³å±•ç¤º BooleanToVisibilityConverter å¸ƒå°”è½¬å¯è§†æ€§ æ§ä»¶æ˜¾ç¤ºéšè— EnumWrapperConverter æšä¸¾æœ¬åœ°åŒ– ä¸‹æ‹‰æ¡†ã€çŠ¶æ€æ  InvertBooleanConverter å¸ƒå°”å–å æ§ä»¶çŠ¶æ€åè½¬ NullToVisibilityConverter ç©ºå€¼æ§åˆ¶å¯è§†æ€§ éšè—ç©ºå­—æ®µ EnumToBooleanConverter æšä¸¾åŒ¹é…å¸ƒå°” æƒé™æ§åˆ¶ ImageSourceConverter å­—ç¬¦ä¸²è·¯å¾„è½¬å›¾åƒæº å›¾åƒç»‘å®š FileSizeToStringConverter å­—èŠ‚æ•°å¤§å°è½¬æ˜“è¯»æ ¼å¼ æ–‡ä»¶ä¿¡æ¯å±•ç¤º StringFormatConverter å­—ç¬¦ä¸²æ ¼å¼åŒ– è´§å¸ã€ç™¾åˆ†æ¯” BooleanAndConverter, BooleanOrConverter å¤šä¸ªå¸ƒå°”å€¼é€»è¾‘è¿ç®— è¡¨å•éªŒè¯ ğŸ§© ç»“è¯­ï¼šä¸ºä»€ä¹ˆæ¨èä½¿ç”¨ ValueConverters.NETï¼Ÿ âœ… æä¾›äº†å¸¸è§åœºæ™¯ä¸‹çš„é«˜è´¨é‡ IValueConverter å®ç° âœ… æ”¯æŒå¤šè¯­è¨€ã€æ–‡åŒ–æ•æ„Ÿ âœ… æ”¯æŒ WPFã€Xamarin.Formsã€MAUI ç­‰ä¸»æµ UI æ¡†æ¶ âœ… å¯æ‰©å±•æ€§å¼ºï¼Œæ˜“äºå°è£…å¤ç”¨ âœ… å‡å°‘ Code-Behindï¼Œå¢å¼º MVVM è§£è€¦èƒ½åŠ› ğŸ“¦ æ¨èä½¿ç”¨æ–¹å¼ å®‰è£…åŒ…ï¼š 1 PM\u0026gt; Install-Package ValueConverters å…¨å±€æ³¨å†Œï¼ˆApp.xamlï¼‰ï¼š 1 2 3 4 \u0026lt;Application.Resources\u0026gt; \u0026lt;converters:BooleanToVisibilityConverter x:Key=\u0026#34;BoolToVisConverter\u0026#34;/\u0026gt; \u0026lt;converters:DateTimeConverter x:Key=\u0026#34;DateTimeConverter\u0026#34; Format=\u0026#34;yyyy-MM-dd\u0026#34;/\u0026gt; \u0026lt;/Application.Resources\u0026gt; ğŸ“š å‚è€ƒèµ„æ–™ GitHub ä»“åº“ï¼šhttps://github.com/thomasgalliker/ValueConverters.NET NuGet åœ°å€ï¼š WPF / WinForms / UWP Xamarin.Forms .NET MAUI ","date":"2025-06-24T17:39:03+08:00","image":"https://www.notion.so/images/page-cover/webb3.jpg","permalink":"https://dumbnessrf.github.io/p/value_converters/","title":"Value Converters"},{"content":"CalcBinding æ˜¯ä¸€ä¸ª WPF ç¬¬ä¸‰æ–¹ç»‘å®šå¢å¼ºåº“ï¼Œå®ƒå…è®¸ä½ åœ¨ XAML ä¸­ä½¿ç”¨è¡¨è¾¾å¼è¿›è¡Œæ•°æ®ç»‘å®šè®¡ç®—ï¼Œè€Œæ— éœ€åœ¨ ViewModel ä¸­å†™é¢å¤–çš„å±æ€§æˆ–è½¬æ¢å™¨ï¼ˆConverterï¼‰ã€‚\u0026ndash;å®ƒéå¸¸é€‚åˆç”¨äºç®€å•çš„æ•°å­¦è¿ç®—ã€å­—ç¬¦ä¸²æ‹¼æ¥ã€æ¡ä»¶åˆ¤æ–­ç­‰åœºæ™¯ã€‚\nğŸ“¦ ä¸€ã€ç®€ä»‹ GitHub åœ°å€ï¼šhttps://github.com/Alex198711/CalcBinding åŠŸèƒ½ï¼šæ”¯æŒç±»ä¼¼ {calcBinding Path=Width*2+Height} çš„è¡¨è¾¾å¼ç»‘å®š ä¸ä¾èµ– IValueConverter æ”¯æŒå¤šç»‘å®šã€æ¡ä»¶è¯­å¥ã€å‡½æ•°è°ƒç”¨ç­‰ ğŸ§© äºŒã€å®‰è£…æ–¹å¼ ä½ å¯ä»¥é€šè¿‡ NuGet å®‰è£…ï¼š\n1 Install-Package CalcBinding ç„¶ååœ¨ XAML ä¸­æ·»åŠ å‘½åç©ºé—´å¼•ç”¨ï¼š\n1 xmlns:calc=\u0026#34;clr-namespace:CalcBinding;assembly=CalcBinding\u0026#34; ğŸ“˜ ä¸‰ã€å¸¸è§ç”¨æ³•ä¸ç¤ºä¾‹ âœ… ç¤ºä¾‹ 1ï¼šåŸºæœ¬æ•°å­¦è¿ç®— 1 \u0026lt;TextBlock Text=\u0026#34;{calc:Binding Path=Width * 2 + Height}\u0026#34; /\u0026gt; å°† Width ä¹˜ä»¥ 2 å†åŠ ä¸Š Heightï¼Œç»“æœä½œä¸º TextBlock.Text\nâœ… ç¤ºä¾‹ 2ï¼šå­—ç¬¦ä¸²æ‹¼æ¥ 1 \u0026lt;TextBlock Text=\u0026#34;{calc:Binding Path=FirstName + \u0026#39; \u0026#39; + LastName}\u0026#34; /\u0026gt; æŠŠä¸¤ä¸ªå­—æ®µæ‹¼æ¥æˆå®Œæ•´å§“å\nâœ… ç¤ºä¾‹ 3ï¼šå¸ƒå°”å€¼è½¬å¯è§æ€§ï¼ˆVisibilityï¼‰ 1 2 \u0026lt;Button Content=\u0026#34;Submit\u0026#34; Visibility=\u0026#34;{calc:Binding Path=IsEnabled ? Visible : Collapsed}\u0026#34; /\u0026gt; ä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦å®ç° Visibility æ§åˆ¶ï¼Œæ— éœ€ Converter\nâœ… ç¤ºä¾‹ 4ï¼šç»‘å®šå¤šä¸ªå±æ€§å¹¶åšè®¡ç®— 1 \u0026lt;TextBlock Text=\u0026#34;{calc:MultiBinding Path1=Value1, Path2=Value2, Expression=Path1 + Path2}\u0026#34; /\u0026gt; å¤šç»‘å®šæ”¯æŒæœ€å¤š 5 ä¸ªè·¯å¾„ï¼ˆPath1~Path5ï¼‰ï¼Œå¯ä»¥ç»„åˆä»»æ„è¡¨è¾¾å¼\nâœ… ç¤ºä¾‹ 5ï¼šä½¿ç”¨ Math å‡½æ•°ï¼ˆå¦‚ Maxã€Minã€Roundï¼‰ 1 \u0026lt;TextBlock Text=\u0026#34;{calc:Binding Path=Math.Max(Width, Height)}\u0026#34; /\u0026gt; æ˜¾ç¤º Width å’Œ Height ä¸­è¾ƒå¤§çš„é‚£ä¸ª\næ”¯æŒçš„å‡½æ•°åŒ…æ‹¬ï¼š\nMath.Abs Math.Round Math.Min Math.Max Math.Ceiling Math.Floor Math.Pow(x, y) Math.Sqrt(x) âœ… ç¤ºä¾‹ 6ï¼šæ¡ä»¶åˆ¤æ–­ç»“åˆç»‘å®š 1 \u0026lt;TextBlock Text=\u0026#34;{calc:Binding Path=Value \u0026gt; 0 ? Value : 0}\u0026#34; /\u0026gt; å¦‚æœ Value å¤§äº 0ï¼Œåˆ™æ˜¾ç¤º Valueï¼Œå¦åˆ™æ˜¾ç¤º 0\nâœ… ç¤ºä¾‹ 7ï¼šç»‘å®šé›†åˆå…ƒç´  1 \u0026lt;TextBlock Text=\u0026#34;{calc:Binding Path=Items[0].Price * Items[0].Quantity}\u0026#34; /\u0026gt; ç»‘å®šé›†åˆä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„å±æ€§å¹¶è¿›è¡Œè®¡ç®—\nâœ… ç¤ºä¾‹ 8ï¼šç»‘å®šèµ„æºä¸­çš„é™æ€å€¼ 1 2 3 4 5 \u0026lt;Window.Resources\u0026gt; \u0026lt;sys:Double x:Key=\u0026#34;ScaleFactor\u0026#34;\u0026gt;1.5\u0026lt;/sys:Double\u0026gt; \u0026lt;/Window.Resources\u0026gt; \u0026lt;TextBlock Text=\u0026#34;{calc:Binding Path=Width * {StaticResource ScaleFactor}}\u0026#34; /\u0026gt; å¯ä»¥åœ¨è¡¨è¾¾å¼ä¸­åµŒå…¥é™æ€èµ„æº\nâœ… ç¤ºä¾‹ 9ï¼šä½¿ç”¨æ–¹æ³•è°ƒç”¨ï¼ˆéœ€è¦æ³¨å†Œï¼‰ ä½ å¯ä»¥åœ¨ä»£ç ä¸­æ³¨å†Œè‡ªå®šä¹‰å‡½æ•°ï¼Œä¾‹å¦‚ï¼š\n1 CalcBindingHelper.RegisterFunction(\u0026#34;Format\u0026#34;, (string format, object arg) =\u0026gt; string.Format(format, arg)); ç„¶ååœ¨ XAML ä¸­ä½¿ç”¨ï¼š\n1 \u0026lt;TextBlock Text=\u0026#34;{calc:Binding Path=Format(\u0026#39;{0:C}\u0026#39;, Price)}\u0026#34; /\u0026gt; ç±»ä¼¼æ ¼å¼åŒ–è´§å¸è¾“å‡ºï¼Œæ›¿ä»£ StringFormat\nâœ… ç¤ºä¾‹ 10ï¼šç»‘å®šä¾èµ–å±æ€§ï¼ˆå¦‚æ§ä»¶å°ºå¯¸ï¼‰ 1 2 3 4 5 \u0026lt;Canvas\u0026gt; \u0026lt;Ellipse Width=\u0026#34;50\u0026#34; Height=\u0026#34;50\u0026#34; Canvas.Left=\u0026#34;{calc:Binding ElementName=canvas, Path=ActualWidth / 2 - 25}\u0026#34; Canvas.Top=\u0026#34;{calc:Binding ElementName=canvas, Path=ActualHeight / 2 - 25}\u0026#34; /\u0026gt; \u0026lt;/Canvas\u0026gt; è®¡ç®—æ§ä»¶å±…ä¸­ä½ç½®ï¼Œä¸éœ€è¦åœ¨åå°ä»£ç ä¸­è®¾ç½®å¸ƒå±€é€»è¾‘\nğŸ§ª å››ã€æ€§èƒ½ä¸æ³¨æ„äº‹é¡¹ æ³¨æ„ç‚¹ è¯´æ˜ è¡¨è¾¾å¼å¤æ‚åº¦ é¿å…è¿‡äºå¤æ‚çš„åµŒå¥—è¡¨è¾¾å¼ï¼Œå½±å“å¯è¯»æ€§å’Œè°ƒè¯• è°ƒè¯•å›°éš¾ è¡¨è¾¾å¼é”™è¯¯ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œåªä¼šæ˜¾ç¤ºä¸ºç©ºæˆ–é»˜è®¤å€¼ æ€§èƒ½ ç›¸æ¯”æ™®é€šç»‘å®šç¨æ…¢ï¼Œä½†å¯¹ UI å½±å“ä¸å¤§ å…¼å®¹æ€§ æ”¯æŒ WPFï¼Œä¸æ”¯æŒ UWP æˆ– .NET MAUI ğŸ¯ äº”ã€é€‚åˆä½¿ç”¨çš„åœºæ™¯ ç®€å•çš„æ•°å­¦è®¡ç®—ç»‘å®š å­—ç¬¦ä¸²æ‹¼æ¥ æ¡ä»¶æ§åˆ¶ï¼ˆVisible/Collapsedï¼‰ å¸ƒå±€è°ƒæ•´ï¼ˆåŸºäºæ§ä»¶å¤§å°ï¼‰ æ›¿ä»£ç®€å• Converter çš„åœºæ™¯ ğŸ§© å…­ã€æ›¿ä»£æ–¹æ¡ˆå¯¹æ¯” æ–¹æ¡ˆ ä¼˜ç‚¹ ç¼ºç‚¹ CalcBinding å¿«é€Ÿç¼–å†™è¡¨è¾¾å¼ï¼Œæ— éœ€ Converter ä¸æ˜“è°ƒè¯•ï¼Œä¸é€‚åˆå¤æ‚é€»è¾‘ IValueConverter æ›´å¼ºç±»å‹å®‰å…¨å’Œé€»è¾‘æ§åˆ¶ éœ€è¦ç¼–å†™é¢å¤–ç±» MultiBinding + IMultiValueConverter æ”¯æŒå¤šå€¼ç»‘å®š å®ç°ç¹ç XAML Binding.StringFormat ç®€å•æ ¼å¼åŒ– ä¸æ”¯æŒè¡¨è¾¾å¼è®¡ç®— ","date":"2025-06-06T14:46:48+08:00","image":"https://www.notion.so/images/page-cover/rijksmuseum_mignons_1660.jpg","permalink":"https://dumbnessrf.github.io/p/calcbinding/","title":"WPFæŠ€å·§-XAMLä¸­ä½¿ç”¨è¡¨è¾¾å¼è¿›è¡Œæ•°æ®ç»‘å®šè®¡ç®—"},{"content":"ReactiveUI åŸºç¡€ç”¨æ³• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 using System; using System.Reactive.Linq; using ReactiveUI; namespace AvaloniaApplication1.ViewModels; public partial class MainWindowViewModel : ViewModelBase { [ObservableProperty] public partial string Text1 { get; set; } [ObservableProperty] public partial string Text2 { get; set; } [ObservableProperty] public partial string Result { get; set; } public MainWindowViewModel() { this.WhenAnyValue(s =\u0026gt; s.Text1, s =\u0026gt; s.Text2) .Where(s =\u0026gt; double.TryParse(s.Item1, out _) \u0026amp;\u0026amp; double.TryParse(s.Item2, out _)) .Subscribe(s =\u0026gt; Calculate()); this.WhenAnyValue(s =\u0026gt; s.Text1, s =\u0026gt; s.Text2) .Where(s =\u0026gt; !double.TryParse(s.Item1, out _) || !double.TryParse(s.Item2, out _)) .Subscribe(s =\u0026gt; Clear()); } void Calculate() { Result = (double.Parse(Text1) + double.Parse(Text2)).ToString(); } void Clear() { Result = string.Empty; } } åªæœ‰å½“Text1å’ŒText2å‘ç”Ÿå˜åŒ–ä¸”ä¸ä¸ºç©ºæ—¶æ‰è®¢é˜…Calculateäº‹ä»¶ï¼Œä¸ºç©ºæ—¶è®¢é˜…Clearäº‹ä»¶\nWhenAnyã€WhenAnyValueã€WhenAnyObservable WhenAnyÂ æ˜¯ä¸€ç»„æ‰©å±•æ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½ä»¥å‰ç¼€Â WhenAnyÂ å¼€å¤´ï¼Œå¯ç”¨äºåœ¨å¯¹è±¡çš„å±æ€§å‘ç”Ÿæ›´æ”¹æ—¶è·å–é€šçŸ¥ã€‚\nåœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼ŒWhenAnyValueÂ åº”è¯¥ä¼˜å…ˆäºÂ WhenAnyï¼Œå¹¶ä¸”æ‚¨ä¸éœ€è¦çŸ¥é“Senderæˆ–Expression\nWhenAnyÂ å˜ä½“æ”¯æŒå¤šç§å±æ€§æ›´æ”¹é€šçŸ¥ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥æ”¯æŒè§†å›¾æ¨¡å‹çš„Â INotifyPropertyChangedÂ ã€åŸºäº Windows çš„ XAML å¹³å°ä¸Šçš„Â DependencyPropertyÂ ä»¥åŠ Apple å¹³å°ä¸Šçš„Â NSObjectÂ å±æ€§æ›´æ”¹é€šçŸ¥ã€‚è¦è·å–å€¼æ›´æ”¹é€šçŸ¥ï¼Œæ‚¨çš„å¯¹è±¡å¿…é¡»å®ç°è¿™äº›å·²çŸ¥çš„å±æ€§æ›´æ”¹é€šçŸ¥æœºåˆ¶ä¹‹ä¸€ã€‚ å¦‚æœå…¶ä¸­ä¸€ä¸ªä¸æ”¯æŒï¼Œæ‚¨å°†åªèƒ½è·å–å±æ€§çš„åˆå§‹å€¼ï¼Œè€Œä¸ä¼šæ”¶åˆ°ä»»ä½•æ›´æ–°é€šçŸ¥ã€‚æ­¤å¤–ï¼Œè¿è¡Œæ—¶è¿˜ä¼šå‘å‡ºè­¦å‘Šï¼ˆè¯·ç¡®ä¿æ‚¨å·²æ³¨å†ŒÂ ILoggerÂ æœåŠ¡ä»¥ä¾¿æŸ¥çœ‹æ­¤è­¦å‘Šï¼‰ã€‚\nWhenAnyValue IObservable\u0026lt;TRet\u0026gt; WhenAnyValue\u0026lt;TSender, TRet\u0026gt;( this TSender? sender, Expression\u0026lt;Func\u0026lt;TSender, TRet\u0026gt;\u0026gt; property1)\nç”±äºè¡¨è¾¾å¼å°šä¸æ”¯æŒæ­¤åŠŸèƒ½ï¼Œå› æ­¤Â WhenAnyValueÂ ä¸èƒ½ç›´æ¥æ‰§è¡Œç©ºä¼ æ’­ã€‚ ä½ å¯ä»¥é€šè¿‡å°†Â WhenAnyValue()Â è°ƒç”¨é“¾æ¥åˆ°æ¯ä¸ªå±æ€§æ¥æ¨¡æ‹Ÿå¯¹ç©ºå€¼ä¼ æ’­çš„æ”¯æŒã€‚ä»¥ä¸‹æ˜¯ç¤ºä¾‹ï¼š\n1 2 this.WhenAnyValue(x =\u0026gt; x.Foo, x =\u0026gt; x.Foo.Bar, x =\u0026gt; x.Foo.Bar.Baz, (foo, bar, baz) =\u0026gt; foo?.Bar?.Baz) .Subscribe(x =\u0026gt; Console.WriteLine(x)); WhenAny WhenAnyÂ å…è®¸æ‚¨è·å–ä¼ é€’åˆ°Â WhenAny ä¸­çš„è¡¨è¾¾å¼å’Œè¡¨è¾¾å¼ã€‚è¿™å¯¹äºä¸€äº›åœºæ™¯æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œæ¯”å¦‚åœ¨è§†å›¾ä¸­ï¼Œä½ éœ€è¦çŸ¥é“è°ƒç”¨å±æ€§æ”¹å˜çš„æ§ä»¶ã€‚\nWhenAnyÂ ä»…å‘ŠçŸ¥æ‚¨è¾“å…¥è¡¨è¾¾å¼çš„æœ€ç»ˆå€¼ä½•æ—¶å‘ç”Ÿå˜åŒ–ã€‚å³ä½¿æœ€ç»ˆçš„å˜åŒ–æ˜¯ç”±äºè¡¨è¾¾å¼é“¾ä¸­çš„ä¸­é—´å€¼å¼•èµ·çš„ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªè§£é‡Šæ€§ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 this.WhenAny(x =\u0026gt; x.Foo.Bar.Baz, _ =\u0026gt; \u0026#34;Hello!\u0026#34;) .Subscribe(x =\u0026gt; Console.WriteLine(x)); // Example 1 this.Foo.Bar.Baz = \u0026#34;Something\u0026#34;; \u0026gt;\u0026gt;\u0026gt; Hello! // Example 2: Nothing printed! Because the string value does not change this.Foo.Bar.Baz = \u0026#34;Something\u0026#34;; // Example 3: Still nothingï¼Because the expression is Foo.Bar.Bazï¼Œnot Foo.Bar this.Foo.Bar = new Bar() { Baz = \u0026#34;Something\u0026#34; }; // Example 4: The result changes, so we print this.Foo.Bar = new Bar() { Baz = \u0026#34;Else\u0026#34; }; \u0026gt;\u0026gt;\u0026gt; Hello! WhenAnyÂ ä»…åœ¨è¯»å–ç»™å®šè¡¨è¾¾å¼ä¸ä¼šæŠ›å‡ºÂ NullReferenceExceptionÂ æ—¶æ‰ä¼šå‘é€é€šçŸ¥ã€‚è¯·è€ƒè™‘ä»¥ä¸‹ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 this.WhenAny(x =\u0026gt; x.Foo.Bar.Baz, _ =\u0026gt; \u0026#34;Hello!\u0026#34;) .Subscribe(x =\u0026gt; Console.WriteLine(x)); // Example 1 this.Foo.Bar.Baz = null; \u0026gt;\u0026gt;\u0026gt; Hello! // Example 2: Nothing printed! this.Foo.Bar = null; // Example 3 this.Foo.Bar = new Bar() { Baz = \u0026#34;Something\u0026#34; }; \u0026gt;\u0026gt;\u0026gt; Hello! WhenAnyObservable WhenAnyObservableÂ ä¼šè§‚å¯Ÿä¸€ä¸ªæˆ–å¤šä¸ªå¯è§‚å¯Ÿå¯¹è±¡å¹¶æä¾›æœ€æ–°çš„å¯è§‚å¯Ÿå€¼ï¼Œå¤„ç†æ–°å¯è§‚å¯Ÿå¯¹è±¡çš„è‡ªåŠ¨è®¢é˜…ä»¥åŠÂ WhenAnyObservableÂ å¯è§‚å¯Ÿå¯¹è±¡çš„å¤„ç†ã€‚WhenAnyObservable é»˜è®¤ä¸ºæƒ°æ€§è®¢é˜…ï¼Œè¿™æ„å‘³ç€åœ¨è®¢é˜…ä¹‹å‰ä¸ä¼šè·å¾—ä»»ä½•å€¼(å…¶ä»–çš„Whenåœ¨Ctorå®Œæˆæ—¶å°±ä¼šé€šçŸ¥ï¼Œè¿™ä¸ªåªæœ‰åœ¨æ›´æ”¹æ—¶æ‰ä¼šé€šçŸ¥)ã€‚\næ¯å½“æ–‡æ¡£ä¿å­˜æ—¶ï¼Œå®ƒéƒ½ä¼šæ‰“å°æ¥è‡ªÂ IsSavedÂ å¯è§‚å¯Ÿå˜é‡çš„å€¼ã€‚å½“Â DocumentÂ å±æ€§å‘ç”Ÿæ›´æ”¹æ—¶ï¼Œå®ƒå°†è‡ªåŠ¨å–æ¶ˆè®¢é˜…å¹¶é‡æ–°è®¢é˜…ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 public class MyViewModel { [Reactive] public Document Document { get; set; } public MyViewModel() { this.WhenAnyObservable(x =\u0026gt; x.Document.IsSaved).Subscribe(x =\u0026gt; Console.WriteLine($\u0026#34;Document Saved: {x}\u0026#34;)); } } public class Document { public IObservable\u0026lt;bool\u0026gt; IsSaved { get; } } Where ä»…ä» Observable ä¸­å‘å‡ºé‚£äº›é€šè¿‡è°“è¯æµ‹è¯•çš„é¡¹ IObservable\u0026lt;TSource\u0026gt; Where\u0026lt;TSource\u0026gt;(this IObservable\u0026lt;TSource\u0026gt; source, Func\u0026lt;TSource, bool\u0026gt; predicate)\nSubscribe æ ¹æ®äº‹ä»¶æºçš„å‘å‡ºçš„äº‹ä»¶æˆ–é€šçŸ¥è¿›è¡Œæ“ä½œ\næ³¨æ„ï¼šè¯¥æ“ä½œç¬¦ä¹‹åå°†è¿”å›IDisposableï¼Œè€Œä¸æ˜¯IObservable\nIDisposable Subscribe\u0026lt;T\u0026gt;(this IObservable\u0026lt;T\u0026gt; source, Action\u0026lt;T\u0026gt; onNext)\nSubscribeOn æŒ‡å®šäº‹ä»¶æºåœ¨è®¢é˜…æ—¶åº”ä½¿ç”¨çš„è°ƒåº¦å™¨\nSubscribeOnÂ è¿ç®—ç¬¦æŒ‡å®š Observable å°†å¼€å§‹åœ¨å“ªä¸ªçº¿ç¨‹ä¸Šè¿è¡Œï¼Œè€Œä¸ç®¡è¯¥è¿ç®—ç¬¦åœ¨è¿ç®—ç¬¦é“¾ä¸­çš„å“ªä¸ªç‚¹è¢«è°ƒç”¨ã€‚å¦ä¸€æ–¹é¢ï¼ŒObserveOnÂ ä¼šå½±å“ Observable å°†ä½¿ç”¨çš„çº¿ç¨‹ï¼ŒÂ è¯¥çº¿ç¨‹ä½äºè¯¥è¿ç®—ç¬¦å‡ºç°çš„ä½ç½®ä¸‹æ–¹ã€‚ å› æ­¤ï¼Œæ‚¨å¯ä»¥è°ƒç”¨ åœ¨ Observable é“¾ä¸­çš„ä¸åŒç‚¹å¤šæ¬¡è¿›è¡Œ ObserveOnÂ è¿ç®—ç¬¦ï¼Œä»¥ä¾¿æ›´æ”¹æŸäº›è¿ç®—ç¬¦åœ¨å“ªäº›çº¿ç¨‹ä¸Šè¿›è¡Œä½œã€‚\nIObservable\u0026lt;TSource\u0026gt; SubscribeOn\u0026lt;TSource\u0026gt;(this IObservable\u0026lt;TSource\u0026gt; source, IScheduler scheduler)\nğŸ“¢ 1 2 3 4 this.WhenAnyValue(s =\u0026gt; s.Text1, s =\u0026gt; s.Text2) .SubscribeOn(RxApp.MainThreadScheduler) .SubscribeOn(RxApp.TaskpoolScheduler) .SubscribeOn(SynchronizationContext.Current) ğŸ“¢ RxApp.MainThreadScheduler\nè·å–æˆ–è®¾ç½®ä¸€ä¸ªè°ƒåº¦å™¨ï¼Œè¯¥è°ƒåº¦å™¨ç”¨äºå¯¹é‚£äº›åº”åœ¨ â€œç”¨æˆ·ç•Œé¢ (UI) çº¿ç¨‹ä¸Šâ€ è¿è¡Œçš„å·¥ä½œé¡¹è¿›è¡Œè°ƒåº¦ã€‚åœ¨æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œè¿™å°†æ˜¯Â DispatcherSchedulerï¼ˆåˆ†å‘å™¨è°ƒåº¦å™¨ï¼‰ï¼Œè€Œåœ¨å•å…ƒæµ‹è¯•æ¨¡å¼ä¸‹ï¼Œè¿™å°†æ˜¯Â Immediateï¼ˆå³æ—¶è°ƒåº¦å™¨ï¼‰ï¼Œä»¥ä¾¿ç®€åŒ–å¸¸è§å•å…ƒæµ‹è¯•çš„ç¼–å†™å·¥ä½œã€‚\nRxApp.TaskpoolScheduler\nè·å–æˆ–è®¾ç½®ç”¨äºè°ƒåº¦å·¥ä½œé¡¹ä»¥åœ¨åå°çº¿ç¨‹ä¸­è¿è¡Œçš„è°ƒåº¦å™¨ã€‚åœ¨ä¸¤ç§æ¨¡å¼ä¸‹ï¼Œè¿™äº›å·¥ä½œé¡¹éƒ½å°†åœ¨ TPLï¼ˆä»»åŠ¡å¹¶è¡Œåº“ï¼‰ä»»åŠ¡æ± ä¸­è¿è¡Œã€‚\nSynchronizationContext.Current Thread.CurrentThread._synchronizationContext\nThrottle æ­¤æ“ä½œç¬¦ä¼šå¯¹æºåºåˆ—è¿›è¡Œé™æµï¼Œå…·ä½“åšæ³•æ˜¯å¯¹æ¯ä¸ªå…ƒç´ ä¿ç•™Â dueTimeï¼ˆæŒ‡å®šæ—¶é•¿ï¼‰ã€‚è‹¥åœ¨è¿™ä¸ªæ—¶é—´çª—å£å†…åˆäº§ç”Ÿäº†å¦ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆå‰ä¸€ä¸ªå…ƒç´ ä¼šè¢«ä¸¢å¼ƒï¼Œå¹¶ä¸”ä¼šä¸ºå½“å‰å…ƒç´ å¯åŠ¨ä¸€ä¸ªæ–°çš„è®¡æ—¶å™¨ï¼Œå¦‚æ­¤å¾ªç¯å¾€å¤ã€‚å¯¹äºå…ƒç´ é—´é—´éš”ä»ä¸å¤§äºæˆ–ç­‰äºÂ dueTimeÂ çš„æµï¼Œç»è¿‡å¤„ç†åçš„æµå°†ä¸ä¼šäº§ç”Ÿä»»ä½•å…ƒç´ ã€‚è‹¥è¦åœ¨ä¿è¯å…ƒç´ å‘¨æœŸæ€§äº§ç”Ÿçš„åŒæ—¶å‡å°‘æµçš„æ•°æ®é‡ï¼Œå¯è€ƒè™‘ä½¿ç”¨Â Observable.SampleÂ ç³»åˆ—æ“ä½œç¬¦ã€‚\n1 2 3 this.WhenAnyValue(s =\u0026gt; s.Text1) .Throttle(TimeSpan.FromSeconds(1)) .Subscribe(s =\u0026gt; Calculate()); Sampleã€Interval 1 2 3 4 5 6 var sub = Observable .Interval(TimeSpan.FromSeconds(0.01)) .Sample(TimeSpan.FromMilliseconds(500)) .Subscribe(s =\u0026gt; Result=s.ToString()); await Task.Delay(TimeSpan.FromSeconds(2)); sub.Dispose(); æ¯ 10 æ¯«ç§’å‘å‡ºä¸€ä¸ªå€¼çš„å¯è§‚å¯Ÿåºåˆ—ï¼Œæ¯ 500 æ¯«ç§’å¯¹è¿™ä¸ªåºåˆ—è¿›è¡Œä¸€æ¬¡é‡‡æ ·ï¼Œå°†é‡‡æ ·å¾—åˆ°çš„å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶èµ‹å€¼ç»™Â ResultÂ å˜é‡ï¼ŒæŒç»­æ‰§è¡Œ 2 ç§’åå–æ¶ˆè®¢é˜…å¹¶é‡Šæ”¾èµ„æºï¼›å°½ç®¡2så†…é€šè¿‡Intervaläº§ç”Ÿäº†200ä¸ªï¼Œä½†æ˜¯ç”±äºSampleï¼Œæˆ‘åªé‡‡æ ·åˆ°äº†4ä¸ª\nTimerã€Amb 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 using System.Reactive.Linq; var observable1 = Observable.Timer(TimeSpan.FromMilliseconds(200)) .Select(_ =\u0026gt; \u0026#34;Observable 1\u0026#34;); // åˆ›å»ºç¬¬äºŒä¸ªå¯è§‚æµ‹åºåˆ—ï¼Œå»¶è¿Ÿ 100 æ¯«ç§’åå‘å°„å…ƒç´  var observable2 = Observable.Timer(TimeSpan.FromMilliseconds(100)) .Select(_ =\u0026gt; \u0026#34;Observable 2\u0026#34;); // ä½¿ç”¨ Amb æ“ä½œç¬¦é€‰æ‹©ç¬¬ä¸€ä¸ªäº§ç”Ÿå…ƒç´ çš„åºåˆ— var result = observable1.Amb(observable2); // è®¢é˜…ç»“æœåºåˆ— result.Subscribe( value =\u0026gt; Console.WriteLine($\u0026#34;Received: {value}\u0026#34;), error =\u0026gt; Console.WriteLine($\u0026#34;Error: {error}\u0026#34;), () =\u0026gt; Console.WriteLine(\u0026#34;Completed\u0026#34;) ); å€ŸåŠ©Â Observable.TimerÂ æ¥åˆ›å»ºä¸¤ä¸ªå¯è§‚æµ‹åºåˆ—Â observable1Â å’ŒÂ observable2ï¼Œå®ƒä»¬ä¼šåœ¨ç‰¹å®šå»¶è¿Ÿåå‘å°„å…ƒç´ ã€‚\nåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œç”±äºÂ observable2Â å»¶è¿Ÿ 100 æ¯«ç§’ï¼Œæ¯”Â observable1Â çš„ 200 æ¯«ç§’å»¶è¿Ÿè¦çŸ­ï¼Œæ‰€ä»¥Â observable2Â ä¼šç‡å…ˆäº§ç”Ÿå…ƒç´ ï¼ŒAmbÂ æ“ä½œç¬¦ä¼šé€‰æ‹©Â observable2Â å¹¶å¿½ç•¥Â observable1ã€‚\nReceived: Observable 2\nCompleted\nRetryã€Catch Retryå…è®¸åœ¨å‘ç”Ÿé”™è¯¯æ—¶æˆ–æŠ›å‡ºé”™è¯¯æ—¶é‡æ–°è®¢é˜…æºåºåˆ—ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç åˆ›å»ºä¸€ä¸ªä¼šæŠ›å‡ºå¼‚å¸¸çš„åºåˆ—ï¼Œå¹¶é€šè¿‡Retry(2)æœ€å¤šé‡è¯•2æ¬¡ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 using System; using System.Reactive.Disposables; using System.Reactive.Linq; var source = Observable.Create\u0026lt;int\u0026gt;(observer =\u0026gt; { Console.WriteLine(\u0026#34;Doing work...\u0026#34;); // throw new Exception(\u0026#34;Initial failure\u0026#34;); observer.OnError(new Exception(\u0026#34;Initial failure\u0026#34;)); return Disposable.Empty; }); source .Retry(2) // å‘ç”Ÿé”™è¯¯æ—¶é‡æ–°è®¢é˜…æºåºåˆ—ï¼Œæœ€å¤šå°è¯•2æ¬¡ .Subscribe( x =\u0026gt; Console.WriteLine(\u0026#34;OnNext: \u0026#34; + x), ex =\u0026gt; Console.WriteLine(\u0026#34;OnError: \u0026#34; + ex.Message), () =\u0026gt; Console.WriteLine(\u0026#34;OnCompleted\u0026#34;) ); è¾“å‡º\nDoing work\u0026hellip;\nDoing work\u0026hellip;\nOnError: Initial failure\n**Catch**ç”¨äºæ•è·å¼‚å¸¸å¹¶æ›¿æ¢ä¸ºæ–°çš„åºåˆ—ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç åœ¨å‘ç”Ÿé”™è¯¯åè¿”å›ä¸€ä¸ªå¤‡ç”¨å€¼ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 using System; using System.Reactive.Disposables; using System.Reactive.Linq; var source = Observable.Create\u0026lt;int\u0026gt;(observer =\u0026gt; { observer.OnError(new Exception(\u0026#34;Primary error\u0026#34;)); return Disposable.Empty; }); source .Catch(Observable.Return(42)) // æ•è·å¼‚å¸¸å¹¶æ›¿æ¢ä¸ºå€¼42 .Subscribe( x =\u0026gt; Console.WriteLine(\u0026#34;OnNext: \u0026#34; + x), ex =\u0026gt; Console.WriteLine(\u0026#34;OnError: \u0026#34; + ex.Message), () =\u0026gt; Console.WriteLine(\u0026#34;OnCompleted\u0026#34;) ); OnNext: 42\nOnCompleted\nScanã€Buffer Scan ç”¨äºå¯¹åºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ è¿ç»­åº”ç”¨ç´¯ç§¯å‡½æ•°ï¼Œå¹¶è¾“å‡ºä¸­é—´ç»“æœã€‚ç±»ä¼¼äºLINQçš„ Aggregateï¼Œä½†ä¼šå‘å°„æ‰€æœ‰ä¸­é—´å€¼\n1 2 3 4 5 6 7 using System.Reactive.Linq; var source = Observable.Range(1, 5); // ç”Ÿæˆ1åˆ°5çš„åºåˆ— source .Scan(0, (acc, val) =\u0026gt; acc + val) // åˆå§‹å€¼0ï¼Œç´¯åŠ å½“å‰å€¼ .Subscribe(x =\u0026gt; Console.WriteLine(\u0026#34;Scan Result: \u0026#34; + x)); Scan Result: 1\nScan Result: 3\nScan Result: 6\nScan Result: 10\nScan Result: 15\nBuffer å°†äº‹ä»¶æµæŒ‰æ—¶é—´æˆ–æ•°é‡åˆ†ç»„ï¼Œè¾“å‡ºæ‰¹é‡æ•°æ®ã€‚å¸¸è§ç”¨æ³•åŒ…æ‹¬æŒ‰æ—¶é—´çª—å£æˆ–å…ƒç´ æ•°é‡ç¼“å†²ã€‚\n1 2 3 4 5 6 7 8 9 using System.Reactive.Linq; var source = Observable.Interval(TimeSpan.FromSeconds(1)) // æ¯ç§’å‘å°„é€’å¢æ•° .Take(10); // é™åˆ¶æ€»å‘å°„æ¬¡æ•° // æŒ‰æ—¶é—´çª—å£ï¼ˆ5ç§’ï¼‰å’Œæœ€å¤§æ•°é‡ï¼ˆ3ä¸ªå…ƒç´ ï¼‰ç¼“å†² source .Buffer(TimeSpan.FromSeconds(5), 3) .Subscribe(buffer =\u0026gt; Console.WriteLine($\u0026#34;Buffered Count: {buffer.Count}\u0026#34;)); Buffered Count: 3 // ç¬¬1-3ç§’çš„æ•°æ®\nBuffered Count: 3 // ç¬¬4-5ç§’çš„æ•°æ®ï¼ˆå¯èƒ½è§¦å‘æ—¶é—´çª—å£ï¼‰\nBuffered Count: 3 // ä¸‹ä¸€ä¸ªçª—å£\nBuffered Count: 1 // å‰©ä½™1ä¸ªå…ƒç´ \nğŸ“¢ Buffer æ”¯æŒå¤šç§åˆ†ç»„ç­–ç•¥ï¼Œå¦‚çº¯æ—¶é—´çª—å£ï¼ˆBuffer(TimeSpan)ï¼‰ã€çº¯æ•°é‡ï¼ˆBuffer(count)ï¼‰æˆ–ä¸¤è€…ç»“åˆ\nDistinctã€DistinctUntilChanged Distinctï¼šè¿‡æ»¤åºåˆ—ä¸­æ‰€æœ‰é‡å¤çš„å…ƒç´ ï¼Œä»…ä¿ç•™é¦–æ¬¡å‡ºç°çš„å…ƒç´ ã€‚\n1 2 3 4 var source = new[] { 1, 2, 2, 3, 3, 3 }; source.ToObservable() .Distinct() .Subscribe(x =\u0026gt; Console.WriteLine(x)); è¾“å‡º ï¼š1, 2, 3\nDistinctUntilChangedï¼šä»…è¿‡æ»¤è¿ç»­é‡å¤ çš„å…ƒç´ ï¼Œä¿ç•™ç¬¬ä¸€ä¸ªï¼Œåç»­è¿ç»­ç›¸åŒçš„å…ƒç´ è¢«ä¸¢å¼ƒã€‚\n1 2 3 4 var source = new[] { 1, 2, 2, 3, 2, 2 }; source.ToObservable() .DistinctUntilChanged() .Subscribe(x =\u0026gt; Console.WriteLine(x)); è¾“å‡º ï¼š1, 2, 3, 2\nZip Zip ç”¨äºåˆå¹¶ä¸¤ä¸ªåºåˆ—ï¼Œé€ä¸ªé…å¯¹å…ƒç´ å¹¶ç”Ÿæˆç»“æœã€‚åœ¨ Rx ä¸­ï¼Œå®ƒå¸¸ç”¨äºç»„åˆå¤šä¸ªå¼‚æ­¥æ•°æ®æµã€‚\n1 2 3 4 5 6 7 using System.Reactive.Linq; var numbers = Observable.Range(1, 3); // 1, 2, 3 var letters = Observable.Return(\u0026#34;A\u0026#34;).Concat(Observable.Return(\u0026#34;B\u0026#34;)); // A, B numbers.Zip(letters, (n, l) =\u0026gt; $\u0026#34;{n}{l}\u0026#34;) .Subscribe(result =\u0026gt; Console.WriteLine(result)); 1A\n2B\nDelayã€Doã€TimeInterval 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 using System; using System.Reactive.Linq; using System.Reactive.Concurrency; class Program { static void Main() { var source = Observable.Interval(TimeSpan.FromSeconds(1)) // æ¯ç§’å‘å°„é€’å¢æ•° .Take(5); // é™åˆ¶å‘å°„æ¬¡æ•°ä¸º5æ¬¡ source .Delay(TimeSpan.FromSeconds(0.5)) // å»¶è¿Ÿ0.5ç§’åå‘å°„å…ƒç´  [[4]] .Do(x =\u0026gt; Console.WriteLine($\u0026#34;Do: è¢«å»¶è¿Ÿçš„å€¼ = {x}\u0026#34;)) // è®°å½•ä¸­é—´çŠ¶æ€ [[6]] .TimeInterval() // æµ‹é‡è¿ç»­äº‹ä»¶çš„æ—¶é—´é—´éš” [[1]] .Subscribe( interval =\u0026gt; Console.WriteLine($\u0026#34;TimeInterval: å€¼={interval.Value}, é—´éš”={interval.Interval.TotalSeconds}ç§’\u0026#34;), ex =\u0026gt; Console.WriteLine($\u0026#34;OnError: {ex.Message}\u0026#34;), () =\u0026gt; Console.WriteLine(\u0026#34;OnCompleted\u0026#34;) // åºåˆ—ç»“æŸ [[10]] ); // ç¡®ä¿ä¸»çº¿ç¨‹ç­‰å¾…è¶³å¤Ÿæ—¶é—´ä»¥è§‚å¯Ÿè¾“å‡º Console.ReadLine(); } } æµç¨‹ ï¼š æ¯ç§’ç”Ÿæˆä¸€ä¸ªæ•°å­—ï¼ˆIntervalï¼‰ã€‚ å»¶è¿Ÿ0.5ç§’åå‘å°„ï¼ˆDelayï¼‰ã€‚ è®°å½•å»¶è¿Ÿåçš„å€¼ï¼ˆDoï¼‰ã€‚ è®¡ç®—ç›¸é‚»å€¼çš„å‘å°„æ—¶é—´é—´éš”ï¼ˆTimeIntervalï¼‰ã€‚ åºåˆ—ç»“æŸæ—¶è‡ªåŠ¨è§¦å‘ OnCompletedã€‚ Do: è¢«å»¶è¿Ÿçš„å€¼ = 0\nTimeInterval: å€¼=0, é—´éš”=1.5369618ç§’\nDo: è¢«å»¶è¿Ÿçš„å€¼ = 1\nTimeInterval: å€¼=1, é—´éš”=0.9820277ç§’\nDo: è¢«å»¶è¿Ÿçš„å€¼ = 2\nTimeInterval: å€¼=2, é—´éš”=0.9995484ç§’\nDo: è¢«å»¶è¿Ÿçš„å€¼ = 3\nTimeInterval: å€¼=3, é—´éš”=1.0001499ç§’\nDo: è¢«å»¶è¿Ÿçš„å€¼ = 4\nTimeInterval: å€¼=4, é—´éš”=1.0005686ç§’\nOnCompleted\nAverageã€Concatã€Countã€Maxã€Minã€Aggregateã€Sum 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 using System; using System.Reactive.Linq; class Program { static void Main() { // åˆ›å»ºç¬¬ä¸€ä¸ªåºåˆ— var source1 = Observable.Range(1, 3); // å‘å°„ 1, 2, 3 // åˆ›å»ºç¬¬äºŒä¸ªåºåˆ— var source2 = Observable.Range(4, 2); // å‘å°„ 4, 5 // ä½¿ç”¨ Concat åˆå¹¶ä¸¤ä¸ªåºåˆ— [[3]] var concatenated = source1.Concat(source2); // åº”ç”¨èšåˆæ“ä½œç¬¦ concatenated .Count() // è®¡ç®—æ€»é¡¹æ•° [[1]] .Subscribe(count =\u0026gt; Console.WriteLine($\u0026#34;Total Count: {count}\u0026#34;)); concatenated .Sum() // è®¡ç®—æ€»å’Œ [[9]] .Subscribe(sum =\u0026gt; Console.WriteLine($\u0026#34;Total Sum: {sum}\u0026#34;)); concatenated .Average() // è®¡ç®—å¹³å‡å€¼ [[9]] .Subscribe(avg =\u0026gt; Console.WriteLine($\u0026#34;Average: {avg}\u0026#34;)); concatenated .Min() // æŸ¥æ‰¾æœ€å°å€¼ .Subscribe(min =\u0026gt; Console.WriteLine($\u0026#34;Min: {min}\u0026#34;)); concatenated .Max() // æŸ¥æ‰¾æœ€å¤§å€¼ .Subscribe(max =\u0026gt; Console.WriteLine($\u0026#34;Max: {max}\u0026#34;)); // ä½¿ç”¨ Aggregate è‡ªå®šä¹‰èšåˆé€»è¾‘ï¼ˆç±»ä¼¼ Sumï¼‰ concatenated .Aggregate((acc, val) =\u0026gt; acc + val) // ç´¯ç§¯æ±‚å’Œ [[9]] .Subscribe(total =\u0026gt; Console.WriteLine($\u0026#34;Reduce (Custom Sum): {total}\u0026#34;)); Console.ReadLine(); // é˜²æ­¢æ§åˆ¶å°é€€å‡º } } Total Count: 5\nTotal Sum: 15\nAverage: 3\nMin: 1\nMax: 5\nReduce (Custom Sum): 15\nAllã€Containsã€TakeUntilã€StartWith ã€Join 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 using System; using System.Reactive.Linq; class Program { static void Main() { // ç¤ºä¾‹åºåˆ—1ï¼šæ•°å­—åºåˆ— [1, 2, 3, 4, 5] var numbers = Observable.Range(1, 5); // ç¤ºä¾‹åºåˆ—2ï¼šå­—ç¬¦ä¸²åºåˆ— [\u0026#34;A\u0026#34;, \u0026#34;B\u0026#34;, \u0026#34;C\u0026#34;] var letters = Observable.Range(0, 3).Select(x =\u0026gt; ((char)(\u0026#39;A\u0026#39; + x)).ToString()); // StartWith: åœ¨åºåˆ—å¼€å§‹å‰æ·»åŠ å…ƒç´  [0, 1, 2, 3, 4, 5] var startWithExample = numbers.StartWith(0); startWithExample.Subscribe(x =\u0026gt; Console.WriteLine($\u0026#34;StartWith: {x}\u0026#34;)); // All: æ£€æŸ¥æ‰€æœ‰å…ƒç´ æ˜¯å¦å¤§äº0 numbers.All(x =\u0026gt; x \u0026gt; 0) .Subscribe(result =\u0026gt; Console.WriteLine($\u0026#34;All \u0026gt; 0: {result}\u0026#34;)); // è¾“å‡º true // Contains: åˆ¤æ–­åºåˆ—æ˜¯å¦åŒ…å«å…ƒç´  3 numbers.Contains(3) .Subscribe(result =\u0026gt; Console.WriteLine($\u0026#34;Contains 3: {result}\u0026#34;)); // è¾“å‡º true // TakeUntil: å½“å¦ä¸€ä¸ªåºåˆ—ï¼ˆå¦‚å®šæ—¶å™¨ï¼‰è§¦å‘æ—¶åœæ­¢ var takeUntilExample = numbers.TakeUntil(Observable.Timer(TimeSpan.FromSeconds(2))); takeUntilExample.Subscribe( x =\u0026gt; Console.WriteLine($\u0026#34;TakeUntil: {x}\u0026#34;), () =\u0026gt; Console.WriteLine(\u0026#34;TakeUntil Completed\u0026#34;)); // Join: åˆå¹¶ä¸¤ä¸ªåºåˆ—ï¼ˆåŸºäºæ—¶é—´çª—å£ï¼‰ var now = DateTime.Now; var source1 = Observable.Interval(TimeSpan.FromSeconds(1)).Take(3).Select(x =\u0026gt; $\u0026#34;N{x}\u0026#34;); var source2 = Observable.Interval(TimeSpan.FromSeconds(1.5)).Take(3).Select(x =\u0026gt; $\u0026#34;L{x}\u0026#34;); source1.Join( source2, _ =\u0026gt; Observable.Timer(TimeSpan.FromSeconds(2)), // å·¦ä¾§å…ƒç´ å­˜æ´»æ—¶é—´ _ =\u0026gt; Observable.Timer(TimeSpan.FromSeconds(2)), // å³ä¾§å…ƒç´ å­˜æ´»æ—¶é—´ (n, l) =\u0026gt; $\u0026#34;{n}+{l}\u0026#34; ).Subscribe(result =\u0026gt; Console.WriteLine($\u0026#34;Join Result: {result}\u0026#34;)); Console.ReadLine(); // é˜²æ­¢æ§åˆ¶å°é€€å‡º } } åº”ç”¨StartWithæ·»åŠ åˆå§‹å…ƒç´ ã€‚ ä½¿ç”¨Allæ£€æŸ¥æ¡ä»¶ã€‚ ä½¿ç”¨Containsåˆ¤æ–­æ˜¯å¦å­˜åœ¨å…ƒç´ ã€‚ ä½¿ç”¨TakeUntilåœ¨å¦ä¸€ä¸ªåºåˆ—è§¦å‘ååœæ­¢ã€‚ ä½¿ç”¨Joinåˆå¹¶ä¸¤ä¸ªåºåˆ—ã€‚ æ¯ä¸ªæ“ä½œç¬¦åè®¢é˜…ç»“æœå¹¶è¾“å‡ºã€‚ æ·»åŠ å¿…è¦çš„å¼•ç”¨æ ‡æ³¨ã€‚ StartWith: 0\nStartWith: 1\nStartWith: 2\nStartWith: 3\nStartWith: 4\nStartWith: 5\nAll \u0026gt; 0: True\nContains 3: True\nTakeUntil: 1\nTakeUntil: 2\nTakeUntil: 3\nTakeUntil: 4\nTakeUntil: 5\nTakeUntil Completed\nJoin Result: N0+L0\nJoin Result: N1+L0\nJoin Result: N0+L1\nJoin Result: N1+L1\nJoin Result: N2+L0\nJoin Result: N2+L1\nJoin Result: N2+L2\n","date":"2025-06-06T11:04:44+08:00","image":"https://www.notion.so/images/page-cover/woodcuts_6.jpg","permalink":"https://dumbnessrf.github.io/p/reactive_programing/","title":"ReactiveUI ä¸ Rx å¸¸ç”¨æ–¹æ³•æ€»ç»“"},{"content":"ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰ ğŸ“Œ æ¦‚å¿µ ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼Œç®€ç§° DIï¼‰æ˜¯ä¸€ç§å¸¸è§çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œä¸»è¦ç”¨äºè§£è€¦ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§ã€‚\nåœ¨ C# å¼€å‘ä¸­ï¼Œå¦‚æœä¸ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œç±» A å¯èƒ½ä¼šåœ¨å†…éƒ¨ç›´æ¥å®ä¾‹åŒ–ç±» Bï¼Œå¯¼è‡´ä¸¤ä¸ªç±»ä¹‹é—´å½¢æˆå¼ºè€¦åˆã€‚è€Œé€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼ï¼Œå¯ä»¥å°†ç±» B çš„å®ä¾‹ä»å¤–éƒ¨ä¼ é€’ç»™ç±» Aï¼ˆé€šå¸¸é€šè¿‡æ„é€ å‡½æ•°ã€å±æ€§æˆ–æ–¹æ³•å‚æ•°ï¼‰ï¼Œä»è€Œå®ç°æ¾è€¦åˆçš„è®¾è®¡ã€‚\nâœ… ä¸»è¦ä½œç”¨ æå‡å¯ç»´æŠ¤æ€§\nå½“ç³»ç»Ÿè§„æ¨¡å˜å¤§æ—¶ï¼Œå¦‚æœå„ä¸ªç»„ä»¶ä¹‹é—´ç´§å¯†è€¦åˆï¼Œä¿®æ”¹ä¸€ä¸ªç»„ä»¶å¯èƒ½ä¼šå¼•å‘è¿é”ååº”ã€‚é€šè¿‡ä¾èµ–æ³¨å…¥ï¼Œå¯ä»¥ä½¿ä¾èµ–å…³ç³»æ›´åŠ æ¸…æ™°æ˜äº†ï¼Œä¾¿äºåæœŸç»´æŠ¤ã€‚\nç®€åŒ–å•å…ƒæµ‹è¯•\nåœ¨ç¼–å†™å•å…ƒæµ‹è¯•æ—¶ï¼Œå¯ä»¥è½»æ¾åœ°æ¨¡æ‹Ÿï¼ˆMockï¼‰ä¾èµ–å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¾èµ–çœŸå®çš„å¤æ‚å¯¹è±¡ï¼Œä½¿æµ‹è¯•æ›´ç®€å•ã€æ›´ç²¾å‡†ã€‚\nğŸ›  å¸¸ç”¨ä¾èµ–æ³¨å…¥æ¡†æ¶åŠç¤ºä¾‹ 1. Microsoft.Extensions.DependencyInjection 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 using Microsoft.Extensions.DependencyInjection; class MyClassA { private readonly MyClassB _dependency; public MyClassA(MyClassB dependency) =\u0026gt; _dependency = dependency; public void DoSomething() =\u0026gt; _dependency.SomeMethod(); } class MyClassB { public void SomeMethod() =\u0026gt; Console.WriteLine(\u0026#34;MyClassB\u0026#39;s method is called.\u0026#34;); } class Program { static void Main() { var serviceCollection = new ServiceCollection(); serviceCollection.AddTransient\u0026lt;MyClassB\u0026gt;(); serviceCollection.AddTransient\u0026lt;MyClassA\u0026gt;(); var serviceProvider = serviceCollection.BuildServiceProvider(); var a = serviceProvider.GetService\u0026lt;MyClassA\u0026gt;(); a.DoSomething(); } } 2. Autofac 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 using Autofac; class MyClassA { private readonly MyClassB _dependency; public MyClassA(MyClassB dependency) =\u0026gt; _dependency = dependency; public void DoSomething() =\u0026gt; _dependency.SomeMethod(); } class MyClassB { public void SomeMethod() =\u0026gt; Console.WriteLine(\u0026#34;MyClassB\u0026#39;s method is called.\u0026#34;); } class Program { static void Main() { var builder = new ContainerBuilder(); builder.RegisterType\u0026lt;MyClassB\u0026gt;().AsSelf(); builder.RegisterType\u0026lt;MyClassA\u0026gt;().AsSelf(); var container = builder.Build(); var a = container.Resolve\u0026lt;MyClassA\u0026gt;(); a.DoSomething(); } } ä»€ä¹ˆæ˜¯åŠ¨æ€åŠ è½½ç¨‹åºé›†ï¼ˆDynamic Assembly Loadingï¼‰ ğŸ“Œ å®šä¹‰ åœ¨ C# ä¸­ï¼ŒåŠ¨æ€åŠ è½½ç¨‹åºé›†å…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶åŠ è½½å¹¶ä½¿ç”¨ DLL æ–‡ä»¶ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶é™æ€å¼•ç”¨å®ƒä»¬ã€‚è¿™ç§æ–¹å¼æä¾›äº†æ›´é«˜çš„çµæ´»æ€§ï¼Œä¾‹å¦‚ï¼š\næ ¹æ®ä¸åŒçš„æ¡ä»¶æˆ–ç”¨æˆ·éœ€æ±‚åŠ è½½ä¸åŒçš„åŠŸèƒ½æ¨¡å—ã€‚ åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ›´æ–°æŸäº›åŠŸèƒ½æ¨¡å—ï¼Œè€Œæ— éœ€é‡æ–°ç¼–è¯‘æ•´ä¸ªé¡¹ç›®ã€‚ ğŸ§ª ç¤ºä¾‹ï¼šåŠ¨æ€åŠ è½½ DLL 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 using System.Reflection; class Program { static void Main() { // åŠ è½½ç¨‹åºé›† Assembly assembly = Assembly.Load(\u0026#34;xxx.dll\u0026#34;); // è·å–ç±»å‹ Type type = assembly.GetType(\u0026#34;MyNamespace.MyClass\u0026#34;); // åˆ›å»ºå®ä¾‹ object instance = Activator.CreateInstance(type); // è°ƒç”¨æ–¹æ³• MethodInfo method = type.GetMethod(\u0026#34;DoSomething\u0026#34;); method.Invoke(instance, null); } } âš ï¸ æ³¨æ„ï¼šä½¿ç”¨ Assembly.Load(\u0026quot;xxx.dll\u0026quot;) åŠ è½½çš„ç¨‹åºé›†ä¼šä¸€ç›´å ç”¨è¯¥ DLL æ–‡ä»¶ã€‚è‹¥éœ€è¦å¸è½½æˆ–æ›´æ–° DLLï¼Œå»ºè®®ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ï¼š\n1 2 byte[] rawAssembly = File.ReadAllBytes(dllPath); Assembly assembly = Assembly.Load(rawAssembly); ğŸ”„ å°†åŠ¨æ€åŠ è½½çš„ DLL æ³¨å…¥åˆ°ä¾èµ–å®¹å™¨ä¸­ï¼ˆä»¥ Autofac ä¸ºä¾‹ï¼‰ æˆ‘ä»¬ä»¥ Autofac ä½œä¸ºä¾èµ–æ³¨å…¥å®¹å™¨ï¼Œæ¼”ç¤ºå¦‚ä½•å¯¹åŠ¨æ€åŠ è½½çš„ DLL è¿›è¡ŒæœåŠ¡æ³¨å†Œä¸è§£æã€‚\næ­¥éª¤ 1ï¼šåŠ è½½ç¨‹åºé›† 1 2 byte[] rawAssembly = File.ReadAllBytes(dllPath); Assembly assembly = Assembly.Load(rawAssembly); æ­¥éª¤ 2ï¼šå®šä¹‰æ³¨å…¥ç‰¹æ€§ï¼ˆAttributeï¼‰ ä¸ºäº†ç­›é€‰éœ€è¦æ³¨å†Œçš„æœåŠ¡ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª [Inject] ç‰¹æ€§ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 [AttributeUsage(AttributeTargets.Class, AllowMultiple = false)] public class InjectAttribute(string name, string category) : Attribute { public string Name { get; } = name; public string Category { get; } = category; } public interface ITool { void DoWork(); void ShowDialog(); } // ç¤ºä¾‹ç±» [Inject(\u0026#34;å·¥å…·2\u0026#34;, \u0026#34;ç±»åˆ«1\u0026#34;)] public class MainFrame : ITool { public void DoWork() { /* å®ç°é€»è¾‘ */ } public void ShowDialog() { /* å®ç°é€»è¾‘ */ } } æ­¥éª¤ 3ï¼šæ³¨å†ŒæœåŠ¡åˆ° Autofac å®¹å™¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 var builder = new ContainerBuilder(); var types = assembly.DefinedTypes.ToList().Where(IsToolType).ToList(); foreach (var type in types) { var attr = type.CustomAttributes.First(a =\u0026gt; a.AttributeType == typeof(InjectAttribute)); var name = attr.ConstructorArguments[0].Value?.ToString(); var category = attr.ConstructorArguments[1].Value?.ToString(); string key = $\u0026#34;{category}_{name}\u0026#34;; builder.RegisterType(type).Named\u0026lt;ITool\u0026gt;(key); } æ­¥éª¤ 4ï¼šæ„å»ºå®¹å™¨å¹¶è§£ææœåŠ¡ 1 2 3 4 5 6 7 8 9 10 var container = builder.Build(); var tool1 = container.ResolveNamed\u0026lt;ITool\u0026gt;(\u0026#34;ç±»åˆ«1_å·¥å…·1\u0026#34;); tool1.DoWork(); var tool2 = container.ResolveNamed\u0026lt;ITool\u0026gt;(\u0026#34;ç±»åˆ«1_å·¥å…·2\u0026#34;); tool2.ShowDialog(); var tool3 = container.ResolveNamed\u0026lt;ITool\u0026gt;(\u0026#34;ç±»åˆ«2_å·¥å…·1\u0026#34;); tool3.ShowDialog(); ğŸ§© ä¾èµ–è‡ªåŠ¨è§£æèƒ½åŠ› å½“è¢«æ³¨å…¥çš„ç±»å‹å­˜åœ¨å…¶ä»–ä¾èµ–é¡¹æ—¶ï¼Œå¦‚æ—¥å¿— (ILogger) æˆ–æ•°æ®åº“ (IDatabase) æ¥å£ï¼Œä¾èµ–æ³¨å…¥å®¹å™¨ä¼šè‡ªåŠ¨å®Œæˆè¿™äº›ä¾èµ–çš„è§£æã€‚\n1 2 3 4 5 6 7 8 9 10 public interface ILogger { void Log(string message); } public interface IDatabase { List\u0026lt;string\u0026gt; Select(); void Insert\u0026lt;T\u0026gt;(T entity); } ç¤ºä¾‹ï¼šå•ä¾‹æ³¨å…¥ 1 2 builder.RegisterType\u0026lt;ConsoleLogger\u0026gt;().SingleInstance().As\u0026lt;ILogger\u0026gt;(); builder.RegisterType\u0026lt;MysqlMocker\u0026gt;().SingleInstance().As\u0026lt;IDatabase\u0026gt;(); ä½¿ç”¨ç¤ºä¾‹ç±» 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 [Inject(\u0026#34;å·¥å…·1\u0026#34;, \u0026#34;ç±»åˆ«1\u0026#34;)] public class Tool1 : ITool { private readonly ILogger _logger; private readonly IDatabase _database; public Tool1(ILogger logger, IDatabase database) { _logger = logger; _database = database; } public void DoWork() { _logger.Log(\u0026#34;This is a log message from Tool1\u0026#34;); _logger.Log(\u0026#34;Doing work in MainFrame\u0026#34;); var data = _database.Select(); var str = JsonConvert.SerializeObject(data); _logger.Log($\u0026#34;Data from database: {str}\u0026#34;); } public void ShowDialog() { } } âœ… æ€»ç»“ åŠŸèƒ½ æè¿° ä¾èµ–æ³¨å…¥ è§£è€¦ç»„ä»¶ï¼Œæå‡å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§ åŠ¨æ€åŠ è½½ çµæ´»åŠ è½½ DLLï¼Œæ”¯æŒçƒ­æ’æ‹”å’Œè¿è¡Œæ—¶æ‰©å±• ç»“åˆä½¿ç”¨ å¯ä»¥å°†åŠ¨æ€åŠ è½½çš„ DLL ç±»å‹æ³¨å†Œä¸ºæœåŠ¡ï¼Œå¹¶ç”± DI å®¹å™¨ç®¡ç†å…¶ç”Ÿå‘½å‘¨æœŸå’Œä¾èµ–å…³ç³» é€šè¿‡ä¸Šè¿°æ–¹å¼ï¼Œä½ å¯ä»¥å®ç°ä¸€ä¸ªé«˜åº¦æ¨¡å—åŒ–ã€æ˜“äºæ‰©å±•å’Œç»´æŠ¤çš„ C# åº”ç”¨æ¶æ„ï¼Œé€‚ç”¨äºæ’ä»¶å¼ç³»ç»Ÿã€å¾®æœåŠ¡æ¶æ„ç­‰åœºæ™¯ã€‚\n","date":"2025-06-04T14:04:44+08:00","image":"https://www.notion.so/images/page-cover/met_william_morris_1877_willow.jpg","permalink":"https://dumbnessrf.github.io/p/dependency_injection_with_dynamic_loaded_dll.md/","title":"C#å¯¹åŠ¨æ€åŠ è½½çš„DLLä¾èµ–æ³¨å…¥"},{"content":"ğŸ§© Avalonia æ¡†æ¶æ¦‚è§ˆ ğŸ” ç®€ä»‹ Avalonia æ˜¯ä¸€ä¸ª è·¨å¹³å°çš„ .NET ç”¨æˆ·ç•Œé¢æ¡†æ¶ï¼Œæ”¯æŒä½¿ç”¨ C# å’Œ XAML æ„å»ºæ¡Œé¢ã€ç§»åŠ¨å’Œ Web åº”ç”¨ç¨‹åºã€‚å…¶è®¾è®¡çµæ„Ÿæ¥æºäº WPF å’Œ UWPï¼Œä½†å…·æœ‰æ›´å¼ºçš„è·¨å¹³å°å…¼å®¹æ€§ã€‚\nâœ… ä¸»è¦ç‰¹ç‚¹ï¼š ä½¿ç”¨ç†Ÿæ‚‰çš„ XAML è¯­æ³• æ”¯æŒå¤šç§ UI æ§ä»¶å’Œæ ·å¼ å¯è¿è¡Œäºå¤šä¸ªæ“ä½œç³»ç»Ÿ æ”¯æŒ MVVM æ¨¡å¼åŠä¾èµ–æ³¨å…¥ ğŸŒ å¹³å°æ”¯æŒ Avalonia æ”¯æŒä»¥ä¸‹å¹³å°ï¼š\nå¹³å° æ”¯æŒæƒ…å†µ Windows å®Œå…¨æ”¯æŒ Linux å®Œå…¨æ”¯æŒ macOS å®Œå…¨æ”¯æŒ Android/iOS å®éªŒæ€§æ”¯æŒï¼ˆéœ€é¢å¤–é€‚é…ï¼‰ WebAssembly æ”¯æŒï¼ˆé€šè¿‡ WASM æ¸²æŸ“å™¨ï¼‰ ğŸ’¡ Avalonia æä¾›äº†çœŸæ­£çš„è·¨å¹³å°å¼€å‘èƒ½åŠ›ï¼Œé€‚ç”¨äºéœ€è¦ç»Ÿä¸€å¤šç«¯ä½“éªŒçš„åº”ç”¨åœºæ™¯ã€‚\nâš™ï¸ æ€§èƒ½è¡¨ç° Avalonia çš„æ¸²æŸ“å¼•æ“ç»è¿‡ä¼˜åŒ–ï¼Œå…·å¤‡é«˜æ•ˆçš„ç»˜åˆ¶èƒ½åŠ›å’Œè‰¯å¥½çš„ç¡¬ä»¶åŠ é€Ÿæ”¯æŒï¼Œå°¤å…¶åœ¨å¤„ç†å¤æ‚å›¾å½¢ä¸æ•°æ®å¯è§†åŒ–æ—¶è¡¨ç°å‡ºè‰²ã€‚\né«˜æ•ˆçš„æ¸²æŸ“ç®¡é“ æ”¯æŒ GPU åŠ é€Ÿ ä½å»¶è¿Ÿå“åº”ç”¨æˆ·äº¤äº’ ä¾‹å¦‚ï¼šå½“åº”ç”¨ä¸­å­˜åœ¨å¤§é‡åŠ¨æ€å›¾è¡¨æˆ–åŠ¨ç”»å…ƒç´ æ—¶ï¼ŒAvalonia èƒ½ä¿æŒæµç•…çš„å¸§ç‡ï¼Œé¿å…å¡é¡¿ç°è±¡ã€‚\nğŸ”„ Microsoft.Extensions.DependencyInjection è¯¦è§£ ğŸ“¦ æ¦‚è¿° Microsoft.Extensions.DependencyInjection æ˜¯ .NET ä¸­çš„ä¸€ä¸ª è½»é‡çº§ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰å®¹å™¨ï¼Œå®ƒæä¾›äº†ä¸€ç§çµæ´»çš„æ–¹å¼æ¥ç®¡ç†åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡åŠå…¶ä¾èµ–å…³ç³»ã€‚\nğŸ’¡ ä¸ºä»€ä¹ˆä½¿ç”¨ DIï¼Ÿ è§£è€¦ä¸šåŠ¡é€»è¾‘ä¸å…·ä½“å®ç° æé«˜ä»£ç å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ æ”¯æŒæ¨¡å—åŒ–å¼€å‘ ğŸ•’ æœåŠ¡ç”Ÿå‘½å‘¨æœŸï¼ˆService Lifecycleï¼‰ ç”Ÿå‘½å‘¨æœŸç±»å‹ æè¿° Transientï¼ˆç¬æ€ï¼‰ æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºæ–°å®ä¾‹ï¼Œé€‚åˆæ— çŠ¶æ€æœåŠ¡ Scopedï¼ˆä½œç”¨åŸŸï¼‰ åŒä¸€ä½œç”¨åŸŸå†…å…±äº«åŒä¸€ä¸ªå®ä¾‹ï¼Œå¸¸ç”¨äº Web è¯·æ±‚ä¸Šä¸‹æ–‡ Singletonï¼ˆå•ä¾‹ï¼‰ æ•´ä¸ªåº”ç”¨ç¨‹åºå‘¨æœŸå†…å…±äº«å”¯ä¸€å®ä¾‹ï¼Œé€‚åˆå…¨å±€èµ„æºç®¡ç† ç¤ºä¾‹è¯´æ˜ï¼š Transientï¼šæ¯æ¬¡è°ƒç”¨ IDataProcessor éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚ Scopedï¼šåœ¨ä¸€æ¬¡ HTTP è¯·æ±‚ä¸­ï¼Œæ‰€æœ‰å¯¹ IDatabaseContext çš„è¯·æ±‚éƒ½è¿”å›åŒä¸€ä¸ªå®ä¾‹ã€‚ Singletonï¼šå¦‚ IAppSettingsï¼Œåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å§‹ç»ˆä¸ºåŒä¸€å®ä¾‹ã€‚ ğŸ§ª ç¤ºä¾‹ï¼šåœ¨ Avalonia ä¸­é›†æˆä¾èµ–æ³¨å…¥ ğŸ“ä»¥ä¸‹ç¤ºä¾‹å°†æ·»åŠ Rediså’Œç¬¬ä¸‰æ–¹Avaloniaæ ·å¼åº“SukiUIä½œä¸ºå‚è€ƒ\n1ï¸âƒ£ å®‰è£…ä¾èµ–æ³¨å…¥åŒ… 1 install-package Microsoft.Extensions.DependencyInjection 2ï¸âƒ£ åˆå§‹åŒ–æœåŠ¡å®¹å™¨ åœ¨ App.xaml.cs ä¸­é‡å†™ OnFrameworkInitializationCompleted() æ–¹æ³•ä»¥æ³¨å†Œå¹¶æ„å»ºæœåŠ¡å®¹å™¨ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 public override void OnFrameworkInitializationCompleted() { var collection = new ServiceCollection(); collection.AddCommonServices(); collection.AddDistributedCache(); _services = collection.BuildServiceProvider(); var vm = _services.GetRequiredService\u0026lt;MainWindowViewModel\u0026gt;(); var toastService = _services.GetRequiredService\u0026lt;ISukiToastManager\u0026gt;(); var dialogService = _services.GetRequiredService\u0026lt;ISukiDialogManager\u0026gt;(); if (ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop) { desktop.MainWindow = _services.GetRequiredService\u0026lt;MainWindow\u0026gt;(); } else if (ApplicationLifetime is ISingleViewApplicationLifetime singleViewPlatform) { singleViewPlatform.MainView = new MainWindow(toastService, dialogService) { DataContext = vm, }; } base.OnFrameworkInitializationCompleted(); } 3ï¸âƒ£ æ³¨å†ŒæœåŠ¡ è‡ªå®šä¹‰æ‰©å±•æ–¹æ³•æ³¨å†Œå¸¸ç”¨æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 public static void AddCommonServices(this IServiceCollection collection) { collection.AddSingleton\u0026lt;MainWindowViewModel\u0026gt;(); collection.AddSingleton\u0026lt;MainWindow\u0026gt;(s =\u0026gt; new MainWindow( s.GetRequiredService\u0026lt;ISukiToastManager\u0026gt;(), s.GetRequiredService\u0026lt;ISukiDialogManager\u0026gt;() ) { DataContext = s.GetRequiredService\u0026lt;MainWindowViewModel\u0026gt;(), }); collection.AddSingleton\u0026lt;ISukiToastManager\u0026gt;(s =\u0026gt; DialogExManager.GetToastManager()); collection.AddSingleton\u0026lt;ISukiDialogManager\u0026gt;(s =\u0026gt; DialogExManager.GetDialogManager()); } æ³¨å†Œ Redis ç¼“å­˜æœåŠ¡ 1 2 3 4 5 6 7 8 9 10 11 12 public static void AddDistributedCache(this IServiceCollection collection) { var connection = ConnectionMultiplexer.Connect(\u0026#34;127.0.0.1:6379\u0026#34;); var redis = connection.GetDatabase(); collection.AddSingleton(redis); collection.AddSingleton(connection); collection.AddSingleton\u0026lt;IDistributedCache, RedisCache\u0026gt;(s =\u0026gt; { return new RedisCache(s.GetRequiredService\u0026lt;IDatabase\u0026gt;()); }); } 4ï¸âƒ£ è¾…åŠ©ç±»ï¼šå¯¹è¯æ¡†ä¸ Toast ç®¡ç†å™¨ 1 2 3 4 5 6 7 8 public static class DialogExManager { private static readonly ISukiToastManager ToastManager = new SukiToastManager(); private static readonly ISukiDialogManager DialogManager = new SukiDialogManager(); public static ISukiToastManager GetToastManager() =\u0026gt; ToastManager; public static ISukiDialogManager GetDialogManager() =\u0026gt; DialogManager; } 5ï¸âƒ£ è§†å›¾å®šä½å™¨ï¼ˆViewLocatorï¼‰ å¦‚æœå¯ç”¨äº† ViewLocatorï¼Œåˆ™ ViewModel ä¸ View å°†è‡ªåŠ¨ç»‘å®šã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 public class ViewLocator : IDataTemplate { public Control? Build(object? param) { if (param is null) return null; var name = param.GetType().FullName!.Replace(\u0026#34;ViewModel\u0026#34;, \u0026#34;View\u0026#34;, StringComparison.Ordinal); var type = Type.GetType(name); return type != null ? (Control)Activator.CreateInstance(type)! : new TextBlock { Text = \u0026#34;Not Found: \u0026#34; + name }; } public bool Match(object? data) { return data is ViewModelBase; } } ğŸ“ å¦‚æœæœªå¯ç”¨ ViewLocatorï¼Œåˆ™éœ€è¦æ‰‹åŠ¨è®¾ç½® DataContextã€‚\nâœ… æ€»ç»“ Avalonia æ˜¯ä¸€ä¸ªå¼ºå¤§çš„è·¨å¹³å° UI æ¡†æ¶ï¼Œç»“åˆ Microsoft.Extensions.DependencyInjection å¯å®ç°é«˜åº¦è§£è€¦å’Œæ¨¡å—åŒ–çš„åº”ç”¨ç¨‹åºæ¶æ„ã€‚é€šè¿‡åˆç†é…ç½®æœåŠ¡ç”Ÿå‘½å‘¨æœŸå’Œä½¿ç”¨è§†å›¾å®šä½å™¨ç­‰æœºåˆ¶ï¼Œå¯ä»¥æ˜¾è‘—æå‡å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚\n","date":"2025-06-04T11:04:44+08:00","image":"https://images.unsplash.com/photo-1649972904349-6e44c42644a7?ixlib=rb-4.0.3\u0026q=85\u0026fm=jpg\u0026crop=entropy\u0026cs=srgb\u0026w=3600","permalink":"https://dumbnessrf.github.io/p/dependency_injection/","title":"Avaloniaä¸­ä½¿ç”¨ä¾èµ–æ³¨å…¥é‡æ„ä»£ç "},{"content":"Converter ç±»å‹è¯¦è§£ä¸ä½¿ç”¨ç¤ºä¾‹ ç›®å½• Normal Converter IMultiValueConverter FuncValueConverter ä¸ºäº†æé«˜ Converter çš„åˆ©ç”¨ç‡ï¼Œå¯ä»¥å°†å…¶å®ä¾‹å®šä¹‰ä¸ºé™æ€èµ„æºï¼Œé¿å…é‡å¤åˆ›å»ºå®ä¾‹ã€‚ä¾‹å¦‚ï¼š\n1 2 3 4 /// \u0026lt;summary\u0026gt; /// è·å– MathAddConverter çš„é™æ€å®ä¾‹ /// \u0026lt;/summary\u0026gt; public static MathAddConverter AddConverter { get; } = new MathAddConverter(); åœ¨ XAML ä¸­è°ƒç”¨è¯¥é™æ€èµ„æºçš„æ–¹å¼å¦‚ä¸‹ï¼š\n1 2 \u0026lt;NumericUpDown Grid.Row=\u0026#34;1\u0026#34; Grid.Column=\u0026#34;1\u0026#34; Value=\u0026#34;{Binding Number1, Converter={x:Static MathAddConverter.AddConverter}, ConverterParameter={StaticResource MyConverterParameter}}\u0026#34; /\u0026gt; Normal Converter æ™®é€šå€¼è½¬æ¢å™¨ï¼ˆIValueConverterï¼‰ï¼šç”¨äºå•ä¸ªç»‘å®šå€¼çš„è½¬æ¢ï¼Œä½† ConverterParameter ä¸æ”¯æŒåŠ¨æ€ç»‘å®šã€‚\nç¤ºä¾‹ï¼šAddConverter 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 public class AddConverter : IValueConverter { public object? Convert(object? value, Type targetType, object? parameter, CultureInfo culture) { if (value is decimal d1 \u0026amp;\u0026amp; parameter is decimal d2) { return d1 + d2; } return null; } public object? ConvertBack(object? value, Type targetType, object? parameter, CultureInfo culture) { if (value is decimal d1 \u0026amp;\u0026amp; parameter is decimal d2) { return d1 - d2; } return null; } } XAML èµ„æºå®šä¹‰ 1 2 3 4 \u0026lt;Window.Resources\u0026gt; \u0026lt;conv:AddConverter x:Key=\u0026#34;AddConverter\u0026#34; /\u0026gt; \u0026lt;x:Decimal x:Key=\u0026#34;inputAddValue\u0026#34;\u0026gt;2\u0026lt;/x:Decimal\u0026gt; \u0026lt;/Window.Resources\u0026gt; ä½¿ç”¨ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 \u0026lt;StackPanel Orientation=\u0026#34;Horizontal\u0026#34;\u0026gt; \u0026lt;TextBlock Classes=\u0026#34;Header\u0026#34; Text=\u0026#34;NormalConverter\u0026#34; /\u0026gt; \u0026lt;TextBlock Text=\u0026#34;Input a number to sum\u0026#34; /\u0026gt; \u0026lt;NumericUpDown Increment=\u0026#34;0.1\u0026#34; Value=\u0026#34;{Binding Number}\u0026#34; /\u0026gt; \u0026lt;TextBlock Text=\u0026#34;Sum\u0026#34; /\u0026gt; \u0026lt;NumericUpDown Value=\u0026#34;{Binding Number, Converter={StaticResource AddConverter}, ConverterParameter={StaticResource inputAddValue}}\u0026#34; /\u0026gt; \u0026lt;/StackPanel\u0026gt; IMultiValueConverter å¤šå€¼è½¬æ¢å™¨ï¼ˆIMultiValueConverterï¼‰ï¼šæ”¯æŒå¤šä¸ªç»‘å®šå€¼è¾“å…¥ï¼ŒConverterParameter æ”¯æŒç»‘å®šã€‚\nç¤ºä¾‹ï¼šMultiValueAddConverter 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 public class MultiValueAddConverter : IMultiValueConverter { public object? Convert(IList\u0026lt;object?\u0026gt; values, Type targetType, object? parameter, CultureInfo culture) { if (values.Any(s =\u0026gt; s is not decimal)) { return new BindingNotification( new InvalidOperationException( \u0026#34;Not all input parameter type is decimal, this converter only support decimal type\u0026#34; ), BindingErrorType.Error ); } return values.Sum(s =\u0026gt; (decimal)s); } } ä½¿ç”¨ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026lt;StackPanel Orientation=\u0026#34;Horizontal\u0026#34;\u0026gt; \u0026lt;TextBlock Classes=\u0026#34;Header\u0026#34; Text=\u0026#34;MultiValueConverter\u0026#34; /\u0026gt; \u0026lt;TextBlock Text=\u0026#34;Input numbers to sum\u0026#34; /\u0026gt; \u0026lt;NumericUpDown Increment=\u0026#34;0.1\u0026#34; Value=\u0026#34;{Binding Number1}\u0026#34; /\u0026gt; \u0026lt;NumericUpDown Increment=\u0026#34;0.1\u0026#34; Value=\u0026#34;{Binding Number2}\u0026#34; /\u0026gt; \u0026lt;NumericUpDown Increment=\u0026#34;0.1\u0026#34; Value=\u0026#34;{Binding Number3}\u0026#34; /\u0026gt; \u0026lt;TextBlock Text=\u0026#34;Sum\u0026#34; /\u0026gt; \u0026lt;NumericUpDown IsReadOnly=\u0026#34;True\u0026#34;\u0026gt; \u0026lt;NumericUpDown.Value\u0026gt; \u0026lt;MultiBinding Converter=\u0026#34;{StaticResource MultiValueAddConverter}\u0026#34; Mode=\u0026#34;OneWay\u0026#34;\u0026gt; \u0026lt;Binding Path=\u0026#34;Number1\u0026#34; /\u0026gt; \u0026lt;Binding Path=\u0026#34;Number2\u0026#34; /\u0026gt; \u0026lt;Binding Path=\u0026#34;Number3\u0026#34; /\u0026gt; \u0026lt;/MultiBinding\u0026gt; \u0026lt;/NumericUpDown.Value\u0026gt; \u0026lt;/NumericUpDown\u0026gt; \u0026lt;/StackPanel\u0026gt; FuncValueConverter å‡½æ•°å¼è½¬æ¢å™¨ï¼ˆFuncValueConverterï¼‰ï¼šé€šè¿‡å§”æ‰˜æ–¹å¼å®šä¹‰è½¬æ¢é€»è¾‘ï¼Œé€‚ç”¨äºç±»å‹æ˜ç¡®ã€é€»è¾‘ç®€å•çš„åœºæ™¯ã€‚\nç¤ºä¾‹ï¼šå­—ç¬¦ä¸²è½¬ç”»åˆ· 1 2 3 4 5 6 7 8 9 10 11 12 13 public class FuncValueConverters { public static FuncValueConverter\u0026lt;string?, Brush?\u0026gt; StringToBrushFuncConverter { get; } = new(s =\u0026gt; { Color color; if (Color.TryParse(s, out color) || Color.TryParse($\u0026#34;#{s}\u0026#34;, out color)) { return new SolidColorBrush(color); } return null; }); } ä½¿ç”¨ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026lt;StackPanel Orientation=\u0026#34;Horizontal\u0026#34;\u0026gt; \u0026lt;TextBlock Classes=\u0026#34;Header\u0026#34; Text=\u0026#34;FuncValueConverter\u0026#34; /\u0026gt; \u0026lt;TextBox Text=\u0026#34;red\u0026#34; UseFloatingWatermark=\u0026#34;True\u0026#34; Watermark=\u0026#34;Type the color to parse (e.g.: red, green, blue, #FF112233)\u0026#34;\u0026gt; \u0026lt;TextBox.InnerLeftContent\u0026gt; \u0026lt;Ellipse Fill=\u0026#34;{Binding $parent[TextBox].Text, Converter={x:Static conv:FuncValueConverters.StringToBrushFuncConverter}}\u0026#34; Height=\u0026#34;20\u0026#34; Margin=\u0026#34;5,0,0,0\u0026#34; Stroke=\u0026#34;Gray\u0026#34; StrokeThickness=\u0026#34;1\u0026#34; Width=\u0026#34;20\u0026#34; /\u0026gt; \u0026lt;/TextBox.InnerLeftContent\u0026gt; \u0026lt;/TextBox\u0026gt; \u0026lt;/StackPanel\u0026gt; å¦‚éœ€æ‰©å±•æ›´å¤šè½¬æ¢é€»è¾‘ï¼Œå¯ä»¥ç»§ç»­æ·»åŠ æ–°çš„ Converter æˆ–ä½¿ç”¨ FuncValueConverter å¿«é€Ÿå®ç°è½»é‡çº§è½¬æ¢é€»è¾‘ã€‚\n","date":"2025-06-04T11:04:44+08:00","image":"https://www.notion.so/images/page-cover/rijksmuseum_jansz_1637.jpg","permalink":"https://dumbnessrf.github.io/p/converter-in-avalonia/","title":"Avaloniaä¸­çš„å„ç§Converterä½¿ç”¨"},{"content":"WPF ä¸­çš„ DataTemplateSelectorï¼šé«˜çº§æ•°æ®æ¨¡æ¿é€‰æ‹©æŠ€å·§ä¸åº”ç”¨ åœ¨ WPFï¼ˆWindows Presentation Foundationï¼‰å¼€å‘ä¸­ï¼ŒDataTemplate æ˜¯æˆ‘ä»¬ç”¨æ¥å®šä¹‰å¦‚ä½•æ˜¾ç¤ºç»‘å®šæ•°æ®çš„é‡è¦å·¥å…·ã€‚ç„¶è€Œï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æ ¹æ®ä¸åŒçš„æ•°æ®å¯¹è±¡åŠ¨æ€åœ°é€‰æ‹©ä¸åŒçš„ DataTemplate æ¥å‘ˆç° UIã€‚è¿™æ—¶ï¼ŒDataTemplateSelector å°±æ´¾ä¸Šç”¨åœºäº†ã€‚\næœ¬æ–‡å°†ä»‹ç»ï¼š\nä»€ä¹ˆæ˜¯ DataTemplateSelector å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ª DataTemplateSelector å®é™…åº”ç”¨åœºæ™¯å’Œä»£ç ç¤ºä¾‹ ä½¿ç”¨æŠ€å·§ä¸æœ€ä½³å®è·µ ä¸€ã€ä»€ä¹ˆæ˜¯ DataTemplateSelectorï¼Ÿ DataTemplateSelector æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒå…è®¸ä½ æ ¹æ®ç»‘å®šé¡¹çš„å†…å®¹æ¥å†³å®šä½¿ç”¨å“ªä¸ª DataTemplateã€‚ä½ å¯ä»¥ç»§æ‰¿è¿™ä¸ªç±»å¹¶é‡å†™å®ƒçš„ SelectTemplate æ–¹æ³•ï¼Œä»è€Œå®ç°è‡ªå®šä¹‰çš„æ¨¡æ¿é€‰æ‹©é€»è¾‘ã€‚\näºŒã€å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ª DataTemplateSelectorï¼Ÿ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚\nç¤ºä¾‹åœºæ™¯ï¼šèŠå¤©æ¶ˆæ¯åˆ—è¡¨ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªèŠå¤©ç¨‹åºï¼Œæ¯æ¡æ¶ˆæ¯å¯èƒ½æ˜¯ç”¨æˆ·å‘é€çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯ç³»ç»Ÿè‡ªåŠ¨å‘é€çš„ã€‚æˆ‘ä»¬æƒ³å¯¹è¿™ä¸¤ç§æ¶ˆæ¯åº”ç”¨ä¸åŒçš„æ ·å¼ã€‚\n1. å®šä¹‰æ•°æ®æ¨¡å‹ 1 2 3 4 5 6 7 8 9 10 11 public class Message { public string Content { get; set; } public MessageType Type { get; set; } } public enum MessageType { User, System } 2. åˆ›å»ºä¸¤ä¸ªä¸åŒçš„ DataTemplate åœ¨ XAML ä¸­å®šä¹‰ä¸¤ç§ä¸åŒé£æ ¼çš„æ¶ˆæ¯æ¨¡æ¿ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;Window.Resources\u0026gt; \u0026lt;!-- ç”¨æˆ·æ¶ˆæ¯æ¨¡æ¿ --\u0026gt; \u0026lt;DataTemplate x:Key=\u0026#34;UserMessageTemplate\u0026#34;\u0026gt; \u0026lt;Border Background=\u0026#34;LightBlue\u0026#34; Padding=\u0026#34;10\u0026#34; Margin=\u0026#34;5\u0026#34;\u0026gt; \u0026lt;TextBlock Text=\u0026#34;{Binding Content}\u0026#34; /\u0026gt; \u0026lt;/Border\u0026gt; \u0026lt;/DataTemplate\u0026gt; \u0026lt;!-- ç³»ç»Ÿæ¶ˆæ¯æ¨¡æ¿ --\u0026gt; \u0026lt;DataTemplate x:Key=\u0026#34;SystemMessageTemplate\u0026#34;\u0026gt; \u0026lt;Border Background=\u0026#34;LightGray\u0026#34; Padding=\u0026#34;10\u0026#34; Margin=\u0026#34;5\u0026#34;\u0026gt; \u0026lt;TextBlock Text=\u0026#34;{Binding Content}\u0026#34; FontStyle=\u0026#34;Italic\u0026#34;/\u0026gt; \u0026lt;/Border\u0026gt; \u0026lt;/DataTemplate\u0026gt; \u0026lt;/Window.Resources\u0026gt; 3. è‡ªå®šä¹‰ DataTemplateSelector 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 public class MessageTemplateSelector : DataTemplateSelector { public DataTemplate UserMessageTemplate { get; set; } public DataTemplate SystemMessageTemplate { get; set; } public override DataTemplate SelectTemplate(object item, DependencyObject container) { if (item is Message message) { switch (message.Type) { case MessageType.User: return UserMessageTemplate; case MessageType.System: return SystemMessageTemplate; } } return base.SelectTemplate(item, container); } } 4. åœ¨ XAML ä¸­æ³¨å†Œå¹¶ä½¿ç”¨ TemplateSelector 1 2 3 4 5 6 7 8 \u0026lt;Window.Resources\u0026gt; \u0026lt;local:MessageTemplateSelector x:Key=\u0026#34;messageTemplateSelector\u0026#34; UserMessageTemplate=\u0026#34;{StaticResource UserMessageTemplate}\u0026#34; SystemMessageTemplate=\u0026#34;{StaticResource SystemMessageTemplate}\u0026#34; /\u0026gt; \u0026lt;/Window.Resources\u0026gt; \u0026lt;ListBox ItemsSource=\u0026#34;{Binding Messages}\u0026#34; ItemTemplateSelector=\u0026#34;{StaticResource messageTemplateSelector}\u0026#34; /\u0026gt; æ³¨æ„ï¼šlocal éœ€è¦å¼•ç”¨ä½ çš„å‘½åç©ºé—´ï¼Œä¾‹å¦‚ï¼š\n1 2 \u0026lt;Window xmlns:local=\u0026#34;clr-namespace:YourNamespace\u0026#34; ... ä¸‰ã€åº”ç”¨åœºæ™¯ä¸¾ä¾‹ åœºæ™¯ 1ï¼šå¤šç±»å‹åˆ—è¡¨å±•ç¤ºï¼ˆå¦‚æ–°é—»ã€é€šçŸ¥ã€è®¢å•ç­‰æ··åˆå±•ç¤ºï¼‰ ä½ å¯ä»¥ä¸ºä¸åŒç±»å‹çš„æ•°æ®é¡¹é€‰æ‹©ä¸åŒçš„æ¨¡æ¿ï¼Œä½¿å¾—åŒä¸€ä¸ªåˆ—è¡¨ä¸­èƒ½å±•ç¤ºå¤šç§ç»“æ„ä¸åŒçš„ä¿¡æ¯ã€‚\nåœºæ™¯ 2ï¼šUI ä¸»é¢˜æˆ–çŠ¶æ€å˜åŒ– æ ¹æ®å¯¹è±¡çš„çŠ¶æ€ï¼ˆå¦‚â€œå·²è¯»â€ã€â€œæœªè¯»â€ã€â€œé”™è¯¯â€ç­‰ï¼‰åˆ‡æ¢ä¸åŒçš„ UI æ ·å¼ã€‚\nåœºæ™¯ 3ï¼šä¸ªæ€§åŒ–å†…å®¹å±•ç¤º æ¯”å¦‚åœ¨ä¸€ä¸ªè®ºå›åº”ç”¨ä¸­ï¼Œå¸–å­ä½œè€…ã€ç®¡ç†å‘˜ã€æ™®é€šç”¨æˆ·çš„å‘è¨€éœ€è¦ä¸åŒé¢œè‰²æˆ–å›¾æ ‡æ ‡è¯†ã€‚\nå››ã€ä½¿ç”¨æŠ€å·§ä¸æœ€ä½³å®è·µ âœ… æŠ€å·§ 1ï¼šä¿æŒ TemplateSelector çš„å¯å¤ç”¨æ€§ ç›®æ ‡ï¼š è®¾è®¡ä¸€ä¸ªé€šç”¨çš„ DataTemplateSelectorï¼Œå¯ä»¥é€šè¿‡ä¾èµ–å±æ€§ä¼ å…¥æ¨¡æ¿ï¼Œæé«˜ç»„ä»¶å¤ç”¨æ€§ã€‚\nå®ç°ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 public class ReusableTemplateSelector : DataTemplateSelector { public DataTemplate DefaultTemplate { get; set; } public DataTemplate AlternateTemplate { get; set; } public override DataTemplate SelectTemplate(object item, DependencyObject container) { if (item is ICustomType customItem \u0026amp;\u0026amp; customItem.IsSpecial) { return AlternateTemplate; } return DefaultTemplate ?? base.SelectTemplate(item, container); } } // æ¥å£ç”¨äºåˆ¤æ–­æ˜¯å¦æ˜¯â€œç‰¹æ®Šç±»å‹â€ public interface ICustomType { bool IsSpecial { get; } } ä½¿ç”¨ XAMLï¼š 1 2 3 \u0026lt;local:ReusableTemplateSelector x:Key=\u0026#34;reusableSelector\u0026#34; DefaultTemplate=\u0026#34;{StaticResource NormalTemplate}\u0026#34; AlternateTemplate=\u0026#34;{StaticResource SpecialTemplate}\u0026#34; /\u0026gt; åº”ç”¨åœºæ™¯ï¼š å¤šä¸ªé¡µé¢ä¸­é‡å¤ä½¿ç”¨åŒä¸€ä¸ªé€‰æ‹©å™¨ã€‚ ä¸åŒä¸šåŠ¡é€»è¾‘ä¸‹åªéœ€æ›´æ¢ç»‘å®šçš„ DataTemplateã€‚ âœ… æŠ€å·§ 2ï¼šç»“åˆ MVVM æ¨¡å¼ä½¿ç”¨ ç›®æ ‡ï¼š åœ¨ MVVM æ¶æ„ä¸­ä½¿ç”¨ DataTemplateSelectorï¼Œå°† UI å±•ç¤ºä¸æ•°æ®åˆ†ç¦»ã€‚\nå®ç°ï¼š ViewModel ç¤ºä¾‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 public class MessageViewModel : INotifyPropertyChanged { public string Content { get; set; } public MessageType Type { get; set; } // User / System } public enum MessageType { User, System } è‡ªå®šä¹‰ Selectorï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 public class MessageTypeSelector : DataTemplateSelector { public DataTemplate UserTemplate { get; set; } public DataTemplate SystemTemplate { get; set; } public override DataTemplate SelectTemplate(object item, DependencyObject container) { if (item is MessageViewModel msg) { return msg.Type == MessageType.User ? UserTemplate : SystemTemplate; } return base.SelectTemplate(item, container); } } XAML ä¸­ç»‘å®šï¼š 1 2 \u0026lt;ListBox ItemsSource=\u0026#34;{Binding Messages}\u0026#34; ItemTemplateSelector=\u0026#34;{StaticResource messageTypeSelector}\u0026#34; /\u0026gt; ä¼˜åŠ¿ï¼š å®Œå…¨è§£è€¦ View å’Œ ViewModelã€‚ æ˜“äºç»´æŠ¤å’Œæµ‹è¯•ã€‚ âœ… æŠ€å·§ 3ï¼šé¿å…è¿‡åº¦å¤æ‚çš„é€»è¾‘ ç›®æ ‡ï¼š ç¡®ä¿ SelectTemplate æ–¹æ³•é€»è¾‘ç®€æ´ï¼Œä¸åµŒå¥—å¤æ‚åˆ¤æ–­ã€‚\nåé¢ä¾‹å­ï¼ˆä¸æ¨èï¼‰ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 public override DataTemplate SelectTemplate(...) { if (item is Order o) { if (o.Status == \u0026#34;Pending\u0026#34;) { if (o.CustomerLevel == \u0026#34;VIP\u0026#34;) return VipPendingTemplate; else return PendingTemplate; } else if (o.Status == \u0026#34;Completed\u0026#34;) { ... } } } æ”¹è¿›æ–¹å¼ï¼š ä½¿ç”¨ç­–ç•¥æ¨¡å¼æˆ–çŠ¶æ€æšä¸¾æ˜ å°„ 1 2 3 4 5 6 7 8 9 10 11 12 13 public class OrderTemplateSelector : DataTemplateSelector { public Dictionary\u0026lt;OrderState, DataTemplate\u0026gt; Templates { get; } = new(); public override DataTemplate SelectTemplate(object item, DependencyObject container) { if (item is Order order) { return Templates.GetValueOrDefault(order.State); } return base.SelectTemplate(item, container); } } XAML é…ç½®ï¼š 1 2 3 4 5 6 \u0026lt;local:OrderTemplateSelector x:Key=\u0026#34;orderSelector\u0026#34;\u0026gt; \u0026lt;local:OrderTemplateSelector.Templates\u0026gt; \u0026lt;Component:TemplateMapEntry Key=\u0026#34;Pending\u0026#34; Value=\u0026#34;{StaticResource PendingTemplate}\u0026#34; /\u0026gt; \u0026lt;Component:TemplateMapEntry Key=\u0026#34;Completed\u0026#34; Value=\u0026#34;{StaticResource CompletedTemplate}\u0026#34; /\u0026gt; \u0026lt;/local:OrderTemplateSelector.Templates\u0026gt; \u0026lt;/local:OrderTemplateSelector\u0026gt; ğŸ’¡ æ³¨ï¼šä½ å¯ä»¥è‡ªå®šä¹‰ TemplateMapEntry ç±»å‹æ¥æ”¯æŒè¿™ç§å­—å…¸ç»“æ„ã€‚\nâœ… æŠ€å·§ 4ï¼šè°ƒè¯•æ—¶æ³¨æ„ Binding ä¸Šä¸‹æ–‡é—®é¢˜ å¸¸è§é”™è¯¯ï¼š åœ¨ SelectTemplate ä¸­è·å–ä¸åˆ°æ­£ç¡®å¯¹è±¡ã€‚ ç»‘å®šè·¯å¾„é”™è¯¯å¯¼è‡´æ— æ³•è¯†åˆ«ç±»å‹ã€‚ è§£å†³æ–¹æ³•ï¼š ç¡®ä¿ç»‘å®šä¸Šä¸‹æ–‡æ­£ç¡® 1 2 \u0026lt;ListBox ItemsSource=\u0026#34;{Binding MyItems}\u0026#34; ItemTemplateSelector=\u0026#34;{StaticResource mySelector}\u0026#34; /\u0026gt; ç¡®ä¿ MyItems æ˜¯ IEnumerable\u0026lt;T\u0026gt;ï¼Œä¸”æ¯ä¸€é¡¹ç±»å‹éƒ½èƒ½è¢«è¯†åˆ«ã€‚\næ·»åŠ æ—¥å¿—è¾…åŠ©è°ƒè¯•ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 public override DataTemplate SelectTemplate(object item, DependencyObject container) { if (item == null) { Debug.WriteLine(\u0026#34;Item is null\u0026#34;); return base.SelectTemplate(item, container); } Debug.WriteLine($\u0026#34;Item type: {item.GetType().Name}\u0026#34;); if (item is CustomType ct) { return ct.IsSpecial ? SpecialTemplate : NormalTemplate; } return base.SelectTemplate(item, container); } äº”ã€æ€»ç»“ DataTemplateSelector æ˜¯ WPF ä¸­éå¸¸å¼ºå¤§ä¸”çµæ´»çš„åŠŸèƒ½ï¼Œå®ƒå¸®åŠ©æˆ‘ä»¬å®ç°äº†æ•°æ®é©±åŠ¨çš„ UI æ¨¡æ¿é€‰æ‹©ã€‚æ— è®ºæ˜¯æ„å»ºå¤æ‚çš„ UI åˆ—è¡¨è¿˜æ˜¯å®ç°é«˜åº¦å®šåˆ¶åŒ–çš„å±•ç¤ºé€»è¾‘ï¼ŒDataTemplateSelector éƒ½æ˜¯ä¸€ä¸ªå€¼å¾—æŒæ¡çš„æŠ€èƒ½ã€‚\n","date":"2025-05-30T14:46:48+08:00","image":"https://www.notion.so/images/page-cover/nasa_new_york_city_grid.jpg","permalink":"https://dumbnessrf.github.io/p/data-template-selector-tips/","title":"WPFæŠ€å·§-æ•°æ®æ¨¡æ¿åŠ¨æ€é€‰æ‹©"},{"content":"è§£é”.NET æ–°å§¿åŠ¿ï¼šåŸºäºæ–‡ä»¶çš„ç¨‹åºç‰¹æ€§æ·±åº¦è§£æä¸å®æˆ˜ åœ¨.NET çš„ä¸–ç•Œé‡Œï¼Œæ–°é¡¹ç›®çš„åˆ›å»ºå’Œè¿è¡Œå¾€å¾€ç¦»ä¸å¼€.csprojé¡¹ç›®æ–‡ä»¶ï¼Œä»ç¼–å†™ä»£ç åˆ°è°ƒè¯•è¿è¡Œï¼Œéœ€è¦ä¸€ç³»åˆ—ç¹ççš„æ­¥éª¤ã€‚ä½†éšç€.NET æŠ€æœ¯çš„ä¸æ–­æ¼”è¿›ï¼ŒåŸºäºæ–‡ä»¶çš„ç¨‹åºï¼ˆFile-based programsï¼‰ è¿™ä¸€æ–°ç‰¹æ€§çš„å‡ºç°ï¼Œæ‰“ç ´äº†è¿™ä¸€ä¼ ç»Ÿæ¨¡å¼ï¼Œä¸ºå¼€å‘è€…å¸¦æ¥äº†æ›´åŠ ä¾¿æ·ã€é«˜æ•ˆçš„å¼€å‘ä½“éªŒã€‚\nåŸºäºæ–‡ä»¶çš„ç¨‹åºç‰¹æ€§æ¦‚è¿° åŸºäºæ–‡ä»¶çš„ç¨‹åºï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å°†éƒ¨åˆ† MSBuild é¡¹ç›®åŠŸèƒ½åµŒå…¥åˆ° C# ä»£ç ä¸­ï¼Œå…è®¸å¼€å‘è€…ç›´æ¥è¿è¡Œå•ä¸ª C# æ–‡ä»¶ï¼Œå°±åƒè¿è¡Œä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ä¸€æ ·ã€‚åœ¨ä»¥å¾€ï¼Œè¿è¡Œ C# ä»£ç é€šå¸¸éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œç¼–å†™ .csproj æ–‡ä»¶æ¥é…ç½®é¡¹ç›®çš„å„ç§å±æ€§ï¼Œå¦‚å¼•ç”¨çš„åŒ…ã€ç›®æ ‡æ¡†æ¶ç­‰ã€‚è€ŒåŸºäºæ–‡ä»¶çš„ç¨‹åºåˆ™æ— éœ€è¿™äº›å¤æ‚çš„æ“ä½œï¼Œå®ƒé€šè¿‡åœ¨ C# æºæ–‡ä»¶ä¸­æ·»åŠ ç‰¹æ®Šçš„ #: æŒ‡ä»¤ï¼Œåœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ª â€œè™šæ‹Ÿé¡¹ç›®â€ï¼Œç„¶åå°†è¿™ä¸ª â€œè™šæ‹Ÿé¡¹ç›®â€ ä¼ é€’ç»™ MSBuild è¿›è¡Œæ„å»ºå’Œè¿è¡Œã€‚\nå…¶èƒŒåçš„è¿è¡Œæœºåˆ¶æ˜¯ï¼šå½“ä½¿ç”¨ dotnet run å‘½ä»¤è¿è¡Œä¸€ä¸ª C# æ–‡ä»¶æ—¶ï¼Œå‘½ä»¤è¡Œä¼šè§£ææºæ–‡ä»¶ä¸­çš„ #: æŒ‡ä»¤ï¼Œæ ¹æ®è¿™äº›æŒ‡ä»¤åœ¨å†…å­˜ä¸­æ„å»ºä¸€ä¸ª C# é¡¹ç›® XML æ–‡æ¡£ï¼Œè¿™ä¸ªæ–‡æ¡£å°±ç›¸å½“äºä¸€ä¸ªå¸¸è§„é¡¹ç›®çš„ .csproj æ–‡ä»¶ã€‚éšåï¼ŒMSBuild ä¼šåŸºäºè¿™ä¸ªå†…å­˜ä¸­çš„é¡¹ç›®æ–‡æ¡£è¿›è¡Œç¼–è¯‘å’Œè¿è¡Œï¼Œä½¿å¾—å•ä¸ªæ–‡ä»¶èƒ½å¤Ÿåƒå®Œæ•´é¡¹ç›®ä¸€æ ·æ‰§è¡Œ ã€‚\nåº”ç”¨ç¤ºä¾‹è¯¦è§£ ç¤ºä¾‹ 1ï¼šç»å…¸ Hello World 1 2 3 // HelloWorld.cs #:r \u0026#34;System.Net.Http\u0026#34; Console.WriteLine(\u0026#34;Hello, World!\u0026#34;); åœ¨è¿™ä¸ªç®€å•ç¤ºä¾‹ä¸­ï¼Œ#:r \u0026quot;System.Net.Http\u0026quot; æ˜¯ä¸€ä¸ª #: æŒ‡ä»¤ï¼Œå®ƒç”¨äºå¼•ç”¨ System.Net.Http ç¨‹åºé›†ã€‚è™½ç„¶ä»£ç ä¸­æ²¡æœ‰ä¼ ç»Ÿçš„é¡¹ç›®æ–‡ä»¶é…ç½®ï¼Œä½†é€šè¿‡è¿™æ¡æŒ‡ä»¤ï¼Œæˆ‘ä»¬ä¸ºç¨‹åºæ·»åŠ äº†æ‰€éœ€çš„å¼•ç”¨ã€‚åœ¨å‘½ä»¤è¡Œä¸­è¿›å…¥è¯¥æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œæ‰§è¡Œ dotnet run HelloWorld.csï¼Œå°±èƒ½çœ‹åˆ°ç†Ÿæ‚‰çš„ â€œHello, World!â€ è¾“å‡ºã€‚è¿™å±•ç¤ºäº†åŸºäºæ–‡ä»¶çš„ç¨‹åºæœ€åŸºç¡€çš„è¿è¡Œæ–¹å¼ï¼Œä»…éœ€ä¸€ä¸ª C# æ–‡ä»¶å’Œç®€å•æŒ‡ä»¤ï¼Œå³å¯å¿«é€Ÿè¿è¡Œä»£ç ã€‚\nç¤ºä¾‹ 2ï¼šå¼•ç”¨å¤–éƒ¨ NuGet åŒ… 1 2 3 4 5 6 7 8 9 10 11 12 13 // NewtonsoftJsonExample.cs #:package Newtonsoft.Json 13.0.1 using Newtonsoft.Json; class Program { static void Main() { var person = new { Name = \u0026#34;Alice\u0026#34;, Age = 30 }; var json = JsonConvert.SerializeObject(person); Console.WriteLine(json); } } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ#:package Newtonsoft.Json 13.0.1 æŒ‡ä»¤ç”¨äºå¼•å…¥ Newtonsoft.Json åŒ…åŠå…¶æŒ‡å®šç‰ˆæœ¬ã€‚å¼•å…¥åï¼Œä»£ç ä¸­å°±èƒ½ä½¿ç”¨ Newtonsoft.Json æä¾›çš„åŠŸèƒ½ï¼Œå¦‚å°†å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ã€‚è¿è¡Œæ—¶ï¼Œdotnet run å‘½ä»¤ä¼šæ ¹æ®è¯¥æŒ‡ä»¤è‡ªåŠ¨ä¸‹è½½å¹¶å¼•ç”¨æ‰€éœ€çš„ NuGet åŒ…ï¼Œæ— éœ€æ‰‹åŠ¨åœ¨é¡¹ç›®æ–‡ä»¶ä¸­æ·»åŠ åŒ…å¼•ç”¨ï¼Œæå¤§åœ°ç®€åŒ–äº†ä½¿ç”¨å¤–éƒ¨åŒ…çš„æµç¨‹ ã€‚\nç¤ºä¾‹ 3ï¼šå¤šæ–‡ä»¶åä½œ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„æ•°å­¦è®¡ç®—é¡¹ç›®ï¼ŒåŒ…å«ä¸¤ä¸ªæ–‡ä»¶ï¼šCalculator.cs å’Œ Program.csã€‚\nCalculator.cs æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 // Calculator.cs namespace MathUtils { public static class Calculator { public static int Add(int a, int b) { return a + b; } } } Program.cs æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 // Program.cs #:r \u0026#34;System.Net.Http\u0026#34; using MathUtils; class Program { static void Main() { int result = Calculator.Add(5, 3); Console.WriteLine($\u0026#34;The result of addition is: {result}\u0026#34;); } } åœ¨åŸºäºæ–‡ä»¶çš„ç¨‹åºä¸­ï¼Œæ— éœ€æ‰‹åŠ¨åœ¨é¡¹ç›®æ–‡ä»¶ä¸­é…ç½®æ–‡ä»¶å¼•ç”¨å…³ç³»ã€‚å½“ä½¿ç”¨ dotnet run Program.cs å‘½ä»¤è¿è¡Œæ—¶ï¼ŒSDK CLI ä¼šè‡ªåŠ¨è§£æ Program.cs æ‰€åœ¨ç›®å½•æ ‘ä¸­çš„æ‰€æœ‰ .cs æ–‡ä»¶ï¼Œå°† Calculator.cs åŒ…å«åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œä½¿å¾—ä¸åŒæ–‡ä»¶ä¹‹é—´èƒ½å¤Ÿé¡ºåˆ©åä½œï¼Œå®ç°å¤æ‚çš„åŠŸèƒ½ ã€‚\nä¸ä¼ ç»Ÿé¡¹ç›®æ¨¡å¼çš„å¯¹æ¯”ä¼˜åŠ¿ é™ä½å…¥é—¨é—¨æ§›\nå¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œä¼ ç»Ÿçš„ .csproj é¡¹ç›®æ–‡ä»¶é…ç½®å¤æ‚ï¼ŒåŒ…å«ä¼—å¤šå±æ€§å’ŒèŠ‚ç‚¹ï¼Œå®¹æ˜“è®©æ–°æ‰‹æ„Ÿåˆ°å›°æƒ‘ã€‚è€ŒåŸºäºæ–‡ä»¶çš„ç¨‹åºæ¨¡å¼ï¼Œåªéœ€å…³æ³¨ä»£ç æœ¬èº«å’Œç®€å•çš„ #: æŒ‡ä»¤ï¼Œæ— éœ€æ·±å…¥äº†è§£é¡¹ç›®æ–‡ä»¶é…ç½®ï¼Œèƒ½å¤Ÿæ›´å¿«åœ°ç¼–å†™å’Œè¿è¡Œä»£ç ï¼Œé™ä½äº†å­¦ä¹ æˆæœ¬ã€‚\nå¿«é€ŸåŸå‹å¼€å‘\nåœ¨å¼€å‘åˆæœŸè¿›è¡ŒåŸå‹è®¾è®¡æ—¶ï¼Œå¾€å¾€éœ€è¦å¿«é€ŸéªŒè¯æƒ³æ³•å’ŒåŠŸèƒ½ã€‚åŸºäºæ–‡ä»¶çš„ç¨‹åºæ— éœ€åˆ›å»ºå®Œæ•´é¡¹ç›®ç»“æ„ï¼Œç›´æ¥ç¼–å†™å•ä¸ªæ–‡ä»¶å¹¶è¿è¡Œï¼Œèƒ½å¤Ÿå¤§å¤§æé«˜å¼€å‘æ•ˆç‡ï¼Œå¿«é€Ÿè¿­ä»£åŸå‹ã€‚\nç®€åŒ–å°å‹å·¥å…·å¼€å‘\nå¯¹äºä¸€äº›ç®€å•çš„å°å‹å·¥å…·æˆ–è„šæœ¬ï¼Œä½¿ç”¨ä¼ ç»Ÿé¡¹ç›®æ¨¡å¼æ˜¾å¾—è¿‡äºç¹çã€‚åŸºäºæ–‡ä»¶çš„ç¨‹åºå¯ä»¥ç”¨æœ€å°‘çš„é…ç½®å’Œæ­¥éª¤å®ç°åŠŸèƒ½ï¼Œä½¿ä»£ç æ›´åŠ ç®€æ´ã€è½»ä¾¿ï¼Œä¾¿äºç»´æŠ¤å’Œç®¡ç†ã€‚\nä½¿ç”¨æ³¨æ„äº‹é¡¹ è™½ç„¶åŸºäºæ–‡ä»¶çš„ç¨‹åºå¸¦æ¥äº†è¯¸å¤šä¾¿åˆ©ï¼Œä½†åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¹Ÿæœ‰ä¸€äº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š\nç›®å‰åŸºäºæ–‡ä»¶çš„ç¨‹åºåœ¨åŠŸèƒ½ä¸Šè¿˜å­˜åœ¨ä¸€å®šé™åˆ¶ï¼Œä¾‹å¦‚å¯¹æŸäº›å¤æ‚çš„é¡¹ç›®é…ç½®å’Œæ„å»ºè‡ªå®šä¹‰æ”¯æŒä¸å¤Ÿå®Œå–„ã€‚ ç”±äºå…¶ä¾èµ–äº #: æŒ‡ä»¤æ¥é…ç½®é¡¹ç›®å±æ€§ï¼ŒæŒ‡ä»¤çš„è¯­æ³•å’Œä½¿ç”¨è§„åˆ™éœ€è¦å¼€å‘è€…ç†Ÿç»ƒæŒæ¡ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°å¼•ç”¨é”™è¯¯æˆ–æ„å»ºå¤±è´¥ç­‰é—®é¢˜ã€‚ åœ¨å›¢é˜Ÿåä½œå¼€å‘ä¸­ï¼ŒåŸºäºæ–‡ä»¶çš„ç¨‹åºå¯èƒ½ä¼šå› ä¸ºæˆå‘˜ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„ .NET SDK è€Œå¯¼è‡´è¿è¡Œç»“æœä¸ä¸€è‡´ï¼Œéœ€è¦ç»Ÿä¸€å¼€å‘ç¯å¢ƒã€‚ ä»¥ä¸Šå°±æ˜¯å¯¹ .NET åŸºäºæ–‡ä»¶çš„ç¨‹åºç‰¹æ€§çš„è¯¦ç»†ä»‹ç»å’Œåº”ç”¨ç¤ºä¾‹ã€‚è¿™ä¸€ç‰¹æ€§ä¸ºå¼€å‘è€…æä¾›äº†æ›´çµæ´»é«˜æ•ˆçš„å¼€å‘æ–¹å¼ï¼Œæ— è®ºæ˜¯åˆå­¦è€…å¿«é€Ÿä¸Šæ‰‹ï¼Œè¿˜æ˜¯ç»éªŒä¸°å¯Œçš„å¼€å‘è€…è¿›è¡Œå¿«é€Ÿå¼€å‘ï¼Œéƒ½èƒ½å‘æŒ¥é‡è¦ä½œç”¨ã€‚ä¸å¦¨äº²è‡ªå°è¯•ï¼Œæ„Ÿå—å®ƒå¸¦æ¥çš„ä¾¿æ·ï¼å¦‚æœä½ åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æœ‰æ–°çš„å‘ç°æˆ–é‡åˆ°é—®é¢˜ï¼Œæ¬¢è¿ä¸€èµ·äº¤æµæ¢è®¨ã€‚\n","date":"2025-05-29T11:04:44+08:00","image":"https://www.notion.so/images/page-cover/rijksmuseum_mignons_1660.jpg","permalink":"https://dumbnessrf.github.io/p/single-file-run/","title":"å•æ–‡ä»¶è¿è¡ŒC#ä»£ç "}]